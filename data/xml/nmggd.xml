<jobs>
	<job_def>
		<job_id><![CDATA[20180920142311829]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[2.17-day_answer_user_time]]></job_name> 
		<job_desc><![CDATA[2.17-day_answer_user_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[59 59 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_answer_user_time partition(day=${today})
select 
dt2.user_id,
count(1) cnt_answer_times_view,
sp_id,
user_addr,
user_addr_city,
user_addr_borough,
user_addr_town 
from 
(select session_id,sp_id from ${PLATFORM_ID}.user_log 
where day=${today} and event_name='view_question' )dt1 
join (select session_id,user_id from ${PLATFORM_ID}.session_log where day in (${yesterday},${today}))dt2 on dt1.session_id=dt2.session_id 
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town from ${PLATFORM_ID}.user_addr_info  where day=${yesterday} group by user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town)dt3 on dt2.user_id=dt3.user_id 
group by
dt2.user_id,
sp_id,
user_addr,
user_addr_city,
user_addr_borough,
user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180903145753400]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.1-contentcomb1_day]]></job_name> 
		<job_desc><![CDATA[v2.16.1-contentcomb1_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 55 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with
cp as
(
select dt1.nns_id as nns_vod_id,nns_vod_index_id,nns_mode,dt3.nns_id media_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id,dt1.nns_view_type  from
(select nns_id,nns_cp,sp_id,nns_view_type from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id = dt2.sp_id
left join
(select nns_id,nns_vod_id,nns_vod_index_id,nns_mode,sp_id from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt3
on dt1.nns_id=dt3.nns_vod_id and dt1.sp_id = dt3.sp_id
group by dt1.nns_id,nns_vod_index_id,nns_mode,dt3.nns_id,dt2.nns_id,nns_cp,dt1.sp_id,dt1.nns_view_type
)
insert overwrite table ${PLATFORM_ID}.contentcomb1_day partition(day=${yesterday})
select
video_type,
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
category_id,
dt3.nns_category_name,
cp.nns_mode,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
item.nns_id playbill_id,
item.nns_name playbill_name,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
user_id uid,
null uidv,
item.nns_begin_time playbill_start_time,
item.nns_time_len playbill_length,
dt1.sp_id,
nns_view_type
from (select user_id,play_sid,video_type,episode_id,media_id,video_id,video_name,apk_version,client_type,playbill_length,playbill_start_time,category_id,asset_id,sp_id from ${PLATFORM_ID}.play_log where day=${yesterday}
group by user_id,play_sid,episode_id,media_id,video_type,video_id,video_name,apk_version,client_type,playbill_length,playbill_start_time,category_id,asset_id,sp_id) dt1 join
(select uid,pid,sp_id from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid and dt1.sp_id=valid.sp_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id left join
cp on dt1.video_id=cp.nns_vod_id and dt1.episode_id=cp.nns_vod_index_id and dt1.sp_id = cp.sp_id left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and item.sp_id=dt1.sp_id
group by video_type,nns_addr_code,nns_addr_city,apk_version,video_id,video_name,category_id,dt3.nns_category_name,cp.nns_mode, asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,item.nns_id,item.nns_name,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,item.nns_begin_time,item.nns_time_len,dt1.sp_id,nns_view_type,nns_addr_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901104304940]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_status_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_status_user_persto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 * 1 ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_member_status_user drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901104149784]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_status_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_status_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_member_status_user drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901104047185]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_status_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_status_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_status_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901103750812]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_expired_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_expired_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_expired_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901103448698]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_member_user drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901102953399]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_member_user drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901102605586]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901101716789]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_register_invitation_code_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_register_invitation_code_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_register_invitation_code_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901101244375]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_renewals_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_renewals_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_member_renewals_user drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901100854807]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_renewals_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_renewals_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_member_renewals_user drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901100311062]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_renewals_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_renewals_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_renewals_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901095736645]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_monthly_existing_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_monthly_existing_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_member_monthly_existing_user drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901095203952]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_monthly_existing_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_monthly_existing_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_member_monthly_existing_user drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901094825637]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_monthly_existing_user_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_monthly_existing_user_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_monthly_existing_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901093946217]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_monthly_unsubscribe_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_monthly_unsubscribe_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_member_monthly_unsubscribe drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901093105803]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_monthly_unsubscribe_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_monthly_unsubscribe_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_member_monthly_unsubscribe drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901091405807]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_monthly_unsubscribe_presto]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_monthly_unsubscribe_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 03 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_member_monthly_unsubscribe drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180830180900503]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_sw_company_article_detail]]></job_name> 
		<job_desc><![CDATA[v2.17_day_sw_company_article_detail]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_company_article_detail partition(day=${yesterday})
select first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,article_id,article_title,user_id,publish_time,modify_time,modify_user_id,status from 
(select nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name from (select nns_id,nns_first_id first_company_id,nns_first_name first_company_name,nns_second_id second_company_id,nns_second_name second_company_name,nns_third_id third_company_id,nns_third_name third_company_name from ${PLATFORM_ID}.day_sw_nns_company where day=${yesterday})dt1 
left join (select nns_first_id first_column_id,nns_first_name first_column_name,nns_second_id second_column_id,nns_second_name second_column_name,nns_first_company_id from ${PLATFORM_ID}.sw_nns_column where day=${yesterday})dt2 
on dt1.nns_id=dt2.nns_first_company_id )d1 
left join (select nns_id article_id,nns_title article_title,nns_user_id user_id,nns_column_id,nns_company_id,nns_publish_time publish_time,nns_modify_time modify_time,nns_modify_user_id modify_user_id,nns_status status from ${PLATFORM_ID}.sw_nns_article where day=${yesterday} group by nns_id,nns_title,nns_user_id,nns_column_id,nns_company_id,nns_publish_time,nns_modify_time,nns_modify_user_id,nns_status)d2 on d1.nns_id=d2.nns_company_id and d1.second_column_id=d2.nns_column_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180823180000011]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_sw_column_alarm_config]]></job_name> 
		<job_desc><![CDATA[v2.17_day_sw_column_alarm_config]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with p1 as (select d1.nns_id,d1.first_company_id,d1.first_company_name,d1.second_company_id,d1.second_company_name,d1.third_company_id,d1.third_company_name,d1.first_column_id,d1.first_column_name,d1.second_column_id,d1.second_column_name,
if(d1.first_company_id=d2.first_company_id and d1.first_column_name=d2.column_name,if(d2.second_company_id is null or d2.second_company_id='',frequency,if(d1.second_company_id=d2.second_company_id,if(d2.third_company_id is null or d2.third_company_id='',frequency,if(d1.third_company_id=d2.third_company_id,frequency,null)),null)),null) frequency ,
if(d1.first_company_id=d2.first_company_id and d1.first_column_name=d2.column_name,if(d2.second_company_id is null or d2.second_company_id='',1,if(d1.second_company_id=d2.second_company_id,if(d2.third_company_id is null or d2.third_company_id='',2,if(d1.third_company_id=d2.third_company_id,3,0)),0)),0) level
from 
(select dt1.nns_id nns_id,dt1.nns_first_id first_company_id,dt1.nns_first_name first_company_name,dt1.nns_second_id second_company_id,dt1.nns_second_name second_company_name,dt1.nns_third_id third_company_id,dt1.nns_third_name third_company_name,dt2.nns_first_id first_column_id,dt2.nns_first_name first_column_name,dt2.nns_second_id second_column_id,dt2.nns_second_name second_column_name  from (select nns_id,nns_first_id,nns_first_name,nns_second_id,nns_second_name,nns_third_id,nns_third_name from ${PLATFORM_ID}.day_sw_nns_company where day=${yesterday})dt1 
left join (select nns_first_id,nns_first_name,nns_first_company_id,nns_second_id,nns_second_name from ${PLATFORM_ID}.sw_nns_column where day=${yesterday} )dt2 on dt1.nns_id=dt2.nns_first_company_id)d1 
left join ( select first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,column_name,frequency,modify_time from ${PLATFORM_ID}.day_sw_alarm_config where day=${yesterday})d2 on d1.first_company_id=d2.first_company_id and d1.first_column_name=d2.column_name) 
insert overwrite table ${PLATFORM_ID}.day_sw_column_alarm_config partition(day=${yesterday})
select p2.nns_id,p2.first_company_id,p2.first_company_name,p2.second_company_id,p2.second_company_name,p2.third_company_id,p2.third_company_name,p2.first_column_id,p2.first_column_name,p2.second_column_id,p2.second_column_name,p1.frequency from p1 
 join 
(select nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,max(level) level from p1  
group by nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name)p2 
on  p1.second_column_id=p2.second_column_id  and p1.level=p2.level
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180823180000003]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_sw_alarm_config]]></job_name> 
		<job_desc><![CDATA[v2.17_day_sw_alarm_config]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_alarm_config partition(day=${yesterday})
select dt1.first_company_id,dt1.first_company_name ,dt1.second_company_id ,dt1.second_company_name,dt1.third_company_id ,dt1.third_company_name ,dt1.column_name,dt1.frequency , dt1.modify_time from
 (select   first_company_id,first_company_name ,second_company_id ,second_company_name,third_company_id ,third_company_name ,column_name,frequency , modify_time  from ${PLATFORM_ID}.day_sw_alarm_config where day=${today-2})dt1 
 join (
  select  first_company_id,first_company_name ,second_company_id ,second_company_name,third_company_id ,third_company_name ,column_name,max(modify_time) modify_time  from ${PLATFORM_ID}.day_sw_alarm_config where day=${today-2}   group by first_company_id,first_company_name ,second_company_id ,second_company_name,third_company_id ,third_company_name ,column_name )dt2 on dt1.modify_time=dt2.modify_time where frequency>0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010008]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_play_log_special_type]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_play_log_special_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_quality_play_special_log_type drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010005]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_play_log_type]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_play_log_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_quality_play_log_type drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010003]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_performance_log_type]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_performance_log_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_quality_performance_log_type drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010001]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_user_log_type]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_user_log_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_quality_user_log_type drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180817141521576]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.4-detail_live]]></job_name> 
		<job_desc><![CDATA[v2.17.4-detail_live]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.detail_live partition(day=${yesterday})
select
video_id,
video_name,
nns_code,
nns_name,
apk_version,
client_type,
sp_id,
user_id,
sum(1),
round(sum(play_time_length)/60.0,6),
content_type 
from ${PLATFORM_ID}.day_content_user_time_device_video_playbill_apk_type
where day = ${yesterday} and video_type = 'live' 
group by video_id,video_name,nns_code,nns_name,apk_version,client_type,sp_id,user_id,content_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180817134124197]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17.4-day_content_user_time_device_video_playbill_apk_type]]></job_name> 
		<job_desc><![CDATA[v2.17.4-day_content_user_time_device_video_playbill_apk_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_user_time_device_video_playbill_apk_type partition(day=${yesterday})
select 
user_id,
sp_id,
device_id,
video_type,
video_id,
video_name,
playbill_name,
apk_version,
client_type,
play_sid,
nns_addr_code,
nns_addr_city,
from_unixtime(cast(start_time/1000 as bigint),'yyyy-MM-dd HH:mm:ss'),
from_unixtime(cast(end_time/1000 as bigint),'yyyy-MM-dd HH:mm:ss'),
buffer_time,
paused_time,
round(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0)*1.0/1000,6),
nns_nns_boss_area_bind,
category_id,
nns_category_name,
asset_id,
asset_name,
episode_id,
ip,
nns_view_type 
from 
(select episode_id,dt1.sp_id,user_id,device_id,video_id,video_name,video_type,play_sid,apk_version,dt1.client_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,nns_addr_city,category_id,nns_category_name,asset_id,dt3.nns_name asset_name,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time,nns_nns_boss_area_bind,ip,nns_view_type,if(video_type!='live',playbill_name,null) playbill_name
from (select * from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid left join 
(select nns_addr_code,nns_addr_city,nns_id,nns_nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday})dt2 on dt1.user_id = dt2.nns_id 
left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id = dt3.sp_id left join (select nns_id,nns_view_type,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday})dt4 on dt1.video_id=dt4.nns_id and dt1.sp_id=dt4.sp_id
group by dt1.sp_id,user_id,device_id,video_id,video_name,video_type,play_sid,apk_version,dt1.client_type,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,category_id,nns_category_name,asset_id,dt3.nns_name,nns_nns_boss_area_bind,episode_id,ip,nns_view_type,if(video_type!='live',playbill_name,null))dt
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180808170440825]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17-day_sw_article_alarm]]></job_name> 
		<job_desc><![CDATA[v2.17-day_sw_article_alarm]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_article_alarm partition(day=${yesterday}) 
select dt2.nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,if(unix_timestamp('${yesterday}','yyyyMMdd')-unix_timestamp(from_unixtime(cast(max(dt1.nns_publish_time)/1000 as bigint),'yyyyMMdd'),'yyyyMMdd')=if(frequency is not null and frequency >1,frequency-3,27)*86400,1,0) warning,if(unix_timestamp('${yesterday}','yyyyMMdd')-unix_timestamp(from_unixtime(cast(max(dt1.nns_publish_time)/1000 as bigint),'yyyyMMdd'),'yyyyMMdd')>=if(frequency is not null and frequency >1,frequency,30)*86400,1,0) alarm from 
 (select nns_id,nns_column_id,nns_publish_time from ${PLATFORM_ID}.sw_nns_article where day=${yesterday})dt1 
right join (select nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,frequency from ${PLATFORM_ID}.day_sw_column_alarm_config where day=${yesterday})dt2 on dt1.nns_column_id=dt2.second_column_id
group by dt2.nns_id,first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,frequency
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180807170440425]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17-day_sw_column_attention]]></job_name> 
		<job_desc><![CDATA[v2.17-day_sw_column_attention]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_column_attention partition(day=${yesterday})
select first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,d2.article_id,article_name,user_id,sp_id,client_type,apk_version,article_view 
from  
(select first_company_id,first_company_name,second_company_id,second_company_name,third_company_id,third_company_name,first_column_id,first_column_name,second_column_id,second_column_name,dt4.nns_id article_id from 
(select nns_first_id first_column_id,nns_first_name first_column_name,nns_second_id second_column_id,nns_second_name second_column_name from ${PLATFORM_ID}.sw_nns_column where day=${yesterday} group by nns_first_id ,nns_first_name ,nns_second_id ,nns_second_name )dt3 
left join (select nns_id,nns_column_id,nns_company_id from ${PLATFORM_ID}.sw_nns_article where day=${yesterday} group by nns_id,nns_column_id,nns_company_id)dt4 on dt3.second_column_id=dt4.nns_column_id  
left join (select nns_id,nns_first_id first_company_id,nns_first_name first_company_name,nns_second_id second_company_id,nns_second_name second_company_name,nns_third_id third_company_id,nns_third_name third_company_name from ${PLATFORM_ID}.day_sw_nns_company where day=${yesterday})dt5 on  dt4.nns_company_id=dt5.nns_id
)d1 
left join 
(select article_id,article_name,user_id,sp_id,client_type,apk_version,count(*) article_view from 
(select dt2.user_id,article_id,article_name,client_type,apk_version,dt1.sp_id from 
(select sp_id,session_id,event_value['id'] article_id,event_value['name'] article_name from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='view_twmz')dt1  
join (select session_id,user_id,client_type,apk_version,sp_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,client_type,apk_version,sp_id)dt2 on dt1.session_id=dt2.session_id and dt1.sp_id=dt2.sp_id)dt group by sp_id,article_id,article_name,client_type,apk_version,user_id
)d2 on d1.article_id=d2.article_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180807170330425]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17-day_sw_company_articles]]></job_name> 
		<job_desc><![CDATA[v2.17-day_sw_company_articles]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_company_articles partition(day=${yesterday})
select dt1.nns_id,nns_first_id first_company_id,nns_first_name first_company_name,nns_second_id second_company_id,nns_second_name second_company_name,nns_third_id third_company_id,nns_third_name third_company_name,dt2.article_id 
from (select nns_id,nns_first_id,nns_first_name,nns_second_id,nns_second_name,nns_third_id,nns_third_name from ${PLATFORM_ID}.day_sw_nns_company where day=${yesterday} and nns_id is not null and nns_id!='')dt1 
left join (select nns_company_id ,nns_id article_id from ${PLATFORM_ID}.sw_nns_article where day=${yesterday}  and nns_status!=0 and nns_id!='' and nns_id is not null group by nns_company_id,nns_id )dt2 
on dt1.nns_id=dt2.nns_company_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121640012]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_churn_return_silent_user]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_churn_return_silent_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.day_churn_return_silent_user drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121510100]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_return_user]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_return_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.day_return_user drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121352402]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_churn_user]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_churn_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.day_churn_user drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731115643204]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_silent_user]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_silent_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.day_silent_user drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727183721005]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_pay_product_use_client_sp_addr]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_pay_product_use_client_sp_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_pay_product_use_client_sp_addr partition(day=${yesterday})
select 
p_id,
p_name,
client_type,
sp_id,
nns_addr_code,
nns_addr_city,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(1000*60*60),3),
count(1),
apk_version,
video_id,
video_name,
nns_product_type,
nns_order_type,
nns_pay_channel_id,
max(vod_ext_language) vod_ext_language,
cp_id,
nns_boss_area_bind,
nns_product_price
from 
(select 
p_id,
p_name,
video_id,
video_name,
play_sid,
dt1.client_type,
dt1.sp_id,
if(length(nns_addr_code)>6,nns_addr_code,dt7.user_addr) nns_addr_code,
nns_addr_city,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time,
apk_version,
dt3.nns_product_type,
dt4.nns_order_type,
dt4.nns_pay_channel_id,
max(dt5.nns_vod_ext_language) vod_ext_language,
dt4.cp_id,
dt2.nns_boss_area_bind,
dt4.nns_product_price
from 
(select ext_info['p_id'] p_id,ext_info['p_name'] p_name,user_id,event_type,play_sid,server_time,duration,client_type,sp_id,apk_version,video_id,video_name from ${PLATFORM_ID}.play_log where day=${yesterday} and ext_info['p_id'] is not null) dt1 
join 
(select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid 
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid 
left join 
(select nns_id,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 
on dt1.user_id = dt2.nns_id 
left join 
(select nns_product_id,nns_product_type,cp_id from ${PLATFORM_ID}.nns_product where day=${yesterday}) dt3 
on dt1.p_id=dt3.nns_product_id 
left join 
(select nns_order_type,nns_pay_channel_id,nns_user_id,nns_product_id,sp_id,cp_id,nns_product_price from ${PLATFORM_ID}.nns_buy_order where day=${yesterday}) dt4 
on dt1.user_id=dt4.nns_user_id and dt1.p_id=dt4.nns_product_id and dt1.sp_id=dt4.sp_id and dt3.cp_id=dt4.cp_id
left join 
(select nns_id,nns_name,nns_vod_ext_language,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday})
dt5 on dt1.sp_id=dt5.sp_id and dt1.video_id=dt5.nns_id 
left join 
(select max(client_type) client_type,user_id,max(user_addr) user_addr  from ${PLATFORM_ID}.day_devicecomb where day=${yesterday} group by user_id)dt7
on dt4.nns_user_id = dt7.user_id 
group by p_id,p_name,play_sid,dt1.client_type,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,dt7.user_addr),nns_addr_city,apk_version,video_id,video_name,nns_product_type,nns_order_type,nns_pay_channel_id,dt4.cp_id,dt2.nns_boss_area_bind,dt4.nns_product_price )dt 
group by p_id,p_name,client_type,sp_id,nns_addr_code,nns_addr_city,apk_version,video_id,video_name,nns_product_type,nns_order_type,nns_pay_channel_id,cp_id,nns_boss_area_bind,nns_product_price
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727183423906]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_pay_user]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_pay_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_pay_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727183056569]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_pay_time_product_video_channel_type_addr]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_pay_time_product_video_channel_type_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert overwrite table ${PLATFORM_ID}.day_pay_time_product_video_channel_type_addr partition(day=${today-1})
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
null sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
cnt_order_pay_history_total,
cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null vod_ext_language,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last, 
null user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind,
null product_price
from (select nns_boss_area_bind,sum(num) cnt_order_pay_history_total from (select nns_user_id,count(1) num from ${PLATFORM_ID}.nns_buy_order where day=${today-1} and nns_order_state=1 group by nns_user_id)a left join user on nns_user_id=nns_id group by nns_boss_area_bind)dt1 full outer join (select nns_boss_area_bind,count(1) cnt_active_user_total from (select uid from ${PLATFORM_ID}.valid where day = ${today-1} group by uid)a left join user on uid=nns_id group by nns_boss_area_bind)dt2 on dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
union all
select 
product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id,
sum(case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-1}' then 1 else 0 end) cnt_order_place_total,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-1}' then user_id else null end) cnt_order_place_user_total,
sum(case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-1}' then order_price else 0 end) cnt_order_place_money_total,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-1}' and is_new = 1 then user_id else null end) cnt_order_place_new_user_total,
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total,
count(distinct case when is_new = 1 then user_id else null end) cnt_order_pay_new_user_total,
count(distinct case when nns_order_state = 5 then user_id else null end) cnt_unsubscribe_user_total,
count(distinct case when is_active = 1 then user_id else null end) cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-1}' and nns_order_state != 1 then user_id else null end) cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
max(vod_ext_language) vod_ext_language,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last, 
null user_id,
null user_id_last,
cp_id,
count(case when nns_order_state = 5 then user_id else null end) cnt_order_unsubscribe_total,nns_boss_area_bind,product_price
from ${PLATFORM_ID}.day_sales_basic_data where day = ${today-1} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind,product_price
union all
select 
product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
null cnt_order_place_nopay_total, 
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total_last,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total_last,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total_last,
max(vod_ext_language) vod_ext_language,
sum(case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-2}' then 1 else 0 end) cnt_order_place_total_last,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-2}' then user_id else null end) cnt_order_place_user_total_last,
sum(case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd') = '${today-2}' then order_price else 0 end) cnt_order_place_money_total_last,
null user_id,
null user_id_last,
cp_id,
null cnt_order_unsubscribe_total,nns_boss_area_bind,
product_price
from ${PLATFORM_ID}.day_sales_basic_data where day = ${today-2} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind,product_price
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null vod_ext_language,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last, 
user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
null nns_boss_area_bind,
null product_price 
from (select sp_id,user_id,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${today-1} group by sp_id,user_id) a
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null vod_ext_language,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last, 
null user_id,
user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,null nns_boss_area_bind,
null product_price
from (select sp_id,user_id as user_id_last from ${PLATFORM_ID}.heartbeat_log where day=${today-2} group by sp_id,user_id) b
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727172944685]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_sales_basic_data]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_sales_basic_data]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_sales_basic_data drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180717134540788]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.15.1-content_live_video_playbill_time_interval_30minute]]></job_name> 
		<job_desc><![CDATA[v2.15.1-content_live_video_playbill_time_interval_30minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.content_live_video_playbill_time_interval_30minute drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710232219947]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[nns_vod_all]]></job_name> 
		<job_desc><![CDATA[nns_vod_all]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.nns_vod_all partition(day=${yesterday})
select
dt2.nns_video_id,
dt2.nns_video_name,
nns_video_kind,
nns_view_type,
nns_director,
nns_actor,
nns_video_ext_language,
nns_index_id,
nns_index_name,
nns_index_ext_language,
dt2.nns_cp_name,
nns_cp_id,
dt1.sp_id,
dt4.nns_category_id,
dt4.nns_assist_id,
nns_video_type,
nns_assist_name,
nns_category_name,
nns_area,
dt6.nns_id,
nns_mode
from (
select
nns_vod_id,
nns_id nns_index_id,
nns_name nns_index_name,
nns_vod_index_ext_language nns_index_ext_language,
sp_id
from ${PLATFORM_ID}.nns_vod_index where day=${yesterday}
) dt1
left join (
select 
nns_id nns_video_id,
nns_name nns_video_name,
nns_kind nns_video_kind,
nns_area,
nns_view_type,
nns_director,
nns_actor,
nns_vod_ext_language nns_video_ext_language,
nns_cp nns_cp_name,
sp_id
from ${PLATFORM_ID}.nns_vod where day=${yesterday}
) dt2 on dt1.nns_vod_id = dt2.nns_video_id and dt1.sp_id=dt2.sp_id
left join(
select 
nns_id,
nns_vod_id,
nns_vod_index_id,
nns_mode,
sp_id 
from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}
) dt6 on dt1.nns_vod_id=dt6.nns_vod_id and dt1.nns_index_id=dt6.nns_vod_index_id and dt1.sp_id=dt6.sp_id
left join(
select
nns_id nns_cp_id,
nns_name nns_cp_name,
sp_id
from ${PLATFORM_ID}.nns_cp where day=${yesterday}
) dt3 on dt2.nns_cp_name = dt3.nns_cp_name and dt1.sp_id=dt3.sp_id
left join (
select 
nns_video_id,
nns_video_type,
max(nns_category_id) nns_category_id,
max(nns_assist_id) nns_assist_id,
sp_id
from ${PLATFORM_ID}.nns_assists_item where day=${yesterday} group by nns_video_type,nns_video_id,sp_id
) dt4 on dt1.nns_vod_id = dt4.nns_video_id and dt1.sp_id=dt4.sp_id
left join (
select
nns_id nns_assist_id,
nns_name nns_assist_name,
nns_category_id,
nns_category_name,
sp_id
from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}
) dt5 on dt4.nns_assist_id = dt5.nns_assist_id and dt4.nns_category_id = dt5.nns_category_id and dt1.sp_id=dt5.sp_id
group by 
dt2.nns_video_id,
dt2.nns_video_name,
nns_video_kind,
nns_view_type,
nns_area,
nns_director,
nns_actor,
nns_video_ext_language,
nns_index_id,
nns_index_name,
nns_index_ext_language,
dt2.nns_cp_name,
nns_cp_id,
dt1.sp_id,
dt4.nns_category_id,
dt4.nns_assist_id,
nns_video_type,
nns_assist_name,
nns_category_name,
dt6.nns_id,
nns_mode
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710232130717]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[user_log_all]]></job_name> 
		<job_desc><![CDATA[user_log_all]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_log_all partition(day=${yesterday})
select
dt1.session_id session_id,
page_sid,
event_name,
event_value,
user_id,
apk_version,
client_type,
dt1.sp_id sp_id,
minute,
device_id,
region_code,
event_source,
source_page_id_1,
source_page_id_2,
source_page_id_3,
source_page_id_tail,
event_target,
target_page_id_1,
target_page_id_2,
target_page_id_3,
target_page_id_tail
from
(select 
session_id,
page_sid,
event_value,
sp_id,event_name,
user_id,
event_source,
source_page_id_1,
source_page_id_2,
source_page_id_3,
source_page_id_tail,
event_target,
target_page_id_1,
target_page_id_2,
target_page_id_3,
target_page_id_tail,
minute 
from ${PLATFORM_ID}.user_log where day=${yesterday}) dt1 
left join
(select 
session_id,
device_id,
apk_version,
sp_id,
client_type,
region_code
from ${PLATFORM_ID}.session_log where day>=${today-2} and day<=${yesterday}
group by session_id,device_id,apk_version,sp_id,client_type,region_code) dt2
on dt1.session_id=dt2.session_id and dt1.sp_id=dt2.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710232047849]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[play_log_all]]></job_name> 
		<job_desc><![CDATA[play_log_all]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.play_log_all partition(day=${yesterday})
select 
user_id,
client_type,
apk_version,
region_code,
page_sid,
play_sid,
asset_id,
category_id,
video_id,
video_name,
video_type,
episode_id,
playbill_start_time,
playbill_length,
playbill_name,
sp_id,
first_frame_length,
buffer_length,
buffer_times,
drag_length,
drag_times,
pause_length,
pause_times,
begin_time,
finish_time,
start_time,
end_time,
round(if(if(finish_time=0,end_time,finish_time)-if(begin_time is null,start_time,begin_time)-buffer_length-pause_length>0,if(finish_time=0,end_time,finish_time)-if(begin_time is null,start_time,begin_time)-buffer_length-pause_length,0)/(60.0*1000),6) CNT_PLAY_LENGTH,
if(array_contains(map_keys(ext_info),'p_id'),ext_info['p_id'],null) p_id,
if(array_contains(map_keys(ext_info),'p_name'),ext_info['p_name'],null) p_name,
if(array_contains(map_keys(ext_info),'special_id'),ext_info['special_id'],null) special_id,
if(array_contains(map_keys(ext_info),'special_name'),ext_info['special_name'],null) special_name,
if(array_contains(map_keys(ext_info),'recommend_code'),ext_info['recommend_code'],null) recommend_code,
if(array_contains(map_keys(ext_info),'video_duration'),ext_info['video_duration'],null) video_duration
from (select * from ${PLATFORM_ID}.play_log_playsid where day=${yesterday}
) dt1 
join (select starttime start_time,endtime end_time,uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid;
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710232003216]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[play_log_playsid]]></job_name> 
		<job_desc><![CDATA[play_log_playsid]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.play_log_playsid partition(day=${yesterday})
select
user_id,
client_type,
apk_version,
region_code,
max(page_sid) page_sid,
play_sid,
asset_id,
category_id,
video_id,
video_name,
video_type,
episode_id,
min(playbill_start_time) playbill_start_time,
max(playbill_length) playbill_length,
max(playbill_name) playbill_name,
sp_id,
sum(if(event_type='ready',duration,0)) first_frame_length,
sum(if(event_type = 'buffer',duration,0)) buffer_length,
sum(if(event_type = 'buffer',1,0)) buffer_times,
sum(if(event_type = 'drag',duration,0)) drag_length,
sum(if(event_type = 'drag',1,0)) drag_times,
sum(if(event_type = 'pause',duration,0)) pause_length,
sum(if(event_type = 'pause',1,0)) pause_times,
min(if(event_type = 'play',server_time,null)) begin_time,
max(if(event_type = 'finish',server_time,0)) finish_time,
ext_info
from ${PLATFORM_ID}.play_log
where day=${yesterday}
group by user_id,client_type,region_code,category_id,apk_version,asset_id,video_id,video_name,video_type,episode_id,sp_id,play_sid,day,ext_info
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710114219851]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_quality_error_page_detail_list]]></job_name> 
		<job_desc><![CDATA[day_quality_error_page_detail_list]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_error_page_detail_list partition(day=${yesterday})
select
page_id,
user_id,
dt2.nns_name user_name,
device_id,
apk_version,
client_type terminaltype,
if(length(dt2.nns_addr_code)>6,dt2.nns_addr_code,dt1.region_code) nns_addr_code,
if(region_code is null,nns_addr_city,dt3.nns_name) nns_addr_city,
server_time error_time,
error_type,
error_code,
error_desc,
sp_id
from 
(select page_id,user_id,device_id,apk_version,client_type,region_code,server_time,error_type,error_code,error_desc,sp_id from ${PLATFORM_ID}.error_log where day=${yesterday} group by page_id,user_id,device_id,apk_version,client_type,region_code,server_time,error_type,error_code,error_desc,sp_id) dt1 
left join
(select nns_id,max(nns_name) nns_name,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id ) dt2 
on dt1.user_id=dt2.nns_id
left join 
(select nns_code,nns_name from ${PLATFORM_ID}.nns_address_code where day=${yesterday} group by nns_code,nns_name)dt3
on  dt1.region_code = dt3.nns_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180709170950213]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_quality_error_video_detail_list]]></job_name> 
		<job_desc><![CDATA[day_quality_error_video_detail_list]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_error_video_detail_list partition(day=${yesterday})
select
video_id,
video_name,
user_id,
dt2.nns_name user_name,
device_id,
apk_version,
client_type terminaltype,
if(length(dt2.nns_addr_code)>6,dt2.nns_addr_code,dt1.region_code) nns_addr_code,
if(region_code is null,nns_addr_city,dt3.nns_name) nns_addr_city,
event_time error_time,
sp_id,
video_type 
from 
(select video_id,video_name,device_id,user_id,apk_version,client_type,region_code,event_time,sp_id,video_type from ${PLATFORM_ID}.play_log where day=${yesterday} and event_type='error' group by video_id,video_name,device_id,user_id,apk_version,client_type,region_code,event_time,sp_id,video_type) dt1 
left join
(select nns_id,max(nns_name) nns_name,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id ) dt2 
on dt1.user_id=dt2.nns_id
left join 
(select nns_code,nns_name from ${PLATFORM_ID}.nns_address_code where day=${yesterday} group by nns_code,nns_name)dt3
on  dt1.region_code = dt3.nns_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180708215910232]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_special_video_addr_sp_user]]></job_name> 
		<job_desc><![CDATA[day_special_video_addr_sp_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_special_video_addr_sp_user drop partition(day=${yesterday});
alter table ${PLATFORM_ID}.day_special_video_addr_sp drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180707215910232]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[week_total_summary]]></job_name> 
		<job_desc><![CDATA[week_total_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_total_summary drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180707115910232]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[month_total_summary]]></job_name> 
		<job_desc><![CDATA[month_total_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_total_summary drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180627182423338]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[month_pay_user]]></job_name> 
		<job_desc><![CDATA[month_pay_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_pay_user drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180627152423338]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[week_pay_user]]></job_name> 
		<job_desc><![CDATA[week_pay_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 6 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_pay_user drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180623105456923]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_page_activity_list]]></job_name> 
		<job_desc><![CDATA[day_page_activity_list]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.mid_user_activity partition(day=${yesterday})
select coalesce(dt.activity_id,history.activity_id),coalesce(dt.page_id,history.page_id),coalesce(dt.user_id,history.user_id) from
(select activity_id,page_id,user_id from ${PLATFORM_ID}.mid_user_activity where day=${today-2}) history
full outer join(
select  activity_id,page_id,user_id from 
(select  event_value['id'] activity_id,source_page_id_1 page_id,session_id,event_name from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name in ('visit_activity','join_activity')) dt1
left join 
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday})dt2 
on dt1.session_id=dt2.session_id
group by activity_id,page_id,user_id
)dt
on history.activity_id=dt.activity_id and history.page_id=dt.page_id and history.user_id=dt.user_id;

insert overwrite table ${PLATFORM_ID}.day_page_activity_list  partition(day=${yesterday})
select coalesce(dt.activity_id,history.activity_id),coalesce(dt.activity_name,history.activity_name),coalesce(dt.page_id,history.page_id),coalesce(history.cnt_page_view,0)+coalesce(dt.cnt_page_view,0),coalesce(history.order_total,0)+coalesce(dt.order_total,0) from
(select   activity_id,activity_name,page_id,cnt_page_view,order_total from ${PLATFORM_ID}.day_page_activity_list where day=${today-2})history
full outer join
(select  activity_id,activity_name, page_id,sum(if(event_name!='pay',1,0)) cnt_page_view,sum(if(event_source='' and event_name='pay' and pay_status='pay_create',1,0)) order_total from 
(select if(event_source='' and event_name='pay',event_value['activity_id'],event_value['id']) activity_id,if(event_source='' and event_name='pay',event_value['activity_name'],event_value['name']) activity_name,if(event_source='' and event_name='pay',null,source_page_id_1) page_id,if(event_source='' and event_name='pay',event_value['pay_status'],null) pay_status,event_name,event_source 
from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name in ('visit_activity','join_activity','pay'))dt1 where activity_id is not null group by activity_id,activity_name,page_id) dt
on history.activity_id=dt.activity_id and dt.page_id=history.page_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180621162411503]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_online_user]]></job_name> 
		<job_desc><![CDATA[day_online_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_online_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180621150216637]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[online_user_5min]]></job_name> 
		<job_desc><![CDATA[online_user_5min]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.online_user_5min where day=${day_last_3_5m} and minute=${minute_last_3_5m}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-18]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180619105456923]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_device_factory_online_count]]></job_name> 
		<job_desc><![CDATA[day_device_factory_online_count]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_device_factory_online_count partition(day=${yesterday}) 
select coalesce(dt.device_id,history.device_id),coalesce(dt.client_type,history.client_type),coalesce(dt.apk_version,history.apk_version),coalesce(dt.factory_id,history.factory_id),
coalesce(dt.sp_id,history.sp_id),coalesce(dt.user_id,history.user_id),coalesce(dt.user_addr,history.user_addr),
coalesce(dt.nns_addr_city,history.nns_addr_city),coalesce(dt.user_addr_borough,history.user_addr_borough),coalesce(dt.user_addr_town,history.user_addr_town)
from 
(select device_id,client_type,apk_version,factory_id,sp_id,user_id,user_addr,nns_addr_city,user_addr_borough,user_addr_town from ${PLATFORM_ID}.day_device_factory_online_count where day=${today-2})as history
full outer join (
select dt1.device_id,dt1.client_type,dt1.apk_version,dt1.factory_id,dt1.sp_id,dt1.user_id,coalesce(user_info.nns_region_code,dt1.region_code) as user_addr,addr_info.nns_addr_city,addr_info.user_addr_borough,addr_info.user_addr_town from
(select device_id,client_type,apk_version,factory_id,sp_id,user_id,region_code,server_time from ${PLATFORM_ID}.startup_log where day=${yesterday})dt1 join 
(select device_id,max(server_time) as last_time from ${PLATFORM_ID}.startup_log where day=${yesterday} group by device_id)dt2 on dt1.device_id=dt2.device_id and dt1.server_time=dt2.last_time
left join 
(select nns_id,if(length(nns_region_code)>=6,nns_region_code,null) as nns_region_code from ${PLATFORM_ID}.nns_user where day=${yesterday})user_info on dt1.user_id=user_info.nns_id
left join
(select nns_code,nns_addr_city,user_addr_borough,user_addr_town from ${PLATFORM_ID}.nns_address_code_extend where day=${yesterday})addr_info on user_info.nns_region_code=addr_info.nns_code 
)dt 
on history.device_id=dt.device_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180614093356923]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[version_sp_info]]></job_name> 
		<job_desc><![CDATA[version_sp_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.version_sp_info
select cast(apk_version as varchar(100)),cast(sp_id as varchar(100)) from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday} and apk_version is not null and sp_id is not null group by apk_version,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180613143932307]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_view_time]]></job_name> 
		<job_desc><![CDATA[day_view_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_view_time drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[1]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180611173520922]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[hour_view]]></job_name> 
		<job_desc><![CDATA[hour_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.hour_view drop partition(day=${day_last_3_1h}, minute=${minute_last_3_1h})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603192255528]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_user_time_sp_new]]></job_name> 
		<job_desc><![CDATA[day_user_time_sp_new]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_user_time_sp_new drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603185655528]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[hour_user_time_sp_new]]></job_name> 
		<job_desc><![CDATA[hour_user_time_sp_new]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.hour_user_time_sp_new where day=${day_last_10_1h} and minute=${minute_last_10_1h}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180531182139337]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_video_content_play]]></job_name> 
		<job_desc><![CDATA[day_video_content_play]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_video_content_play partition(day=${yesterday})
select 
tb1.video_id,max(tb1.video_name) as video_name,count(distinct tb1.play_sid) as cnt_play_times,max(nns_release_time) as release_time,tb1.sp_id 
from 
(select play_sid,user_id,video_id,video_name,sp_id from ${PLATFORM_ID}.play_log where day>=${today-3} and day<=${yesterday} and video_type='vod') tb1 join 
(select user_id,play_sid,sp_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-3} and day<=${today-1} and video_type='vod') tb2 on tb1.user_id=tb2.user_id and tb1.play_sid=tb2.play_sid and tb1.sp_id=tb2.sp_id left join 
(select nns_video_id,nns_release_time from ${PLATFORM_ID}.nns_assists_item where day=${yesterday}) tb3 on tb1.video_id=tb3.nns_video_id group by tb1.video_id,tb1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530180000003]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_sw_nns_company]]></job_name> 
		<job_desc><![CDATA[v2.17_day_sw_nns_company]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_sw_nns_company partition(day=${yesterday})
select
if(nns_third_id  is null,nns_second_id,nns_third_id) nns_id,
nns_first_id,nns_first_name,
nns_second_id,nns_second_name,
nns_third_id,nns_third_name,
if(nns_third_name  is null,nns_second_name,nns_third_name) nns_name
from ${PLATFORM_ID}.sw_nns_company where day=${yesterday} 
group by if(nns_third_id  is null,nns_second_id,nns_third_id),
nns_first_id,
nns_first_name,
nns_second_id,
nns_second_name,
nns_third_id,
nns_third_name,
if(nns_third_name  is null,nns_second_name,nns_third_name)
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530180000001]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-nmdp_time_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-nmdp_time_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.nmgdp_schema_5minute where day=${day_last_3_5m} and minute=${minute_last_3_5m}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530171000001]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16_day_view_user_time]]></job_name> 
		<job_desc><![CDATA[v2.16_day_view_user_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from hive.${PLATFORM_ID}.day_view_user_time where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530170000005]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_view_times_info]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_view_times_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from hive.${PLATFORM_ID}.day_twmz_view_times where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530170000004]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_view_users_info]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_view_users_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from hive.${PLATFORM_ID}.day_twmz_view_users where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530170000002]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[twmz_view_users_5minute_info]]></job_name> 
		<job_desc><![CDATA[twmz_view_users_5minute_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from hive.${PLATFORM_ID}.twmz_view_users_5minute where day=${day_last_3_5m} and minute=${minute_last_3_5m}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530170000001]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_all_info]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_all_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from hive.${PLATFORM_ID}.twmz_view_times_users where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180521101031755]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[nns_address_code_extend]]></job_name> 
		<job_desc><![CDATA[nns_address_code_extend]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.nns_address_code_extend drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180519161545320]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_user]]></job_name> 
		<job_desc><![CDATA[day_twmz_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_twmz_user drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180516231412753]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_app_user_total]]></job_name> 
		<job_desc><![CDATA[day_app_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_app_user_total drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180516224514540]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_content_user_total]]></job_name> 
		<job_desc><![CDATA[day_content_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_content_user_total drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180515232001998]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.12.3-user_addr_info]]></job_name> 
		<job_desc><![CDATA[v2.12.3-user_addr_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_addr_info partition(day=${yesterday})
select 
dt1.nns_id,
dt1.nns_region_code,
dt2.nns_addr_city,
dt2.user_addr_borough,
dt2.user_addr_town,
dt1.nns_user_type,
dt1.sp_id,
dt1.nns_create_time,
dt1.nns_stb_sn,
dt1.nns_name,
dt1.nns_addr
from 
(select nns_id,max(nns_name) nns_name,nns_addr,substr(max(nns_region_code),1,15) nns_region_code,max(nns_user_type) nns_user_type,max(nns_stb_sn) nns_stb_sn,from_unixtime(CAST(min(nns_create_time) / 1000 AS bigint), 'yyyy-MM-dd HH:mm:ss')  nns_create_time,sp_id from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_addr,sp_id)dt1 
left join (select nns_code,nns_addr_city,user_addr_borough,user_addr_town from ${PLATFORM_ID}.nns_address_code_extend where day=${yesterday} )dt2 on dt1.nns_region_code=dt2.nns_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180515231829124]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.12.3-user_addr_info_first-presto]]></job_name> 
		<job_desc><![CDATA[v2.12.3-user_addr_info_first-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 1 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.user_addr_info
select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,user_type,sp_id,nns_create_time,stb_id,user_name,user_addr_detail,${yesterday} 
from hive.${PLATFORM_ID}.user_addr_info where day=${today-2}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514215910232]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_total_summary]]></job_name> 
		<job_desc><![CDATA[day_total_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_total_summary drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514205556567]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[day_device_client_apk_addr_system]]></job_name> 
		<job_desc><![CDATA[day_device_client_apk_addr_system]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_device_client_apk_addr_system drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514205109913]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[week_device_client_apk_addr_system]]></job_name> 
		<job_desc><![CDATA[week_device_client_apk_addr_system]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_device_client_apk_addr_system drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514204421770]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[month_device_client_apk_addr_system]]></job_name> 
		<job_desc><![CDATA[month_device_client_apk_addr_system]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_device_client_apk_addr_system drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180427183152954]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.11.4-hour_content_live_video_playbill_time_interval]]></job_name> 
		<job_desc><![CDATA[v2.11.4-hour_content_live_video_playbill_time_interval]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table  ${PLATFORM_ID}.hour_content_live_video_playbill_time_interval drop partition(day=${yesterday});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180426190608413]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.11-day_view]]></job_name> 
		<job_desc><![CDATA[v2.11-day_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_view partition(day=${yesterday})
select
user_addr,
user_addr_city,
apk_version,
event_value['page_type'],
target_page_id_1,
dt2.user_id,
sp_id,
stb_id,
user_name,
user_addr_city,
user_addr_borough,
user_addr_town
from
(select session_id,event_value,target_page_id_1,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select tab1.session_id,tab1.user_id,tab1.apk_version from 
(select session_id,user_id,apk_version,row_number() over(partition by session_id order by user_id desc) as depth from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,apk_version)tab1 where  depth=1 group by tab1.session_id,tab1.user_id,tab1.apk_version) dt2
on dt1.session_id=dt2.session_id
    left join
(select user_id,user_name,user_addr,user_addr_city,stb_id,user_addr_borough,user_addr_town from ${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
user_addr,
user_addr_city,
apk_version,
event_value['page_type'],
target_page_id_1,
dt2.user_id,
stb_id,
user_name,
user_addr_borough,
user_addr_town,
sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180415100128996]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_user_device_client_apk_sp_start_info]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_user_device_client_apk_sp_start_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_user_device_client_apk_sp_start_info drop partition(day=${yesterday});
alter table ${PLATFORM_ID}.day_user_info drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180403161337445]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_view_time_apk_sp_page_block_content]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_view_time_apk_sp_page_block_content]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_view_time_apk_sp_page_block_content drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180328204715881]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.6-day_view_time_addr_apk_type_page]]></job_name> 
		<job_desc><![CDATA[v2.9.6-day_view_time_addr_apk_type_page]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_view_time_addr_apk_type_page drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323192704506]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-month_home_path_statistics]]></job_name> 
		<job_desc><![CDATA[v2.10.1-month_home_path_statistics]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 4 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.month_home_path_statistics drop partition(day=${last_month})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323191610202]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-week_home_path_statistics]]></job_name> 
		<job_desc><![CDATA[v2.10.1-week_home_path_statistics]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.week_home_path_statistics drop partition(day=${today-7})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323190338414]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-day_home_path_statistics]]></job_name> 
		<job_desc><![CDATA[v2.10.1-day_home_path_statistics]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_home_path_statistics drop partition(day=${yesterday})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180322223348389]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V2.17.9-day_user_total]]></job_name> 
		<job_desc><![CDATA[V2.17.9-day_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_total partition(day=${yesterday})
select count(distinct nns_id),sp_id from ${PLATFORM_ID}.nns_user where day=${yesterday} and nns_state = 0  
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<=${yesterday} group by sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180314102037564]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.2-week_quality_play_time_addr_apk_video_type_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.8.2-week_quality_play_time_addr_apk_video_type_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_addr_apk_video_type_terminaltype partition(day=${today-7})
select
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
video_type,
client_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(if(ready_time<0 or ready_time>1000*300,0,ready_time))/(60.0*1000),6)
from
(select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
dt1.video_id,
dt3.video_name,
video_type,
client_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_id,video_name,video_type,client_type,apk_version,event_type,server_time,play_sid,duration,region_code from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid left join (select video_id,video_name from (select video_id,video_name,row_number() over(partition by video_id order by num desc) as depth from (select video_id,video_name,count(1) num from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday} group by video_id,video_name)dt0)dt where depth=1)dt3 on dt1.video_id=dt3.video_id left join (select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,
nns_addr_city,
apk_version,
dt1.video_id,
dt3.video_name,
video_type,
client_type,user_id,play_sid) dt
group by
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
video_type,
client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180314101537686]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.2-day_quality_play_time_addr_apk_video_type_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.8.2-day_quality_play_time_addr_apk_video_type_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_addr_apk_video_type_terminaltype partition(day=${yesterday})
select
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
video_type,
client_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(if(ready_time<0 or ready_time>1000*300,0,ready_time))/(60.0*1000),6),
sp_id
from
(select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
dt1.video_id,
dt3.video_name,
video_type,
client_type,
user_id,
dt1.sp_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_id,video_name,video_type,client_type,apk_version,event_type,server_time,play_sid,duration,sp_id,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid left join (select video_id,sp_id,video_name from (select video_id,video_name,sp_id,row_number() over(partition by video_id,sp_id order by num desc) as depth from (select video_id,video_name,sp_id,count(1) num from ${PLATFORM_ID}.play_log where day=${yesterday} group by video_id,video_name,sp_id)dt0)dt where depth=1)dt3 on dt1.video_id=dt3.video_id and dt1.sp_id=dt3.sp_id left join
(select nns_id,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id) dt2 on dt1.user_id=dt2.nns_id
group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,
nns_addr_city,
apk_version,
dt1.video_id,
dt3.video_name,
video_type,
client_type,user_id,dt1.sp_id,play_sid) dt
group by
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
video_type,
client_type,
sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180208152631402]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_content_time_addr_apk_video_category_mode_asset_cp_playbill_terminaltype_gender_age_user]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_content_time_addr_apk_video_category_mode_asset_cp_playbill_terminaltype_gender_age_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
cp as
(
select dt1.nns_id as nns_vod_id,dt1.nns_area,dt1.nns_kind,nns_vod_index_id,nns_mode,dt3.nns_id media_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.nns_view_type,dt1.sp_id from
(select nns_id,nns_area,nns_kind,nns_cp,nns_view_type,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
left join
(select nns_id,nns_vod_id,nns_vod_index_id,nns_mode,sp_id from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt3
on dt1.nns_id=dt3.nns_vod_id and dt1.sp_id=dt3.sp_id
group by dt1.nns_id,dt1.nns_area,dt1.nns_kind,nns_vod_index_id,nns_mode,dt3.nns_id,dt2.nns_id,nns_cp,dt1.nns_view_type,dt1.sp_id
)
insert overwrite table ${PLATFORM_ID}.day_content_time_addr_apk_video_category_mode_asset_cp_playbill_terminaltype_gender_age_user partition(day=${yesterday})
select
dt.video_type,
dt.ncode,
dt.ncity,
dt.apk_version,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.nmode,
dt.asset_id,
dt.an,
dt.cid,
dt.cpn,
dt.playbill_id,
dt.playbill_name,
dt.client_type,
dt.gender,
dt.age,
null,
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
dt.nns_area,
dt.nns_kind,
dt.nns_view_type
from
(select
video_type,
if(length(nns_addr_code)>6,nns_addr_code,region_code) ncode,
nns_addr_city ncity,
apk_version,
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
cp.nns_mode nmode,
asset_id,
dt3.nns_name an,
cp.nns_cp_id cid,
cp.nns_cp cpn,
cp.nns_view_type,
if(video_type!='live',item.nns_id,null) playbill_id,
if(video_type!='live',item.nns_name,null) playbill_name,
dt1.client_type,
nns_sex gender,
if(1<=nns_age_cal and nns_age_cal<=10,'1',if(11<=nns_age_cal and nns_age_cal<=20,'11',if(21<=nns_age_cal and nns_age_cal<=30,'21',if(31<=nns_age_cal and nns_age_cal<=40,'31',if(41<=nns_age_cal and nns_age_cal<=50,'41',if(51<=nns_age_cal and nns_age_cal<=60,'51',if(61<=nns_age_cal and nns_age_cal<=70,'61',if(71<=nns_age_cal and nns_age_cal<=80,'71',if(81<=nns_age_cal and nns_age_cal<=90,'81','91'))))))))) age,
play_sid,
playbill_start_time,
playbill_length,
dt1.sp_id,
cp.nns_area,
cp.nns_kind,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id left join
cp on dt1.video_id=cp.nns_vod_id and dt1.episode_id=cp.nns_vod_index_id and dt1.media_id=cp.media_id and dt1.sp_id=cp.sp_id left join 
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.sp_id=item.sp_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time
group by video_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,video_id,video_name,category_id,dt3.nns_category_name,cp.nns_mode, asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,if(video_type!='live',item.nns_id,null),if(video_type!='live',item.nns_name,null),dt1.client_type,nns_sex,if(1<=nns_age_cal and nns_age_cal<=10,'1',if(11<=nns_age_cal and nns_age_cal<=20,'11',if(21<=nns_age_cal and nns_age_cal<=30,'21',if(31<=nns_age_cal and nns_age_cal<=40,'31',if(41<=nns_age_cal and nns_age_cal<=50,'41',if(51<=nns_age_cal and nns_age_cal<=60,'51',if(61<=nns_age_cal and nns_age_cal<=70,'61',if(71<=nns_age_cal and nns_age_cal<=80,'71',if(81<=nns_age_cal and nns_age_cal<=90,'81','91'))))))))),play_sid,playbill_start_time,playbill_length,dt1.sp_id,cp.nns_area,cp.nns_kind,cp.nns_view_type) dt
group by
dt.video_type,
dt.ncode,
dt.ncity,
dt.apk_version,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.nmode,
dt.asset_id,
dt.an,
dt.cid,
dt.cpn,
dt.playbill_id,
dt.playbill_name,
dt.client_type,
dt.gender,
dt.age,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
dt.nns_area,
dt.nns_kind,
dt.nns_view_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206220128484]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-content_time_video_apk_sp_addr_client_drag_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-content_time_video_apk_sp_addr_client_drag_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.content_time_video_apk_sp_addr_client_drag_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206212155528]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_user_time_new]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_user_time_new]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		replace into ${PLATFORM_ID}.hour_user_time_new
select 
floor(avg(cnt_user_online)),
max(cnt_user_online),
${day_last_10_1h},
${minute_last_10_1h} 
from ${PLATFORM_ID}.user_time_5minute 
where ${where_last_10_1h}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206192640996]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb2_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb2_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.usercomb2_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206185930259]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[quality_play_time_addr_apk_video_type_terminaltype_5minute]]></job_name> 
		<job_desc><![CDATA[quality_play_time_addr_apk_video_type_terminaltype_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.quality_play_time_addr_apk_video_type_terminaltype_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206180026105]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-user_time_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-user_time_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.user_time_5minute where day=${day_last_3_5m} and minute=${minute_last_3_5m}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206164421202]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-user_time_addr_apk_terminaltype_gender_age_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-user_time_addr_apk_terminaltype_gender_age_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.user_time_addr_apk_terminaltype_gender_age_5minute where day=${day_last_3_5m} and minute=${minute_last_3_5m}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206162838324]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-content_time_user_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-content_time_user_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.content_time_user_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206161919763]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-view_time_video_category_asset_cp_sp_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-view_time_video_category_asset_cp_sp_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.view_time_video_category_asset_cp_sp_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206161020823]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_device_time_online_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_device_time_online_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.day_device_time_online1 drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206151113096]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_user_time_new]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_user_time_new]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_user_time_new
select 
cast(avg(cnt_user_online) as bigint),max(cnt_user_online),${yesterday} 
from mysql.${PLATFORM_ID}.user_time_5minute 
where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206143931669]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb1_5minute]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb1_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.usercomb1_5minute drop partition(day=${day_last_3_5m}, minute=${minute_last_3_5m})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206111304030]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_content_time_hotdate_video_apk_sex_client]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_content_time_hotdate_video_apk_sex_client]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_hotdate_video_apk_sex_client partition(day=${yesterday})
select
hotdate,
'live',
video_id,
video_name,
apk_version,
nns_sex,
client_type,
count(distinct if(cnt_play_length>1.0,user_id,null)),
count(distinct user_id),
sum(cnt_play_length),
nns_addr_code,
nns_addr_city,
sp_id
from
(select
dt.hotdate,
dt.video_id,
dt.video_name,
dt.apk_version,
dt.nns_sex,
dt.client_type,
dt.user_id,
dt.nns_addr_code,
dt.nns_addr_city,
dt.sp_id,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
cast(minute as int)-cast(minute as int)%100%30 as hotdate,
video_id,
video_name,
apk_version,
dt1.client_type,
nns_sex,
user_id,
play_sid,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
dt1.sp_id,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from
(select * from ${PLATFORM_ID}.play_log where day=${yesterday} and minute>='1830' and minute<'2200' and video_type='live') dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select nns_id,nns_sex,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on user_id=dt2.nns_id
group by
cast(minute as int)-cast(minute as int)%100%30,video_id,video_name,apk_version,dt1.client_type,nns_sex,user_id,play_sid,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,dt1.sp_id) dt
group by
dt.hotdate,
dt.video_id,
dt.video_name,
dt.apk_version,
dt.client_type,
dt.nns_sex,
dt.user_id,
dt.nns_addr_code,
dt.nns_addr_city,
dt.sp_id) dtt
group by hotdate,video_id,video_name,apk_version,nns_sex,client_type,nns_addr_code,nns_addr_city,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206104701790]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_content_time_video_playbill_category_asset_addr_apk]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_content_time_video_playbill_category_asset_addr_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_playbill_category_asset_addr_apk partition(day=${yesterday})
select video_type,video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
nns_addr_code,
nns_addr_city,
apk_version,
count(distinct if(cnt_play_length>1.0,user_id,null)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id,
client_type,
nns_sex,
age
from 
(select dt1.video_type,dt1.video_id,
dt1.video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
dt1.user_id,
dt1.play_sid,
dt1.playbill_start_time,
dt1.playbill_length,
dt1.sp_id,
dt1.client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40','40+'))) age,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,asset_id,max(server_time) end_time,min(server_time) start_time,apk_version,playbill_length,playbill_start_time,play_sid,sp_id,client_type,video_type,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type in ('live','playback') group by user_id,video_id,video_name,category_id,asset_id,apk_version,playbill_length,playbill_start_time,play_sid,sp_id,client_type,video_type)dt1 left join(select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type in ('live','playback') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select nns_id,nns_addr_code,nns_addr_city,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt3 on dt1.user_id=dt3.nns_id left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and dt1.sp_id=item.sp_id 
group by dt1.video_type,dt1.video_id,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,dt1.user_id,dt1.play_sid,dt1.playbill_start_time,dt1.playbill_length,dt1.sp_id,dt1.client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40','40+'))))dt group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,nns_addr_code,nns_addr_city,apk_version,playbill_start_time,playbill_length,sp_id,client_type,nns_sex,age
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206101844846]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb2_hour]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb2_hour]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		alter table ${PLATFORM_ID}.usercomb2_hour drop partition(day=${day_last_3_1h}, minute=${minute_last_3_1h})
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205204856548]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_view_time_addr_apk_type_page]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_view_time_addr_apk_type_page]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.hour_view_time_addr_apk_type_page where day=${day_last_3_1h} and minute=${minute_last_3_1h}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205204247880]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_view_time]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_view_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.hour_view_time where day=${day_last_3_1h} and minute=${minute_last_3_1h}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205202928792]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_user_time]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_user_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.hour_user_time where day=${day_last_3_1h} and minute=${minute_last_3_1h}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180202183241079]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-day_pay_time_duration_slot]]></job_name> 
		<job_desc><![CDATA[v2.9.5-day_pay_time_duration_slot]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_pay_time_duration_slot partition(day=${yesterday})
select 
pay_duration pay_interval,
null pay_time_slot,
count(distinct user_id) cnt_order_pay_user_total,
sum(order_price) cnt_order_pay_money_total,
count(1) cnt_order_pay_total,
cp_id,nns_boss_area_bind,sp_id 
from 
(select user_id,order_price,cp_id,sp_id,case when (modify_time-create_time)/60000 <1 then '0-1m' when (modify_time-create_time)/60000 <5 and (modify_time-create_time)/60000 >=1 then '1-5m'  when (modify_time-create_time)/60000 <30 and (modify_time-create_time)/60000 >=5 then '5-30m' when (modify_time-create_time)/60000 <120 and (modify_time-create_time)/60000 >=30 then '0.5-2h' when (modify_time-create_time)/60000 <1440 and (modify_time-create_time)/60000 >=120 then '2-24h' else '>1d' end pay_duration,nns_boss_area_bind from ${PLATFORM_ID}.day_sales_basic_data where day=${yesterday} and nns_order_state = 1)dt 
group by pay_duration,cp_id,nns_boss_area_bind,sp_id 
union all
select 
null pay_interval,
pay_time_slot,
count(distinct user_id) cnt_order_pay_user_total,
sum(order_price) cnt_order_pay_money_total,
count(1) cnt_order_pay_total,cp_id,nns_boss_area_bind,sp_id 
 from (select user_id,order_price,cp_id,sp_id,concat(from_unixtime(cast(modify_time/1000 as bigint),'HH'),':','00') pay_time_slot,nns_boss_area_bind from ${PLATFORM_ID}.day_sales_basic_data where day=${yesterday} and nns_order_state = 1)dt group by pay_time_slot,cp_id,nns_boss_area_bind,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180202180951669]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-month_pay_time_product_video_channel_type_addr]]></job_name> 
		<job_desc><![CDATA[v2.9.5-month_pay_time_product_video_channel_type_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 06 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert overwrite table ${PLATFORM_ID}.month_pay_time_product_video_channel_type_addr partition(day=${last_month})
select null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
coalesce(dt1.sp_id,dt2.sp_id) sp_id,
cnt_order_place_total,
cnt_order_place_user_total,
cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
cnt_order_pay_history_total,
cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
cnt_order_place_total_last,
cnt_order_place_user_total_last,
cnt_order_place_money_total_last,
null user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind
from (select nns_boss_area_bind,sp_id,sum(if(nns_order_state=1,1,0)) cnt_order_pay_history_total,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${month-2}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${last_month}' then 1 else 0 end) cnt_order_place_total_last,
count(distinct case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${month-2}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${last_month}' then nns_user_id else null end) cnt_order_place_user_total_last,
sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') >= '${month-2}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${last_month}' then nns_order_price else 0 end) cnt_order_place_money_total_last,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${last_month}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then 1 else 0 end) cnt_order_place_total,count(distinct case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${last_month}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then nns_user_id else null end) cnt_order_place_user_total,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') >= '${last_month}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then nns_order_price else 0 end) cnt_order_place_money_total from (select * from ${PLATFORM_ID}.nns_buy_order where day=${today-1})a left join user on a.nns_user_id=user.nns_id group by sp_id,nns_boss_area_bind)dt1 full outer join (select sp_id,nns_boss_area_bind,count(1) cnt_active_user_total from (select sp_id,uid from ${PLATFORM_ID}.valid where day >= ${last_month} and day<=${today-1} group by uid,sp_id)b left join user on b.uid=user.nns_id group by sp_id,nns_boss_area_bind)dt2 on dt1.sp_id=dt2.sp_id and dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
union all
select  product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id,
sum(case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')>= '${last_month}' and from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then 1 else 0 end) cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total,
count(distinct case when is_new = 1 then user_id else null end) cnt_order_pay_new_user_total,
count(distinct case when nns_order_state = 5 then user_id else null end)  cnt_unsubscribe_user_total,
count(distinct case when is_active = 1 then user_id else null end) cnt_active_order_user_total,
null  cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')>= '${last_month}' and from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' and nns_order_state != 1 then user_id else null end) cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
null user_id_last,
cp_id,
count(case when nns_order_state = 5 then user_id else null end)  cnt_order_unsubscribe_total,
nns_boss_area_bind
from ${PLATFORM_ID}.day_sales_basic_data where day >= ${last_month} and day<=${today-1} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind
union all
select 
product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
null cnt_order_place_nopay_total, 
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total_last,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total_last,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
null user_id_last,
cp_id,
null cnt_order_unsubscribe_total,
nns_boss_area_bind
from ${PLATFORM_ID}.day_sales_basic_data where day >= ${month-2} and day<${last_month} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
null nns_boss_area_bind
from (select sp_id,user_id from  ${PLATFORM_ID}.usercomb1_day where day >= ${last_month} and day<=${today-1} group by sp_id,user_id) a
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
null nns_boss_area_bind
from (select sp_id,user_id as user_id_last from  ${PLATFORM_ID}.usercomb1_day where day >= ${month-2} and day<${last_month} group by sp_id,user_id) b
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180202180433175]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-week_pay_time_product_video_channel_type_addr]]></job_name> 
		<job_desc><![CDATA[v2.9.5-week_pay_time_product_video_channel_type_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 05 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert overwrite table ${PLATFORM_ID}.week_pay_time_product_video_channel_type_addr partition(day=${today-7})
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
coalesce(dt1.sp_id,dt2.sp_id) sp_id,
cnt_order_place_total,
cnt_order_place_user_total,
cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total, 
cnt_order_pay_history_total,
cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total, 
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
cnt_order_place_total_last,
cnt_order_place_user_total_last,
cnt_order_place_money_total_last,
null user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind
from (select nns_boss_area_bind,sp_id,sum(if(nns_order_state = 1,1,0)) cnt_order_pay_history_total,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-7}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then 1 else 0 end) cnt_order_place_total,count(distinct case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-7}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then nns_user_id else null end) cnt_order_place_user_total,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-7}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' then nns_order_price else 0 end) cnt_order_place_money_total,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-14}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${today-7}' then 1 else 0 end) cnt_order_place_total_last,count(distinct case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-14}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${today-7}' then nns_user_id else null end) cnt_order_place_user_total_last,sum(case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>= '${today-14}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<'${today-7}' then nns_order_price else 0 end) cnt_order_place_money_total_last from (select * from ${PLATFORM_ID}.nns_buy_order where day=${today-1})a left join user on a.nns_user_id=user.nns_id group by sp_id,nns_boss_area_bind)dt1 full outer join (select sp_id,nns_boss_area_bind,count(1) cnt_active_user_total from (select sp_id,uid from ${PLATFORM_ID}.valid where day >= ${today-7} and day<=${today-1} group by uid,sp_id)b left join user on b.uid=user.nns_id group by sp_id,nns_boss_area_bind)dt2 on dt1.sp_id=dt2.sp_id and dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
union all
select 
product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id, 
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')>= '${today-7}' and from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' and is_new = 1 then user_id else null end) cnt_order_place_new_user_total,
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total,
count(distinct case when is_new = 1 then user_id else null end) cnt_order_pay_new_user_total,
count(distinct case when nns_order_state = 5 then user_id else null end)  cnt_unsubscribe_user_total,
count(distinct case when is_active = 1 then user_id else null end) cnt_active_order_user_total,
null  cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
count(distinct case when from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')>= '${today-7}' and from_unixtime(cast(create_time/1000 as bigint),'yyyyMMdd')<='${today-1}' and nns_order_state != 1 then user_id else null end) cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
null user_id_last,
cp_id,
count(case when nns_order_state = 5 then user_id else null end)  cnt_order_unsubscribe_total,
nns_boss_area_bind
from ${PLATFORM_ID}.day_sales_basic_data where day >= ${today-7} and day<=${today-1} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind
union all
select 
product_id,
product_name,
video_id,
video_name,
pay_channel_id,
product_type,
addr_code,
addr_name,
client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
apk_version,
null cnt_order_place_nopay_total, 
sum(case when nns_order_state = 1 then 1 else 0 end) cnt_order_pay_total_last,
count(distinct case when nns_order_state = 1 then user_id else null end) cnt_order_pay_user_total_last,
sum(case when nns_order_state = 1 then order_price else 0 end) cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
null user_id_last,
cp_id,
null cnt_order_unsubscribe_total,
nns_boss_area_bind
from ${PLATFORM_ID}.day_sales_basic_data where day >= ${today-14} and day<${today-7} group by product_id,product_name,video_id,video_name,pay_channel_id,product_type,addr_code,addr_name,client_type,sp_id,apk_version,cp_id,nns_boss_area_bind
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
user_id,
null user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
null nns_boss_area_bind
from (select sp_id,user_id from  ${PLATFORM_ID}.usercomb1_day where day >= ${today-7} and day<=${today-1} group by sp_id,user_id) a
union all
select 
null product_id,
null product_name,
null video_id,
null video_name,
null pay_channel_id,
null product_type,
null addr_code,
null addr_name,
null client_type,
sp_id,
null cnt_order_place_total,
null cnt_order_place_user_total,
null cnt_order_place_money_total,
null cnt_order_place_new_user_total,
null cnt_order_pay_total,
null cnt_order_pay_user_total,
null cnt_order_pay_money_total,
null cnt_order_pay_new_user_total,
null cnt_unsubscribe_user_total,
null cnt_active_order_user_total,
null cnt_order_pay_history_total,
null cnt_active_user_total,
null apk_version,
null cnt_order_place_nopay_total,
null cnt_order_pay_total_last,
null cnt_order_pay_user_total_last,
null cnt_order_pay_money_total_last,
null cnt_order_place_total_last,
null cnt_order_place_user_total_last,
null cnt_order_place_money_total_last,
null user_id,
user_id_last,
null cp_id,
null cnt_order_unsubscribe_total,
null nns_boss_area_bind
from (select sp_id,user_id as user_id_last from  ${PLATFORM_ID}.usercomb1_day where day >= ${today-14} and day<${today-7} group by sp_id,user_id) b
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180202101840750]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-delete data retained only for 7 days]]></job_name> 
		<job_desc><![CDATA[v2.8.1-delete data retained only for 7 days]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		${PLATFORM_ID}.hour_view;
${PLATFORM_ID}.usercomb2_hour;
${PLATFORM_ID}.hour_user_time;
${PLATFORM_ID}.hour_valid;
${PLATFORM_ID}.hour_content_time_user;
${PLATFORM_ID}.hour_user_time_new;
${PLATFORM_ID}.hour_abtest_schema;
${PLATFORM_ID}.hour_abtest_schema_item_tag;
${PLATFORM_ID}.hour_content_time_video;
${PLATFORM_ID}.hour_user_time_age;
${PLATFORM_ID}.usercomb1_hour;
${PLATFORM_ID}.hour_user_time_addr_apk_terminaltype_gender_age;
${PLATFORM_ID}.day_device_time_online1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/del-partitions.sh ${run_id} ${run_time} 7]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180202101803355]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-delete data retained only for 3 days]]></job_name> 
		<job_desc><![CDATA[v2.8.1-delete data retained only for 3 days]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		${PLATFORM_ID}.user_time_5minute;
${PLATFORM_ID}.content_time_user_5minute;
${PLATFORM_ID}.abtest_schema_item_tag_5minute;
${PLATFORM_ID}.usercomb1_5minute;
${PLATFORM_ID}.user_time_addr_apk_terminaltype_gender_age_5minute;
${PLATFORM_ID}.content_time_video_apk_sp_addr_client_drag_5minute;
${PLATFORM_ID}.quality_play_time_addr_apk_video_type_terminaltype_5minute
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/del-partitions.sh ${run_id} ${run_time} 3]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180201183317582]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-page_view_user_5minute]]></job_name> 
		<job_desc><![CDATA[v2.9.5-page_view_user_5minute]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 4/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.page_view_user_5minute partition(${partition_last_4_5m})
select 
dt1.target_page_id_1 page_id,
dt2.user_id,
dt2.apk_version,
nns_addr_code,
sum(1) cnt_page_view,
dt1.sp_id,
dt4.user_addr,
dt4.user_addr_city,
dt4.user_addr_borough,
dt4.user_addr_town
from 
(select session_id,sp_id,target_page_id_1 from ${PLATFORM_ID}.user_log where ${where_last_4_5m} and event_name='open_page') dt1  
left join
 (select tab1.session_id,tab1.user_id,tab1.apk_version,tab1.sp_id from 
(select session_id,user_id,apk_version,sp_id,row_number() over(partition by session_id order by user_id desc) as depth from ${PLATFORM_ID}.session_log where day=${today} group by session_id,user_id,apk_version,sp_id)tab1 where  depth=1 group by tab1.session_id,tab1.user_id,tab1.apk_version,tab1.sp_id)dt2
on dt1.session_id = dt2.session_id and dt1.sp_id = dt2.sp_id 
left join (select nns_id,nns_addr_code from ${PLATFORM_ID}.nns_user where day=${yesterday})dt3 on dt2.user_id = dt3.nns_id
left join
(select * from ${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by dt1.target_page_id_1,
dt2.user_id,
dt2.apk_version,
nns_addr_code,
dt1.sp_id,
dt4.user_addr,
dt4.user_addr_city,
dt4.user_addr_borough,
dt4.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180201154903386]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-day_vod_content_cnt]]></job_name> 
		<job_desc><![CDATA[v2.9.5-day_vod_content_cnt]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_vod_content_cnt partition(day=${today-1})
select
'vod',
null,
null,
null,
null,
dt4.nns_id,
dt3.nns_cp,
dt3.nns_kind,
(count(1)-sum(cnt_vod_content_del)) cnt_vod_content_total,
sum(cnt_vod_content_add) cnt_vod_content_add,
sum(cnt_vod_content_del) cnt_vod_content_del,
dt3.sp_id
from
(select coalesce(dt1.nns_id,dt2.nns_id) nns_id,coalesce(dt1.nns_kind,dt2.nns_kind) nns_kind,coalesce(dt1.nns_cp,dt2.nns_cp) nns_cp,coalesce(dt1.sp_id,dt2.sp_id) sp_id,if(dt2.nns_id is null,1,0) cnt_vod_content_add,
if(dt1.nns_id is null,1,0) cnt_vod_content_del from (select nns_id,nns_kind,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1 
full outer join 
(select nns_id,nns_kind,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${today-2}) dt2 
on dt1.nns_id = dt2.nns_id and dt1.sp_id=dt2.sp_id) dt3 
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt4
on dt3.nns_cp=dt4.nns_name and dt3.sp_id=dt4.sp_id
group by
dt4.nns_id,
dt3.nns_cp,
dt3.nns_kind,
dt3.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180131093613418]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.3-user_time_addr_gender_age_day]]></job_name> 
		<job_desc><![CDATA[v2.9.3-user_time_addr_gender_age_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_addr_gender_age_day partition(day=${yesterday})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
nns_sex,
if( nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65','65+')))),
count(distinct case when nns_state=0 then nns_id else null end),
count(distinct case when from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${yesterday}' and nns_state=0 then nns_id else null end),
count(distinct case when from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}' and nns_state=4 then nns_id else null end),
dt1.sp_id,
apk_version,
client_type,
nns_from_value
from
(select nns_id,nns_state,nns_create_time,nns_sex,nns_addr_city, nns_age_cal,nns_addr_code,nns_modify_time,nns_user_from nns_from_value,sp_id from ${PLATFORM_ID}.nns_user where day = ${yesterday} and nns_id is not null 
group  by nns_id,nns_state ,nns_create_time,nns_sex,nns_addr_city,nns_age_cal,nns_addr_code, nns_modify_time,nns_user_from,sp_id  ) dt1
left join
(select d1.user_id,apk_version,client_type,region_code from
(select user_id,apk_version,client_type,server_time from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) d1
join 
(select user_id,min(server_time) earliest_time,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by user_id) d2
on d1.user_id=d2.user_id and d1.server_time=d2.earliest_time) dt2
on dt1.nns_id=dt2.user_id
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,nns_sex,if( nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65','65+')))),dt1.sp_id,apk_version,client_type,nns_from_value
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180124124516536]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.9.2-day_view_page_user]]></job_name> 
		<job_desc><![CDATA[v2.9.2-day_view_page_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.day_view_page_user
SELECT 
dt.user_id,
dt.device_id,
substr(dt4.user_addr,1,9),
dt.sp_id,
dt.apk_version,
dt.client_type,
dt.page_id,
${yesterday},
dt4.user_addr,
dt4.user_addr_city,
dt4.user_addr_borough,
dt4.user_addr_town
from 
(select 
device_id,
client_type,
apk_version,
sp_id,
user_id,
page_id
from 
(select 
device_id,client_type,apk_version,sp_id,user_id,target_page_id_1 page_id
from ${PLATFORM_ID}.user_log_all where day=${yesterday} and target_page_id_1 is not null and event_name='open_page') dt1
group by device_id,client_type,apk_version,sp_id,user_id,page_id)dt 
left join 
(select user_id,device_id,page_id from ${PLATFORM_ID}.day_view_page_user 
where day<${yesterday} group by user_id,device_id,page_id) dt0 
on dt.user_id = dt0.user_id and dt.page_id = dt0.page_id 
left join
(select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town from ${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt4 on dt.user_id=dt4.user_id
where dt0.user_id is null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180112120037152]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.0-day_pay_graphx_sp_apk_client]]></job_name> 
		<job_desc><![CDATA[v2.7.0-day_pay_graphx_sp_apk_client]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_pay_graphx_sp_apk_client partition(day=${yesterday})
select source_page_id_1 source,if(event_value['pay_status'] is not null,concat(target_page_id_1,'-',event_value['pay_status']),target_page_id_1) target,sp_id,apk_version,client_type,count(1) from (select dt1.*,dt3.apk_version,dt3.client_type from (select * from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name = 'pay')dt1 left join (select session_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_value['pay_status'] is not null group by session_id)dt2 on dt1.session_id = dt2.session_id left join (select session_id,apk_version,client_type from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,apk_version,client_type)dt3 on dt1.session_id = dt3.session_id where dt2.session_id is not null) dt group by source_page_id_1,if(event_value['pay_status'] is not null,concat(target_page_id_1,'-',event_value['pay_status']),target_page_id_1),sp_id,apk_version,client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180110191859612]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.4-report_month_info]]></job_name> 
		<job_desc><![CDATA[v2.8.4-report_month_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[sh  /opt/starcor-analyzer/starcor_realtime/bin/startRealtimeSparkDriver.sh -c com.starcor.Main -m local -n live_playbillInfo_offline_task -g offline,${PLATFORM_ID},ComprehensiveReport,month,${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180110191703704]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.4-report_week_info]]></job_name> 
		<job_desc><![CDATA[v2.8.4-report_week_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/starcor-analyzer/starcor_realtime/bin/startRealtimeSparkDriver.sh -c com.starcor.Main -m local -n live_playbillInfo_offline_task -g offline,${PLATFORM_ID},ComprehensiveReport,week,${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180110191509375]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.4-online_user_max]]></job_name> 
		<job_desc><![CDATA[v2.8.4-online_user_max]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/starcor-analyzer/starcor_realtime/bin/startRealtimeSparkDriver.sh -c com.starcor.Main -m local -n live_playbillInfo_offline_task -g offline,${PLATFORM_ID},OnlineUserMax]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180110191238992]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.4-user_num_task]]></job_name> 
		<job_desc><![CDATA[v2.8.4-user_num_task]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/starcor-analyzer/starcor_realtime/bin/startRealtimeSparkDriver.sh -c com.starcor.Main -m local -n live_playbillInfo_offline_task -g offline,${PLATFORM_ID},UserNumTask]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180110191132333]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.4-playbill_info_task]]></job_name> 
		<job_desc><![CDATA[v2.8.4-playbill_info_task]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/starcor-analyzer/starcor_realtime/bin/startRealtimeSparkDriver.sh -c com.starcor.Main -m local -n live_playbillInfo_offline_task -g offline,${PLATFORM_ID},PlayBillInfoTask]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171226095056841]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.5-add partitions for log-table]]></job_name> 
		<job_desc><![CDATA[v2.16.5-add partitions for log-table]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		${PLATFORM_ID}.heartbeat_log;
${PLATFORM_ID}.error_log;
${PLATFORM_ID}.startup_log;
${PLATFORM_ID}.play_log;
${PLATFORM_ID}.speed_log;
${PLATFORM_ID}.user_log;
${PLATFORM_ID}.performance_log;
${PLATFORM_ID}.session_log;
${PLATFORM_ID}.day_log_report_record;
${PLATFORM_ID}.ip_play_log;
${PLATFORM_ID}.hd_user_log
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/add-partitions.sh ${run_id} ${run_time} ${tomorrow}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171224151016118]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.3- week_loss_user_decline_index]]></job_name> 
		<job_desc><![CDATA[v2.8.3- week_loss_user_decline_index]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 05 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_length partition(day=${yesterday})
select
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sum(min),
sp_id,
network_type
from(
select
user_id,
nns_name,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
dt1.sp_id,
network_type,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
count(distinct user_id) min
from
(select user_id,apk_version,client_type,server_time,sp_id,network_type,region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1
left join
(select nns_id,nns_name,nns_addr_code,nns_addr_city,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2
on dt1.user_id=dt2.nns_id 
group by
user_id,
nns_name,
if(length(nns_addr_code)>6,nns_addr_code,region_code),
nns_addr_city,
apk_version,
client_type,
nns_sex,
dt1.sp_id,
network_type,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
cast(server_time/(60*1000) as bigint)) dt
group by
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sp_id,
network_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171221203113466]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V2.8.3-day_loss_user_index]]></job_name> 
		<job_desc><![CDATA[V2.8.3-day_loss_user_index]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[03 03 06 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_loss_user_index partition(day=${yesterday})
select sp_id, 
CNT_USER_RECURRING_total_7DAYS, 
CNT_USER_LOSS_TOTAL_7DAYS, 
total_num_before_7days, 
RATE_USER_LOSS_TOTAL_7DAYS, 
cnt_user_loss_play24_7days,
rate_user_loss_play24_7days,
null CNT_USER_RECURRING_total_30DAYS, 
null CNT_USER_LOSS_TOTAL_30DAYS, 
null total_num_before_30days, 
null RATE_USER_LOSS_TOTAL_30DAYS, 
null cnt_user_loss_play24_30days, 
null rate_user_loss_play24_30days from(
select 
            dt3.sp_id, 
CNT_USER_RECURRING_total_7DAYS, 
CNT_USER_LOSS_TOTAL_7DAYS, 
total_num_before_7days, 
RATE_USER_LOSS_TOTAL_7DAYS, 
cnt_user_loss_play24_7days,
round(cnt_user_loss_play24_7days/CNT_USER_LOSS_TOTAL_7days,6) as rate_user_loss_play24_7days
from ( 
   select dt2.sp_id, CNT_USER_RECURRING_total_7DAYS, CNT_USER_LOSS_TOTAL_7days, total_num_before_7days, RATE_USER_LOSS_TOTAL_7DAYS from (
        select sp_id,count(user_id) as CNT_USER_RECURRING_total_7DAYS from (
                select a.sp_id ,a.user_id from (select * from ${PLATFORM_ID}.day_loss_user where day=${today-2} and flag = '7days') a  join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) b on a.sp_id = b.sp_id and a.user_id = b.uid) t1  group by sp_id
                ) dt1
                right join (
                select a.sp_id,CNT_USER_LOSS_TOTAL_7DAYS,total_num_before_7days,round(CNT_USER_LOSS_TOTAL_7DAYS/total_num_before_7days,6) as RATE_USER_LOSS_TOTAL_7DAYS from
                (select sp_id ,count(user_id) as CNT_USER_LOSS_TOTAL_7DAYS from ${PLATFORM_ID}.day_loss_user where day = ${yesterday} and flag = '7days' group by sp_id) a left join
                (select sp_id,count(nns_id) as total_num_before_7days from ${PLATFORM_ID}.nns_user where day=${today-8} and nns_id is not null and nns_state=0 group by sp_id) b  on a.sp_id = b.sp_id
                )dt2 on dt1.sp_id = dt2.sp_id
                )dt3
            left join (
            select sp_id, count(user_id) as cnt_user_loss_play24_7days from ${PLATFORM_ID}.day_loss_user where day=${yesterday} and flag = '7days' and cnt_play_length >= 24 group by sp_id
            ) dt4  on dt3.sp_id = dt4.sp_id) dtt1
UNION ALL
select sp_id,
null CNT_USER_RECURRING_total_7DAYS, 
null CNT_USER_LOSS_TOTAL_7DAYS, 
null total_num_before_7days, 
null RATE_USER_LOSS_TOTAL_7DAYS, 
null cnt_user_loss_play24_7days, 
null rate_user_loss_play24_7days,
CNT_USER_RECURRING_total_30DAYS, 
CNT_USER_LOSS_TOTAL_30DAYS, 
total_num_before_30days, 
RATE_USER_LOSS_TOTAL_30DAYS, 
cnt_user_loss_play24_30days,
rate_user_loss_play24_30days from (
select
            dt3.sp_id,
CNT_USER_RECURRING_total_30DAYS, 
CNT_USER_LOSS_TOTAL_30DAYS, 
total_num_before_30days, 
RATE_USER_LOSS_TOTAL_30DAYS, 
cnt_user_loss_play24_30days,
round(cnt_user_loss_play24_30days/CNT_USER_LOSS_TOTAL_30DAYS,6) as rate_user_loss_play24_30days from (
   select dt2.sp_id, CNT_USER_RECURRING_total_30DAYS, CNT_USER_LOSS_TOTAL_30DAYS, total_num_before_30days, RATE_USER_LOSS_TOTAL_30DAYS from (
        select sp_id,count(user_id) as CNT_USER_RECURRING_total_30DAYS from (
                select a.sp_id ,a.user_id from (select * from ${PLATFORM_ID}.day_loss_user where day=${today-2} and flag = '30days') a  join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) b on a.sp_id = b.sp_id and a.user_id = b.uid) t1  group by sp_id
                ) dt1
                right join (
                select a.sp_id,CNT_USER_LOSS_TOTAL_30DAYS,total_num as total_num_before_30days,round(CNT_USER_LOSS_TOTAL_30DAYS/total_num,6) as RATE_USER_LOSS_TOTAL_30DAYS from
                (select sp_id ,count(user_id) as CNT_USER_LOSS_TOTAL_30DAYS from ${PLATFORM_ID}.day_loss_user where day = ${yesterday} and flag = '30days' group by sp_id) a left join
                (select sp_id,count(nns_id) as total_num from ${PLATFORM_ID}.nns_user where day=${today-31} and nns_id is not null and nns_state=0 group by sp_id) b  on a.sp_id = b.sp_id
                )dt2 on dt1.sp_id = dt2.sp_id
                )dt3
            left join (
            select sp_id, count(user_id) as cnt_user_loss_play24_30days from ${PLATFORM_ID}.day_loss_user where day=${yesterday} and flag = '30days' and cnt_play_length >= 24 group by sp_id
            ) dt4  on dt3.sp_id = dt4.sp_id  ) dtt2
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171221195309068]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.3-day_loss_user]]></job_name> 
		<job_desc><![CDATA[v2.8.3-day_loss_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[00 09 05 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_loss_user partition(day=${yesterday})
select t2.nns_id,t2.nns_name,t2.nns_create_time,t2.sp_id,round(cnt_play_length*1.0/60,6) as cnt_play_length,"30days" from
(select nns_id,nns_name,nns_create_time,sp_id from (
    select /*+MAPJOIN(a) */a.nns_id,b.uid,a.nns_name,a.nns_create_time,a.sp_id from (
        select nns_id,nns_name,from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') as nns_create_time,sp_id from ${PLATFORM_ID}.nns_user where day=${today-31} and nns_state=0 and nns_id is not null )
    a left join
        (select uid, sp_id from ${PLATFORM_ID}.valid where day>=${today-30} and day<${today} group by uid,sp_id) b on a.nns_id=b.uid and a.sp_id = b.sp_id
    )t1 where t1.uid is null) t2
    left join  (select sp_id,user_id,sum(cnt_play_length) as cnt_play_length from ${PLATFORM_ID}.day_content_time_user where day<${today-30} and day>=${today-37} group by sp_id,user_id) t3
    on t2.nns_id=t3.user_id and t2.sp_id=t3.sp_id  
UNION ALL
select t2.nns_id,t2.nns_name,t2.nns_create_time,t2.sp_id,round(cnt_play_length*1.0/60,6) as cnt_play_length,"7days" from
(select nns_id,nns_name,nns_create_time,sp_id from (
    select /*+MAPJOIN(a) */a.nns_id,b.uid,a.nns_name,a.nns_create_time,a.sp_id from (
        select nns_id,nns_name,from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') as nns_create_time,sp_id from ${PLATFORM_ID}.nns_user where day=${today-8} and nns_state=0 and nns_id is not null )
    a left join
        (select uid, sp_id from ${PLATFORM_ID}.valid where day>=${today-7} and day<${today} group by uid,sp_id) b on a.nns_id=b.uid and a.sp_id = b.sp_id
    )t1 where t1.uid is null) t2
    left join  (select sp_id,user_id,sum(cnt_play_length) as cnt_play_length from ${PLATFORM_ID}.day_content_time_user where day<${today-7} and day>=${today-14} group by sp_id,user_id) t3
    on t2.nns_id=t3.user_id and t2.sp_id=t3.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171215101643457]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-detail_vod]]></job_name> 
		<job_desc><![CDATA[v2.8.1-detail_vod]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with
cp as
(
select d1.nns_id nns_vod_id,d2.nns_id cp_id,d1.sp_id,d1.nns_name video_name,d1.nns_vod_ext_language nns_vod_ext_language,nns_view_type,nns_director,nns_actor
from
(select nns_id,nns_name,nns_cp,sp_id,nns_vod_ext_language,nns_view_type,nns_director,nns_actor  from ${PLATFORM_ID}.nns_vod where day=${yesterday}) d1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday} group by nns_id,nns_name,sp_id) d2
on d1.nns_cp=d2.nns_name and d1.sp_id=d2.sp_id
) 
insert overwrite table ${PLATFORM_ID}.detail_vod partition(day=${yesterday})
select 
video_id,
coalesce(d.video_name,cp.video_name),
asset_id,
dt3.nns_name asset_name,
category_id,
nns_category_name,
cp_id,
d.sp_id,
apk_version,
user_id,
sum(cnt_vod_play_times),
sum(cnt_vod_play_length),
user_id_view,
sum(cnt_vod_page_view),
episode_id vod_index_id,
dt5.nns_name vod_index_name,
client_type,
nns_vod_ext_language,
nns_vod_index_ext_language,nns_view_type,nns_director,nns_actor from 
(select 
video_id,
video_name,
asset_id,
category_id,
sp_id,
apk_version,
user_id,
sum(1) CNT_VOD_PLAY_TIMES,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) CNT_VOD_PLAY_LENGTH,
null user_id_view,
null CNT_VOD_PAGE_VIEW,
episode_id,
client_type
from
(select 
video_id,
video_name,
asset_id,
category_id,
dt1.sp_id,
apk_version,
user_id,
play_sid,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time,
max(episode_id) episode_id,
client_type
from (select user_id,video_id,video_name,category_id,asset_id,event_type,play_sid,server_time,duration,apk_version,sp_id,episode_id from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='vod') dt1 
 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by
video_id,
video_name,
asset_id,
category_id,
dt1.sp_id,
apk_version,
user_id,
play_sid,
client_type) dt
group by
video_id,
video_name,
asset_id,
category_id,
sp_id,
apk_version,
user_id,
episode_id,
client_type
union all
select
event_value['video_id'] video_id,
null video_name,
event_value['asset_id'] asset_id,
event_value['category_id'] category_id,
dt1.sp_id,
apk_version,
null user_id,
null CNT_VOD_PLAY_TIMES,
null CNT_VOD_PLAY_LENGTH,
user_id user_id_view,
sum(1) CNT_VOD_PAGE_VIEW,
event_value['episode_id'] episode_id,
client_type
from
(select session_id,event_value,sp_id,user_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_value['video_id'] is not null and event_name='open_page') dt1 
join
(select session_id,max(apk_version) apk_version,sp_id,max(client_type) client_type from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,sp_id) dt2
on dt1.session_id=dt2.session_id and dt1.sp_id=dt2.sp_id
group by
event_value['video_id'],
event_value['asset_id'],
event_value['category_id'],
dt1.sp_id,
apk_version,
user_id,
event_value['episode_id'],
client_type)d left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on d.category_id=dt3.nns_category_id and d.asset_id=dt3.nns_id and dt3.sp_id=d.sp_id
left join 
(select nns_id,nns_name,nns_vod_id,sp_id,nns_vod_index_ext_language from ${PLATFORM_ID}.nns_vod_index where day=${yesterday} ) dt5 on dt5.sp_id=d.sp_id and  dt5.nns_vod_id=d.video_id  and  d.episode_id=dt5.nns_id
left join
cp on d.video_id=cp.nns_vod_id and d.sp_id=cp.sp_id 
group by 
video_id,
coalesce(d.video_name,cp.video_name),
asset_id,
dt3.nns_name,
category_id,
nns_category_name,
cp_id,
d.sp_id,
apk_version,
user_id,
user_id_view,
episode_id,
dt5.nns_name,
client_type,
nns_vod_ext_language,
nns_vod_index_ext_language,nns_view_type,nns_director,nns_actor
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171214145753400]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-contentcomb1_day]]></job_name> 
		<job_desc><![CDATA[v2.8.1-contentcomb1_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-08-31 04:21:57.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-08-31 04:21:57.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 55 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with
cp as
(
select dt1.nns_id as nns_vod_id,nns_vod_index_id,nns_mode,dt3.nns_id media_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id,dt1.nns_view_type  from
(select nns_id,nns_cp,sp_id,nns_view_type from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id  from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id = dt2.sp_id
left join
(select nns_id,nns_vod_id,nns_vod_index_id,nns_mode,sp_id from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt3
on dt1.nns_id=dt3.nns_vod_id and dt1.sp_id = dt3.sp_id
group by dt1.nns_id,nns_vod_index_id,nns_mode,dt3.nns_id,dt2.nns_id,nns_cp,dt1.sp_id,dt1.nns_view_type
)
insert overwrite table ${PLATFORM_ID}.contentcomb1_day partition(day=${yesterday})
select
video_type,
nns_addr_code,
nns_addr_city,
apk_version,
video_id,
video_name,
category_id,
dt3.nns_category_name,
cp.nns_mode,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
item.nns_id playbill_id,
item.nns_name playbill_name,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
user_id uid,
null uidv,
playbill_start_time,
playbill_length,
dt1.sp_id,
nns_view_type
from (select user_id,play_sid,video_type,episode_id,media_id,video_id,video_name,apk_version,client_type,playbill_length,playbill_start_time,category_id,asset_id,sp_id from ${PLATFORM_ID}.play_log where day=${yesterday}
group by user_id,play_sid,episode_id,media_id,video_type,video_id,video_name,apk_version,client_type,playbill_length,playbill_start_time,category_id,asset_id,sp_id) dt1 join
(select uid,pid,sp_id from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid and dt1.sp_id=valid.sp_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id left join
cp on dt1.video_id=cp.nns_vod_id and dt1.episode_id=cp.nns_vod_index_id and dt1.sp_id = cp.sp_id and dt1.media_id=cp.media_id left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and item.sp_id=dt1.sp_id
group by video_type,nns_addr_code,nns_addr_city,apk_version,video_id,video_name,category_id,dt3.nns_category_name,cp.nns_mode, asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,item.nns_id,item.nns_name,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,playbill_start_time,playbill_length,dt1.sp_id,nns_view_type,nns_addr_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171214143306085]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_content_time_user]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_content_time_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
cp as
(
select dt1.nns_id as nns_vod_id,dt1.nns_area,dt1.nns_kind,nns_vod_index_id,nns_mode,dt3.nns_id media_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id,dt1.nns_view_type from
(select nns_id,nns_area,nns_kind,nns_cp,sp_id,nns_view_type from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id = dt2.sp_id
left join
(select nns_id,nns_vod_id,nns_vod_index_id,nns_mode,sp_id from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt3
on dt1.nns_id=dt3.nns_vod_id and dt1.sp_id = dt3.sp_id
group by dt1.nns_id,dt1.nns_area,dt1.nns_kind,nns_vod_index_id,nns_mode,dt3.nns_id,dt2.nns_id,nns_cp,dt1.sp_id,dt1.nns_view_type
)
insert overwrite table ${PLATFORM_ID}.day_content_time_user partition(day=${yesterday})
select
dt.video_type,
dt.user_id,
dt.n user_name,
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sp_id,
null,
video_id,
video_name,
category_id,
nns_category_name,
asset_id,
asset_name,
nns_mode,
if(nns_cp_id is null or nns_cp_id='',sp_id,nns_cp_id) nns_cp_id,
nns_cp,
nns_area,
nns_kind,
null nns_id,
null nns_name,
nns_nns_boss_area_bind,
nns_view_type
from
(select
video_type,
dt1.user_id,
dt2.nns_name n,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
dt1.client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
dt1.sp_id,
dt1.play_sid,
max(video_id) video_id,
max(video_name) video_name,
category_id,
nns_category_name,
asset_id,
dt3.nns_name asset_name,
nns_mode,
nns_cp_id,
nns_cp,
cp.nns_area,
cp.nns_kind,
cp.nns_view_type,
nns_nns_boss_area_bind,
count(distinct dt1.play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,video_type,video_id,video_name,category_id,asset_id,event_type,play_sid,server_time,duration,apk_version,client_type,sp_id,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1
left join (select play_sid,user_id,max(episode_id) episode_id,max(media_id) media_id from ${PLATFORM_ID}.play_log where day=${yesterday} group by play_sid,user_id)dt0 on dt0.play_sid=dt1.play_sid and dt0.user_id = dt1.user_id 
 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt3.sp_id=dt1.sp_id
left join
cp on dt1.video_id=cp.nns_vod_id and dt0.episode_id=cp.nns_vod_index_id and cp.sp_id=dt1.sp_id and dt0.media_id=cp.media_id 
left join
(select nns_id,nns_name,nns_addr_code,nns_addr_city,nns_sex,nns_age_cal,nns_nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by video_type,dt1.user_id,dt2.nns_name,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,
nns_addr_city,
apk_version,
dt1.client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),dt1.sp_id,dt1.play_sid,category_id,nns_category_name,asset_id,dt3.nns_name,nns_mode,nns_cp_id,nns_cp,cp.nns_area,cp.nns_kind,nns_nns_boss_area_bind,nns_view_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) ) dt
group by
dt.video_type,
dt.user_id,
dt.n,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sp_id,
video_id,
video_name,
category_id,
nns_category_name,
asset_id,
asset_name,
nns_mode,
if(nns_cp_id is null or nns_cp_id='',sp_id,nns_cp_id),
nns_cp,
nns_area,
nns_kind,
nns_nns_boss_area_bind,
nns_view_type
union all
select
null video_type,
user_id,
dt2.nns_name user_name,
null,
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
dt1.sp_id,
sum(1),
null video_id,
null video_name,
null category_id,
null nns_category_name,
null asset_id,
null asset_name,
null nns_mode,
null nns_cp_id,
null nns_cp,
null nns_area,
null nns_kind,
null nns_id,
null nns_name,
nns_nns_boss_area_bind,
null nns_view_type
from
(select user_id,apk_version,client_type,sp_id,region_code from ${PLATFORM_ID}.startup_log where day=${yesterday}) dt1
left join
(select nns_id,nns_name,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2
on dt1.user_id=dt2.nns_id
group by
user_id,
dt2.nns_name,
if(length(nns_addr_code)>6,nns_addr_code,region_code) ,
nns_addr_city,
apk_version,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
dt1.sp_id,
nns_nns_boss_area_bind,
if(length(nns_addr_code)>6,nns_addr_code,region_code)
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171214114643425]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb1_day]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb1_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
insert overwrite table ${PLATFORM_ID}.usercomb1_day partition(day=${yesterday})
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
null,
null,
category_id,
dt3.nns_category_name,
null,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
heartbeat_type,
network_type,
nns_boss_area_bind
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type,network_type,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type,network_type) dt1
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id = dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id
group by nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id,heartbeat_type,network_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171208192830892]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.4-detail_playback]]></job_name> 
		<job_desc><![CDATA[v2.6.4-detail_playback]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 14 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.detail_playback partition(day=${yesterday})
select video_id,video_name,playbill_id,playbill_name,playbill_start_time,
playbill_length,nns_addr_code,nns_addr_city,apk_version,client_type,sp_id,user_id,count(1),sum(cnt_play_length) from (
select 
dt1.video_id,
dt1.video_name,
dt1.category_id,
dt1.asset_id,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.playbill_start_time,
dt1.playbill_length,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
client_type,
dt1.sp_id,
dt1.user_id,
dt1.play_sid,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from (
select user_id,video_id,video_name,category_id,asset_id,apk_version,
client_type,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type = 'playback' group by user_id,video_id,video_name,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,apk_version,
client_type )dt1 left join(select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type = 'playback' and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and dt1.sp_id=item.sp_id left join
(select nns_id,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id) dt3 on dt1.user_id=dt3.nns_id 
group by dt1.video_id,
dt1.video_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,dt1.playbill_start_time,dt1.playbill_length,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,client_type,dt1.category_id,dt1.asset_id)dt group by video_id,video_name,playbill_id,playbill_name,playbill_start_time,
playbill_length,nns_addr_code,nns_addr_city,apk_version,client_type,sp_id,user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171130190945190]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.4-day_content_live_video_playbill_time_interval]]></job_name> 
		<job_desc><![CDATA[v2.7.4-day_content_live_video_playbill_time_interval]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_live_video_playbill_time_interval partition(day=${yesterday})
select video_name,playbill_name,hour,round(sum(end_time-start_time)/(60.0*1000),6) from (select user_id,play_sid,video_name,playbill_name,substring(minute,0,2) hour,max(server_time) end_time,min(server_time) start_time from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type='live' group by 
video_name,playbill_name,substring(minute,0,2),play_sid,user_id)a group by video_name,playbill_name,hour
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171128154511935]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.4-month_devicecomb2]]></job_name> 
		<job_desc><![CDATA[v2.7.4-month_devicecomb2]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_devicecomb2 partition(day=${last_month})
select device_id,terminaltype,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,heartbeat_type,user_id from 
${PLATFORM_ID}.day_devicecomb2 where day >=${last_month} and day<=${yesterday} group by device_id,terminaltype,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,heartbeat_type,user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171128154150857]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.4-week_devicecomb2]]></job_name> 
		<job_desc><![CDATA[v2.7.4-week_devicecomb2]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 5 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_devicecomb2 partition(day=${today-7})
select device_id,terminaltype,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,heartbeat_type,user_id from 
${PLATFORM_ID}.day_devicecomb2 where day >=${today-7} and day<=${yesterday} group by device_id,terminaltype,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,heartbeat_type,user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171128153944820]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.4-day_devicecomb2]]></job_name> 
		<job_desc><![CDATA[v2.7.4-day_devicecomb2]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_devicecomb2 partition(day=${yesterday})
select device_id,client_type,apk_version,dt.sp_id,system_name,system_version,if(length(nns_addr_code)>6,nns_addr_code,region_code) region,nns_addr_city nns_name,heartbeat_type,dt.user_id from 
(select device_id,user_id,client_type,apk_version,sp_id,system_name,system_version,heartbeat_type,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where 
day = ${yesterday} group by user_id,device_id,client_type,apk_version,sp_id,system_name,system_version,heartbeat_type)dt left join (select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) user_info on dt.user_id = user_info.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108170942818]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-hour_valid]]></job_name> 
		<job_desc><![CDATA[v2.7.1-hour_valid]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 59 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.hour_valid partition(day=${today})
select user_id,play_sid,min(server_time) start_time,max(server_time) end_time,client_type,sp_id from 
${PLATFORM_ID}.heartbeat_log where day=${today} and video_type in ('vod','live','playback','timeshift') group by user_id,play_sid,client_type,sp_id
union all
select user_id,null play_sid,null start_time,null end_time,client_type,dt1.sp_id from (select session_id,sp_id from ${PLATFORM_ID}.user_log where day=${today} and event_name='view_twmz' group by session_id,sp_id)dt1 left join (select session_id,user_id,client_type from ${PLATFORM_ID}.session_log where day>=${yesterday} and day<=${today} group by session_id,user_id,client_type)dt2 on dt1.session_id=dt2.session_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108165505910]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-valid]]></job_name> 
		<job_desc><![CDATA[v2.7.1-valid]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.valid partition(day=${yesterday})
 select user_id,play_sid,min(server_time) start_time,max(server_time) end_time,client_type,sp_id from 
 ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type in ('vod','live','playback','timeshift') group by user_id,play_sid,client_type,sp_id
 union all
 select user_id,null play_sid,null start_time,null end_time,client_type,dt1.sp_id from (select session_id,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='view_twmz' group by session_id,sp_id)dt1 left join (select session_id,user_id,client_type from ${PLATFORM_ID}.session_log where day>=${today-2} and day<=${yesterday} group by session_id,user_id,client_type)dt2 on dt1.session_id=dt2.session_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108110150690]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-day_user_time_new_user]]></job_name> 
		<job_desc><![CDATA[v2.7.1-day_user_time_new_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_new_user partition(day=${yesterday})
select user_id,device_id,client_type,apk_version,video_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,nns_addr_city,nns_sex,age,dt1.sp_id from 
(select user_id,device_id,client_type,apk_version,video_type,sp_id,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type in ('vod','live','playback','timeshift') group by user_id,device_id,client_type,apk_version,video_type,sp_id
union all 
select user_id,device_id,client_type,apk_version,'twmz' video_type,sp_id,null region_code from (select session_id,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='view_twmz' group by session_id,sp_id)dt1 left join (select session_id,user_id,device_id,client_type,apk_version from ${PLATFORM_ID}.session_log where day>=${today-2} and day<=${yesterday} group by session_id,user_id,device_id,client_type,apk_version)dt2 on dt1.session_id=dt2.session_id group by user_id,device_id,client_type,apk_version,sp_id)dt1 left join 
(select nns_id,nns_addr_code,nns_addr_city,nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_addr_code,nns_addr_city,nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))))dt2 on dt1.user_id=dt2.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171107184916150]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5-week_user_time_addr_apk_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.5-week_user_time_addr_apk_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 5 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_addr_apk_terminaltype_gender_age partition(day=${today-7})
select 
user_addr,
user_addr_name,
apk_version,
terminaltype,
gender,
age,
null,
sum(cnt_startup_user),
sp_id  
from  ${PLATFORM_ID}.day_user_time_addr_apk_terminaltype_gender_age
where day>=${today-7} and day<=${yesterday} group by user_addr,user_addr_name,apk_version,terminaltype,gender,age,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171106170700164]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-month_content_time_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.16.3-month_content_time_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 6 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_content_time_playbill_category_asset partition(day=${last_month})
select video_type,
playbill_id,
playbill_name,
category_id,
category_name,
asset_id,
asset_name,
video_id,
video_name,
count(distinct user_id),
count(1),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from 
(select dt1.video_type,dt1.video_id,
dt1.video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.user_id,
dt1.play_sid,
dt1.playbill_start_time,
dt1.playbill_length,
dt1.sp_id,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,asset_id,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,video_type from ${PLATFORM_ID}.heartbeat_log where day>=${last_month} and day<${today} and video_type in ('live','playback') group by user_id,video_id,video_name,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,video_type )dt1 left join(select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type  from ${PLATFORM_ID}.play_log where day>=${last_month} and day<${today} and video_type in ('live','playback') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.sp_id=item.sp_id 
group by dt1.video_type,dt1.video_id,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,dt1.playbill_start_time,dt1.playbill_length,dt1.sp_id)dt group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171106170140429]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-week_content_time_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.16.3-week_content_time_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_playbill_category_asset partition(day=${today-7})
select video_type,
playbill_id,
playbill_name,
category_id,
category_name,
asset_id,
asset_name,
video_id,
video_name,
count(distinct user_id),
count(1),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from 
(select dt1.video_type,dt1.video_id,
dt1.video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.user_id,
dt1.play_sid,
dt1.playbill_start_time,
dt1.playbill_length,
dt1.sp_id,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,asset_id,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,video_type from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<${today} and video_type in ('live','playback') group by user_id,video_id,video_name,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,video_type )dt1 left join(select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type  from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today} and video_type in ('live','playback') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.sp_id=item.sp_id 
group by dt1.video_type,dt1.video_id,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,dt1.playbill_start_time,dt1.playbill_length,dt1.sp_id)dt group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171102150905827]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.2-hour_content_time_user]]></job_name> 
		<job_desc><![CDATA[v2.6.2-hour_content_time_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.hour_content_time_user partition(${partition_last_3_1h})
select 
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
playbill_id,
playbill_name,
content_type,                                  
apk_version,
client_type,
sp_id,
user_id,
count(1),
sum(cnt_play_length)
from 
(select dt1.video_type,dt1.video_id,apk_version,client_type,
if(dt1.video_type='vod',dt5.nns_name,dt6.nns_name) video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.user_id,
dt1.play_sid,
dt1.sp_id,
nns_view_type content_type,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,apk_version,client_type,asset_id,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,video_type from ${PLATFORM_ID}.heartbeat_log where ${where_last_3_1h} and video_type in ('live','playback','vod','timeshift') group by user_id,video_id,video_name,category_id,apk_version,client_type,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,video_type)dt1 left join (select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type from ${PLATFORM_ID}.play_log where ${where_last_3_1h} and video_type in ('live','playback','vod','timeshift') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and dt1.sp_id=item.sp_id left join (select nns_id,nns_name,nns_view_type,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday} group by nns_id,nns_view_type,nns_name,sp_id)dt5 on dt1.video_id=dt5.nns_id and dt1.sp_id=dt5.sp_id  left join (select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_live where day=${yesterday} group by nns_id,nns_name,sp_id)dt6 on dt1.video_id=dt6.nns_id and dt1.sp_id=dt6.sp_id
group by dt1.video_type,dt1.video_id,apk_version,client_type,if(dt1.video_type='vod',dt5.nns_name,dt6.nns_name),nns_view_type,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,dt1.sp_id)dt group by user_id,video_id,video_name,category_id,category_name,asset_id,asset_name,video_type,playbill_id,playbill_name,content_type,apk_version,
client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171102124230778]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.2-day_content_time_video_apk_sp_addr_client_drag]]></job_name> 
		<job_desc><![CDATA[v2.6.2-day_content_time_video_apk_sp_addr_client_drag]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_apk_sp_addr_client_drag partition(day=${yesterday})
select 
client_type,
dt1.video_id,
video_name,
video_type,
apk_version,
dt1.sp_id,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
sum(drag_times) drag_times,
round(sum(drag_length)/1000,2) drag_length,
count(1) playsid_times
from(
select 
user_id,client_type,video_id,video_name,video_type,apk_version,sp_id,drag_length,drag_times,region_code 
from ${PLATFORM_ID}.play_log_all
where day=${yesterday} and drag_times > 0)dt1 
left join (
select nns_id,sp_id,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city 
from ${PLATFORM_ID}.nns_user where day=${yesterday} 
group by nns_id,sp_id)dt2 on dt1.user_id = dt2.nns_id and dt1.sp_id=dt2.sp_id 
group by client_type,dt1.video_id,video_name,video_type,apk_version,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171102114429443]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.2-day_quality_user_time_addr_apk_video_type_system_sp]]></job_name> 
		<job_desc><![CDATA[v2.6.2-day_quality_user_time_addr_apk_video_type_system_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_user_time_addr_apk_video_type_system_sp partition(day=${yesterday})
select dt1.user_id,dt3.nns_name,from_unixtime(cast(first/1000 as int),'yyyy-MM-dd HH:mm:ss'),from_unixtime(cast(last/1000 as int),'HH:mm:ss'),video_type,dt1.video_id,video_name,apk,client,system,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,buffer,round(duration*1.0/1000,2) from (select user_id,play_sid,count(1) buffer,video_id,min(video_type) video_type,max(server_time) last,
min(server_time) first,sum(duration) duration,min(apk_version) apk,min(client_type) client,
min(system_name) system,min(sp_id) sp_id,max(region_code) region_code from 
${PLATFORM_ID}.play_log where day=${yesterday} and event_type = 'buffer' group by user_id,video_id,play_sid)dt1 join 
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) dt2 on dt1.user_id=dt2.uid and dt1.play_sid = dt2.pid left join (select video_id,sp_id,video_name from (select video_id,video_name,sp_id,row_number() over(partition by video_id,sp_id order by num desc) as depth from (select video_id,video_name,sp_id,count(1) num from ${PLATFORM_ID}.play_log where day=${yesterday} and event_type = 'buffer' group by video_id,video_name,sp_id)dt0)dt where depth=1)dt4 on dt1.video_id=dt4.video_id and dt1.sp_id=dt4.sp_id left join 
(select nns_id,max(nns_name) nns_name,max(nns_addr_code) nns_addr_code,max(nns_addr_city) nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id) dt3 on dt1.user_id = dt3.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171031184011913]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.1-day_quality_play_time_type_video]]></job_name> 
		<job_desc><![CDATA[day_quality_play_time_type_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type_video partition(day=${yesterday})
select
video_type,
video_id,
video_name,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
video_id,
dt3.nns_name video_name,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,video_id,video_name,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid

left join 
 (select nns_name,nns_id  from ${PLATFORM_ID}.nns_vod where day=${yesterday}  group by nns_name,nns_id)dt3 on dt1.video_id = dt3.nns_id  

group by video_type,video_id,dt3.nns_name,user_id,play_sid) dt
group by video_type,video_id,video_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171027114721747]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.3-day_app_download_install]]></job_name> 
		<job_desc><![CDATA[v2.6.3-day_app_download_install]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_app_download_install partition(day=${yesterday})
select 
dt.app_name,
dt.version,
dt.sp_id,
null,
if(download_success_num is null,'0',download_success_num),
if(download_fail_num is null,'0',download_fail_num),
null,
if(install_success_num is null,'0',install_success_num),
if(install_fail_num is null,'0',install_fail_num),
if(speed_total is null,'0',speed_total)
from (
select
tb0.app_name,
tb0.version,
tb0.sp_id,
null,
tb1.download_success_num,
tb2.download_fail_num,
null,
tb3.install_success_num,
tb4.install_fail_num,
tb0.download_speed_total as speed_total 
from
(select
event_value['app_name'] app_name,
event_value['version'] version,
sp_id,
sum(event_value['download_speed']) download_speed_total
from ${PLATFORM_ID}.user_log
where day=${yesterday} and event_name = 'download_app' and event_value['app_name'] is not null
group by event_value['app_name'],event_value['version'],sp_id)tb0
left join 
(select
event_value['app_name'] app_name,
event_value['version'] version,
sp_id,
count(event_value['app_name']) download_success_num
from ${PLATFORM_ID}.user_log
where day=${yesterday} and event_name = 'download_app' and event_value['app_name'] is not null and event_value['status'] = 1
group by event_value['app_name'],event_value['version'],sp_id)tb1
on tb0.app_name = tb1.app_name and tb0.version = tb1.version and tb0.sp_id = tb1.sp_id
left join
(select
event_value['app_name'] app_name,
event_value['version'] version,
sp_id,
count(event_value['app_name']) download_fail_num
from ${PLATFORM_ID}.user_log
where day=${yesterday} and event_name = 'download_app' and event_value['app_name'] is not null and event_value['status'] = 0
group by event_value['app_name'],event_value['version'],sp_id)tb2
on tb0.app_name = tb2.app_name and tb0.version = tb2.version and tb0.sp_id = tb2.sp_id
left join
(select
event_value['app_name'] app_name,
event_value['downloaded_version'] version,
sp_id,
count(event_value['app_name']) install_success_num
from ${PLATFORM_ID}.user_log
where day=${yesterday} and event_name = 'install_app' and event_value['app_name'] is not null and event_value['status'] = 1
group by event_value['app_name'],event_value['downloaded_version'],sp_id)tb3
on tb0.app_name = tb3.app_name and tb0.version = tb3.version and tb0.sp_id = tb3.sp_id
left join
(select
event_value['app_name'] app_name,
event_value['downloaded_version'] version,
sp_id,
count(event_value['app_name']) install_fail_num
from ${PLATFORM_ID}.user_log
where day=${yesterday} and event_name = 'install_app' and event_value['app_name'] is not null and event_value['status'] = 0
group by event_value['app_name'],event_value['downloaded_version'],sp_id)tb4
on tb0.app_name = tb4.app_name and tb0.version = tb4.version and tb0.sp_id = tb4.sp_id
)dt
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171025104704969]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.6.1-day_video_source_path]]></job_name> 
		<job_desc><![CDATA[v2.6.1-day_video_source_path]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_video_source_path partition (day=${yesterday})
select  video_id,video_name,sp_id,user_id,count(*) 
cnt_play_times,str_to_map(concat_ws(",",concat_ws(':', 'page_id_1', cast(page_id_1 as string)),concat_ws(':', 'page_id_2', cast(page_id_2 as string)),concat_ws(':', 'page_id_3', cast(page_id_3 as string))))
 from
(select user_id,split(ext_info['source_page'],"/")[0] page_id_1,
 split(ext_info['source_page'],"/")[1] page_id_2,
 split(ext_info['source_page'],"/")[2] page_id_3 ,
 sp_id,video_id,video_name   from ${PLATFORM_ID}.play_log where day=${yesterday} 
 and  ext_info['source_page'] is not null  and event_type='play' ) dt
group by dt.page_id_1,dt.page_id_2,dt.page_id_3,dt.video_id,video_name,dt.sp_id,dt.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171017153723405]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.2-day_content_time]]></job_name> 
		<job_desc><![CDATA[v2.4.2-day_content_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time partition(day=${yesterday})
select
video_type,
count(distinct user_id),
sum(cnt_play_times),
sum(cnt_play_length),
null,
null
from ${PLATFORM_ID}.day_content_time_user where day=${yesterday}
group by video_type
union all
select
"vod" video_type,
null,
null,
null,
sum(1),
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171016163017275]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.2-month_content_time_video_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.5.2-month_content_time_video_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_content_time_video_playbill_category_asset partition(day=${last_month})
select
video_type,
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length
from
(select
dt.video_type,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_type,
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
item.nns_id playbill_id,
item.nns_name playbill_name,
user_id,
play_sid,
playbill_start_time,
playbill_length,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='paused',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day>=${last_month} and day<=${yesterday} and video_type in ('live','playback')) dt1
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
join (select * from ${PLATFORM_ID}.valid where day>=${last_month} and day<${today}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time
group by video_type,video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,user_id,play_sid,playbill_start_time,playbill_length) dt
group by
dt.video_type,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length) dtt
group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171016162828356]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.2-week_content_time_video_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.5.2-week_content_time_video_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_video_playbill_category_asset partition(day=${today-7})
select
video_type,
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length
from
(select
dt.video_type,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_type,
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
item.nns_id playbill_id,
item.nns_name playbill_name,
user_id,
play_sid,
playbill_start_time,
playbill_length,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='paused',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday} and video_type in ('live','playback')) dt1
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
join (select * from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time
group by video_type,video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,user_id,play_sid,playbill_start_time,playbill_length) dt
group by
dt.video_type,
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length) dtt
group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171010140332783]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.3-order_paid_history_info]]></job_name> 
		<job_desc><![CDATA[v2.4.3-order_paid_history_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.order_paid_history_info
select dt1.nns_id,dt1.sp_id from (select nns_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day=${today-2} and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<=${today-2} and nns_order_state=1 group by nns_id,sp_id)dt1 
left join (select nns_id,sp_id from ${PLATFORM_ID}.order_paid_history_info)dt2 on dt1.nns_id=dt2.nns_id and 
dt1.sp_id=dt2.sp_id where dt2.nns_id is null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171009165337907]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.5-days_content_time_unpopular_30]]></job_name> 
		<job_desc><![CDATA[v2.5.5-days_content_time_unpopular_30]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.days_content_time_unpopular_30 partition(day=${yesterday})
select 
dt3.video_id,
'vod',
dt3.cnt_play_times, 
dt3.video_name,
dt3.video_kind,
dt3.video_director,
dt3.video_play_role,
dt3.video_online_days,
dt3.video_online_time,dt3.sp_id
 from 
(select 
dt1.video_id,
if(dt2.cnt_play_times is null,0,dt2.cnt_play_times) as cnt_play_times, 
dt1.video_name,
dt1.video_kind,
dt1.video_director,
dt1.video_play_role,
dt1.video_online_days,
dt1.video_online_time,dt1.sp_id
 from 
(select * from ${PLATFORM_ID}.day_content_video_unpopular where day = ${yesterday} and video_online_days > 30)dt1
left join 
(select video_id, sum(cnt_play_times) as cnt_play_times from  ${PLATFORM_ID}.day_content_time_video where day >= ${today-30} and day < ${today} and video_type = 'vod' group by video_id)dt2
on dt1.video_id = dt2.video_id)dt3 where dt3.cnt_play_times = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171009165109113]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.5-days_content_time_unpopular_60]]></job_name> 
		<job_desc><![CDATA[v2.5.5-days_content_time_unpopular_60]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.days_content_time_unpopular_60 partition(day=${yesterday})
select 
dt3.video_id,
'vod',
dt3.cnt_play_times, 
dt3.video_name,
dt3.video_kind,
dt3.video_director,
dt3.video_play_role,
dt3.video_online_days,
dt3.video_online_time,dt3.sp_id
 from 
(select 
dt1.video_id,
if(dt2.cnt_play_times is null,0,dt2.cnt_play_times) as cnt_play_times, 
dt1.video_name,
dt1.video_kind,
dt1.video_director,
dt1.video_play_role,
dt1.video_online_days,
dt1.video_online_time,dt1.sp_id
 from 
(select * from ${PLATFORM_ID}.day_content_video_unpopular where day = ${yesterday} and video_online_days > 60)dt1
left join 
(select video_id, sum(cnt_play_times) as cnt_play_times from  ${PLATFORM_ID}.day_content_time_video where day >= ${today-60} and day < ${today} and video_type = 'vod' group by video_id)dt2
on dt1.video_id = dt2.video_id)dt3 where dt3.cnt_play_times = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171009164806384]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.5-days_content_time_unpopular_90]]></job_name> 
		<job_desc><![CDATA[v2.5.5-days_content_time_unpopular_90]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.days_content_time_unpopular_90 partition(day=${yesterday})
select 
dt3.video_id,
'vod',
dt3.cnt_play_times, 
dt3.video_name,
dt3.video_kind,
dt3.video_director,
dt3.video_play_role,
dt3.video_online_days,
dt3.video_online_time,dt3.sp_id
 from 
(select 
dt1.video_id,
if(dt2.cnt_play_times is null,0,dt2.cnt_play_times) as cnt_play_times, 
dt1.video_name,
dt1.video_kind,
dt1.video_director,
dt1.video_play_role,
dt1.video_online_days,
dt1.video_online_time,dt1.sp_id
 from 
(select * from ${PLATFORM_ID}.day_content_video_unpopular where day = ${yesterday} and video_online_days > 90)dt1
left join 
(select video_id, sum(cnt_play_times) as cnt_play_times from  ${PLATFORM_ID}.day_content_time_video where day >= ${today-90} and day < ${today} and video_type = 'vod' group by video_id)dt2
on dt1.video_id = dt2.video_id)dt3 where dt3.cnt_play_times = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170929161015498]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.3-startupcomb1_day]]></job_name> 
		<job_desc><![CDATA[v2.5.3-startupcomb1_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.startupcomb1_day partition(day=${yesterday})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
client_type,
user_id,
dt1.sp_id,
apk_version,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
from (select * from ${PLATFORM_ID}.startup_log where day=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_user where day=${yesterday})dt2 on dt1.user_id=dt2.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170928161214044]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.1-hour_content_time_video]]></job_name> 
		<job_desc><![CDATA[v2.5.1-hour_content_time_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 2 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.hour_content_time_video partition(${partition_last_2_1h})
select 
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
playbill_id,
playbill_name,
content_type,                                  
apk_version,
client_type,
sp_id,
count(distinct user_id),
count(1),
sum(cnt_play_length)
from 
(select dt1.video_type,dt1.video_id,apk_version,client_type,
if(dt1.video_type='vod',dt5.nns_name,dt6.nns_name) video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.user_id,
dt1.play_sid,
dt1.sp_id,
nns_view_type content_type,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,apk_version,client_type,asset_id,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,video_type from ${PLATFORM_ID}.heartbeat_log where ${where_last_2_1h} and video_type in ('live','playback','vod','timeshift') group by user_id,video_id,video_name,category_id,apk_version,client_type,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,video_type)dt1 left join (select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type from ${PLATFORM_ID}.play_log where ${where_last_2_1h} and video_type in ('live','playback','vod','timeshift') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.playbill_length=dt2.playbill_length and dt1.playbill_start_time=dt2.playbill_start_time and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and dt1.sp_id=item.sp_id left join (select nns_id,nns_name,nns_view_type,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday} group by nns_id,nns_view_type,nns_name,sp_id)dt5 on dt1.video_id=dt5.nns_id and dt1.sp_id=dt5.sp_id  left join (select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_live where day=${yesterday} group by nns_id,nns_name,sp_id)dt6 on dt1.video_id=dt6.nns_id and dt1.sp_id=dt6.sp_id
group by dt1.video_type,dt1.video_id,apk_version,client_type,if(dt1.video_type='vod',dt5.nns_name,dt6.nns_name),nns_view_type,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,dt1.sp_id)dt group by video_id,video_name,category_id,category_name,asset_id,asset_name,video_type,playbill_id,playbill_name,content_type,apk_version,
client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170926205702047]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.2-day_content_user_product_video]]></job_name> 
		<job_desc><![CDATA[v2.5.2-day_content_user_product_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_user_product_video partition(day=${yesterday})
select user_id,video_type,video_id,video_name, nns_view_type,p_id,p_name,category_id,nns_category_name,asset_id,
nns_name,apk_version,client_type,sp_id,count(distinct play_sid),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) 
from (select user_id,video_type,video_id,if(video_type = 'vod',dt4.nns_name,dt5.nns_name) video_name, nns_view_type,
      p_id,p_name,dt1.category_id,dt3.nns_category_name,dt1.asset_id,dt3.nns_name,dt1.apk_version,dt1.client_type,
      dt1.sp_id,if(finish_time>0,finish_time,endtime) end_time,if(play_time>0,play_time,starttime) start_time,
      paused_time,buffer_time,play_sid from (select user_id,video_id,video_type,ext_info['p_id'] p_id,
      ext_info['p_name'] p_name,category_id,asset_id,apk_version,client_type,sp_id ,
max(if(event_type='finish',server_time,0)) finish_time,min(if(event_type='play',server_time,0)) play_time,
sum(if(event_type='buffer',duration,0)) buffer_time,sum(if(event_type='pause',duration,0)) paused_time,play_sid 
from ${PLATFORM_ID}.play_log where day=${yesterday}  group by user_id,video_id,video_type,ext_info['p_id'],
ext_info['p_name'],category_id,asset_id,apk_version,client_type,sp_id,play_sid)dt1 join 
(select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and 
dt1.play_sid=valid.pid left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on 
dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id = dt3.sp_id  left join 
(select nns_id,nns_name,nns_view_type,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday} group by 
 nns_id,nns_name,nns_view_type,sp_id)dt4 on dt1.video_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join 
      (select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_live where day=${yesterday} group by nns_id,nns_name
       ,sp_id)dt5 on dt1.video_id=dt5.nns_id and dt1.sp_id=dt5.sp_id)dt group by user_id,video_type,video_id,
video_name, nns_view_type,category_id,nns_category_name,asset_id,nns_name,apk_version,client_type,sp_id,p_id,p_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170920201331098]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-update_today_active]]></job_name> 
		<job_desc><![CDATA[v2.4.1-update_today_active]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_active partition(day=${yesterday})
select
uid,client_type,sp_id
from ${PLATFORM_ID}.valid where day=${yesterday} group by uid,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170920201123153]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-update_today_online]]></job_name> 
		<job_desc><![CDATA[v2.4.1-update_today_online]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_online partition(day=${yesterday})
select
user_id,
client_type,sp_id 
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by user_id,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170920200914560]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.2-update today_summary]]></job_name> 
		<job_desc><![CDATA[v2.4.2-update today_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_summary partition(day=${yesterday})
select
video_type,
count(distinct user_id),
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
client_type,sp_id
from
${PLATFORM_ID}.valid dt1 join (select user_id,video_type from ${PLATFORM_ID}.play_log where day=${yesterday}) dt2
on dt1.uid=dt2.user_id
where dt1.day=${yesterday}
group by video_type,client_type,sp_id
union all
select
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length),
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
terminaltype client_type,
sp_id 
from ${PLATFORM_ID}.day_content_time_user where day=${yesterday}
group by video_type,terminaltype,sp_id
union all
select
null video_type,
null,
null,
null,
count(distinct user_id),
null,
null,
null,
null,
null,
null,
null,
null,
null,
client_type,
sp_id 
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by client_type,sp_id
union all
select
null video_type,
null,
null,
null,
null,
count(distinct uid),
null,
null,
null,
null,
null,
null,
null,
null,
client_type,
sp_id
from ${PLATFORM_ID}.valid where day=${yesterday} group by client_type,sp_id
union all
select
null video_type,
null,
null,
null,
null,
null,
sum(cnt_user_new_total),
null,
null,
null,
null,
null,
null,
null,
terminaltype client_type,
sp_id  
from ${PLATFORM_ID}.user_time_addr_gender_age_day where day=${yesterday} group by terminaltype,sp_id
union all
select
null video_type,
null,
null,
null,
null,
null,
null,
sum(cnt_order_product_total),
null,
sum(cnt_order_money_total),
null,
null,
null,
null,
null client_type,
null sp_id 
from ${PLATFORM_ID}.day_sales_time where day=${yesterday}
union all
select
null video_type,
null,
null,
null,
null,
null,
null,
null,
count(distinct nns_user_id),
null,
null,
null,
null,
null,
null client_type,
null sp_id 
from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show),
sum(cnt_ad_click),
null,
null,
null client_type,
null sp_id 
from  ${PLATFORM_ID}.day_ad_time_view where day=${yesterday}
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show_user),
sum(cnt_ad_click_user),
null client_type,
null sp_id 
from  ${PLATFORM_ID}.day_ad_time_user where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170918173032385]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.0-nns_assists_category]]></job_name> 
		<job_desc><![CDATA[v2.3.0-nns_assists_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.nns_assists_category partition(day=${yesterday})
select dt2.nns_id,dt2.nns_name,dt1.nns_category_id,dt2.nns_name,dt1.sp_id,'0',1
from
(select distinct nns_assist_id,nns_category_id,sp_id from ${PLATFORM_ID}.nns_assists_item where day=${yesterday} and nns_category_id='1000' ) dt1 
join 
(select distinct nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_assists where day=${yesterday}) dt2 
on dt1.nns_assist_id=dt2.nns_id and dt1.sp_id=dt2.sp_id
group by dt2.nns_id,dt2.nns_name,dt1.nns_category_id,dt2.nns_name,dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170914164351808]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-play_vod_total_day]]></job_name> 
		<job_desc><![CDATA[v2.4.1-play_vod_total_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.play_vod_total_day partition (day=${yesterday})
select video_id,video_name,vod_index_id,vod_index_name,sp_id,sum(cnt_vod_play_times) play_total_by_all
from ${PLATFORM_ID}.detail_vod where day<${today}
group by video_id,video_name,sp_id,vod_index_id,vod_index_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170914163721018]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.5.1-day_content_video_unpopular]]></job_name> 
		<job_desc><![CDATA[v2.5.1-day_content_video_unpopular]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_video_unpopular partition(day=${yesterday})
select 
dt3.nns_video_id,
dt4.nns_name,
dt4.nns_view_type,
dt4.nns_kind,
dt4.nns_director,
if(dt4.nns_play_role is null,dt4.nns_actor,dt4.nns_play_role),
from_unixtime(cast(dt3.nns_create_time/1000 as int),'yyyy-MM-dd'),
datediff(from_unixtime(unix_timestamp(),'yyyy-MM-dd'),from_unixtime(cast(dt3.nns_create_time/1000 as int),'yyyy-MM-dd')),
dt3.sp_id 
 from 
(select * from 
(select nns_assists_item.*,ROW_NUMBER() OVER(PARTITION BY nns_video_id ORDER BY nns_create_time desc) num from ${PLATFORM_ID}.nns_assists_item where  day = ${yesterday} and nns_video_type = '0' )dt1 where num = 1)dt3
left join 
(select * from 
(select nns_vod.*,ROW_NUMBER() OVER(PARTITION BY nns_id ORDER BY nns_create_time desc) num from ${PLATFORM_ID}.nns_vod where day = ${yesterday} )dt2 
where num = 1)dt4
on dt3.nns_video_id = dt4.nns_id and dt3.sp_id = dt4.sp_id;
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170904111019325]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.2-day_user_time_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.4.2-day_user_time_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_terminaltype partition(day=${yesterday})
select
client_type,
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}
group by client_type
union all
select
dt2.client_type,
null,
count(distinct uid)
from
(select * from ${PLATFORM_ID}.valid where day=${yesterday}) dt1 join
(select user_id,client_type from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt2 on dt1.uid=dt2.user_id
group by dt2.client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170904110517441]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.2-day_user_time_apk]]></job_name> 
		<job_desc><![CDATA[v2.4.2-day_user_time_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 5 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_apk partition(day=${yesterday})
select
apk_version,
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}
group by apk_version
union all
select
apk_version,
null,
count(distinct uid)
from
(select * from ${PLATFORM_ID}.valid where day=${yesterday}) dt1 join
(select user_id,apk_version from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt2 on dt1.uid=dt2.user_id
group by apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170831150608706]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-viewcomb1_day]]></job_name> 
		<job_desc><![CDATA[v2.4.1-viewcomb1_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 55 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.viewcomb1_day partition(day=${yesterday})
select
"vod" video_type,
event_value['video_id'] video_id,
event_value['video_name'] video_name,
event_value['category_id'] category_id,
dt3.nns_category_name,
event_value['asset_id'] asset_id,
dt3.nns_name,
dt5.nns_id,
nns_cp,
dt1.sp_id,
user_id,
source_page_id_1 page_id ,
target_page_id_1 page_id_1
from
(select session_id,event_value,sp_id,source_page_id_1,target_page_id_1  from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3
on event_value['category_id']=dt3.nns_category_id and event_value['asset_id']=dt3.nns_id
left join
(select nns_id,nns_cp from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt4
on event_value['video_id']=dt4.nns_id
left join
(select nns_id,nns_name from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt5
on dt4.nns_cp=dt5.nns_name
group by
event_value['video_id'],
event_value['video_name'],
event_value['category_id'],
dt3.nns_category_name,
event_value['asset_id'],
dt3.nns_name,
dt5.nns_id,
nns_cp,
dt1.sp_id,
user_id,
source_page_id_1,
target_page_id_1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170831145517248]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_view_content_time_video]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_view_content_time_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 45 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_view_content_time_video partition(day=${yesterday})
select
dt1.sp_id,
"vod" video_type,
count(1)  cnt_view_times,
event_value['video_id'] video_id,
event_value['video_name'] video_name,
event_value['category_id'] category_id,
dt3.nns_category_name,
event_value['asset_id'] asset_id,
dt3.nns_name asset_name,
dt5.nns_id cp_id,
nns_cp cp_name,
source_page_id_1 page_id, 
target_page_id_1 page_id_1
from
(select session_id,event_value,sp_id,source_page_id_1,target_page_id_1 from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3
on event_value['category_id']=dt3.nns_category_id and event_value['asset_id']=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_cp,sp_id  from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt4
on event_value['video_id']=dt4.nns_id and dt1.sp_id=dt4.sp_id
left join
(select nns_id,nns_name,sp_id  from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt5
on dt4.nns_cp=dt5.nns_name  and dt1.sp_id=dt5.sp_id
group by
event_value['video_id'],
event_value['video_name'],
event_value['category_id'],
dt3.nns_category_name,
event_value['asset_id'],
dt3.nns_name,
dt5.nns_id,
nns_cp,
dt1.sp_id,
source_page_id_1,
target_page_id_1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170830201706173]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.16.1-day_content_time_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.16.1-day_content_time_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_playbill_category_asset partition(day=${yesterday})
select video_type,
playbill_id,
playbill_name,
category_id,
category_name,
asset_id,
asset_name,
video_id,
video_name,
count(distinct user_id),
count(1),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from 
(select dt1.video_type,dt1.video_id,
dt1.video_name,
dt1.category_id,
dt4.nns_category_name category_name,
dt1.asset_id,
dt4.nns_name asset_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
dt1.user_id,
dt1.play_sid,
item.nns_begin_time playbill_start_time,
item.nns_time_len playbill_length,
dt1.sp_id,
round(sum(if(end_time-start_time-if(duration is null,0,duration)>0,end_time-start_time-if(duration is null,0,duration),0))/(60.0*1000),6) cnt_play_length
from 
(select user_id,video_id,video_name,category_id,asset_id,max(server_time) end_time,min(server_time) start_time,playbill_length,playbill_start_time,play_sid,sp_id,video_type from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type in ('live','playback') group by user_id,video_id,video_name,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sp_id,video_type )dt1 left join(select user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,sum(duration) duration,video_type  from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type in ('live','playback') and event_type in ('buffer','pause') group by user_id,video_id,category_id,asset_id,playbill_length,playbill_start_time,play_sid,video_type )dt2 on dt1.user_id=dt2.user_id and dt1.video_id=dt2.video_id and dt1.category_id=dt2.category_id and dt1.asset_id=dt2.asset_id and dt1.play_sid = dt2.play_sid and dt1.video_type =dt2.video_type left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4 on dt1.category_id=dt4.nns_category_id and dt1.asset_id=dt4.nns_id and dt1.sp_id=dt4.sp_id left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.sp_id=item.sp_id 
group by dt1.video_type,dt1.video_id,
dt1.video_name,dt1.category_id,dt4.nns_category_name,dt1.asset_id,dt4.nns_name,item.nns_id,item.nns_name,dt1.user_id,dt1.play_sid,item.nns_begin_time,item.nns_time_len,dt1.sp_id)dt group by video_type,video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170830153319797]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_special_user_view]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_special_user_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_special_user_view partition(day=${yesterday})
select
special_id,
special_name,
user_id,
count(1)  cnt_view_times,
dt1.sp_id
from
(select session_id,event_value['special_name'] special_name,event_value['special_id'] special_id,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page' and event_value['special_id'] is not null and event_value['special_name'] is not null   ) dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
group by
dt1.special_id,
dt1.special_name,
dt1.sp_id,
user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170830134211509]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_special_video_view_play]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_special_video_view_play]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_special_video_view_play partition(day=${yesterday})
select
dt1.special_id special_id,
dt1.special_name special_name,
dt2.video_name video_name,
dt2.video_id video_id,
count(1) cnt_view_times,
max(cnt_play_times) cnt_play_times,
dt1.sp_id
from
(select session_id,event_value,sp_id,event_value['video_id'] video_id ,event_value['special_name'] special_name,event_value['special_id'] special_id,event_value['video_name'] video_name from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page'  and event_value['special_id'] is not null and event_value['special_name'] is not null and  event_value['video_id'] is not null and event_value['video_name'] is not null) dt1 
left join
(select count(1) cnt_play_times,video_id,video_name,ext_info['special_id'] special_id,ext_info['special_name'] special_name,sp_id   from ${PLATFORM_ID}.play_log where day=${yesterday} and ext_info['special_id'] is not null and
 ext_info['special_name'] is not null  and event_type='play'  group by video_id,ext_info['special_id'],ext_info['special_name'],sp_id,video_name) dt2
on dt1.video_id=dt2.video_id and dt1.sp_id=dt2.sp_id  and dt1.special_id=dt2.special_id
and dt1.special_name=dt2.special_name and dt1.video_name=dt2.video_name 
group by
dt2.video_id,
dt2.video_name,
dt1.sp_id,
dt1.special_id,
dt1.special_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828152034535]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-hour_user_time_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-hour_user_time_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 1 0/1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.hour_user_time_age partition(${partition_last_1_1h})
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
count(distinct user_id),
null
from (select user_id,sp_id from ${PLATFORM_ID}.heartbeat_log where ${where_last_1_1h}) dt1 left join
(select nns_id,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
union all
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
null,
sum(1)
from(
select
user_id
from ${PLATFORM_ID}.play_log where ${where_last_1_1h}
group by
user_id
having sum(if(event_type='play',1,0))>=1
) dt1 left join
(select nns_id,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828145942480]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_user_length]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_user_length]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_length partition(day=${yesterday})
select
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sum(min),
sp_id,
network_type
from(
select
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
dt1.sp_id,
network_type,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
count(distinct user_id) min
from
(select user_id,apk_version,client_type,server_time,sp_id,network_type from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1
left join
(select nns_id,nns_name,nns_addr_code,nns_addr_city,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2
on dt1.user_id=dt2.nns_id 
group by
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
dt1.sp_id,
network_type,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
cast(server_time/(60*1000) as bigint)) dt
group by
user_id,
nns_name,
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
nns_sex,
age,
sp_id,
network_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828145633643]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-usercomb2_day]]></job_name> 
		<job_desc><![CDATA[v2.4.1-usercomb2_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
insert overwrite table ${PLATFORM_ID}.usercomb2_day partition(day=${yesterday})
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
category_id,
dt3.nns_category_name,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
dt1.network_type,nns_boss_area_bind
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,network_type,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,network_type) dt1
join
(select uid,sp_id from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.sp_id=valid.sp_id
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id,dt1.network_type,nns_boss_area_bind
union all
select null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
null category_id,
null nns_category_name,
null asset_id,
null nns_name,
null nns_cp_id,
null nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
sp_id,
network_type,nns_boss_area_bind from (select session_id,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='view_twmz' group by session_id,sp_id)dt1 left join (select session_id,user_id,client_type,network_type,apk_version,max(region_code) region_code from ${PLATFORM_ID}.session_log where day>=${today-2} and day<=${yesterday} group by session_id,user_id,client_type,network_type,apk_version)dt2 on dt1.session_id=dt2.session_id left join (select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday})dt3 on dt2.user_id=dt3.nns_id group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,sp_id,network_type,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828144537992]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-usercomb1_hour]]></job_name> 
		<job_desc><![CDATA[v2.4.1-usercomb1_hour]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
insert overwrite table ${PLATFORM_ID}.usercomb1_hour partition(${partition_last_3_1h})
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
category_id,
dt3.nns_category_name,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
heartbeat_type
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where ${where_last_3_1h} group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type) dt1
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id,heartbeat_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828142450857]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-week_content_time_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-week_content_time_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_terminaltype_gender_age partition(day=${today-7})
select
video_type,
client_type terminaltype,
nns_sex gender,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
count(distinct user_id),
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,client_type from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id left join (select nns_id,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt1.uid=dt3.nns_id
where dt1.day=${today-7}
group by video_type,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
union all
select
video_type,
terminaltype,
gender,
age,
null,
sum(cnt_play_times),
sum(cnt_play_length)
from ${PLATFORM_ID}.day_content_time_terminaltype_gender_age where day>=${today-7} and day<${today}
group by video_type,
terminaltype,
gender,
age
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828141700020]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-hour_user_time_addr_apk_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-hour_user_time_addr_apk_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 1 0/1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.hour_user_time_addr_apk_terminaltype_gender_age partition(${partition_last_1_1h})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code),
nns_addr_city,
apk_version,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
count(distinct user_id),
count(user_id)
from
(select * from ${PLATFORM_ID}.startup_log where ${where_last_1_1h}) dt1 left join
(select * from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by
if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828141133353]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_user_time_addr_apk_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_user_time_addr_apk_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_addr_apk_terminaltype_gender_age partition(day=${yesterday})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code),
nns_addr_city,
apk_version,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
count(distinct user_id),
count(user_id),
dt1.sp_id
from
(select * from ${PLATFORM_ID}.startup_log where day=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by
if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828140744190]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_user_time_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_user_time_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_age partition(day=${yesterday})
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
count(distinct user_id),
null
from (select user_id,sp_id from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1 left join
(select nns_id,nns_age_cal,sp_id from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
union all
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
null,
count(distinct uid)
from (select * from ${PLATFORM_ID}.valid where day=${yesterday}) dt1 left join
(select nns_id,nns_age_cal,sp_id from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.uid=dt2.nns_id 
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828140312919]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-week_user_time_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-week_user_time_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_age partition(day=${today-7})
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
count(distinct user_id),
null  
from (select user_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}) dt1 left join
(select nns_id,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
union all
select
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
null,
sum(1)
from (select * from ${PLATFORM_ID}.week_valid where day=${today-7}) dt1 left join
(select nns_id,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.uid=dt2.nns_id
group by if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null)))))
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828135247149]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_content_time_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_content_time_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_terminaltype_gender_age partition(day=${yesterday})
select
dt.video_type,
dt.client_type,
dt.gender,
dt.age,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
video_type,
dt1.client_type,
nns_sex gender,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select video_type,client_type,user_id,event_type,play_sid,server_time,duration,sp_id from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid and dt1.sp_id=valid.sp_id
left join (select nns_id,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by video_type,dt1.client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),play_sid,user_id) dt
group by
dt.video_type,
dt.client_type,
dt.gender,
dt.age
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828134339331]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_content_time_video_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_content_time_video_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_terminaltype_gender_age partition(day=${yesterday})
select
video_type,
video_id,
video_name,
client_type,
gender,
age,
sum(if(cnt_play_length>1.0,1,0)),
sum(1),
sum(cnt_play_times),
sum(cnt_play_length)
from
(select
video_type,
video_id,
video_name,
client_type,
gender,
age,
user_id,
sum(cnt_play_times) cnt_play_times,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_type,
video_id,
video_name,
dt1.client_type,
nns_sex gender,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,play_sid,video_type,video_id,video_name,duration,client_type,server_time,event_type,sp_id from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid and dt1.sp_id=valid.sp_id
left join
(select nns_id,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by video_type,video_id,video_name,dt1.client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),play_sid,user_id) dt
group by
dt.video_type,
dt.video_id,
dt.video_name,
dt.client_type,
dt.gender,
dt.age,
dt.user_id) dtt
group by
video_type,
video_id,
video_name,
client_type,
gender,
age
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170828133745367]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-day_content_time_video_playbill_category_asset_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v2.4.1-day_content_time_video_playbill_category_asset_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_playbill_category_asset_terminaltype_gender_age partition(day=${yesterday})
select
'live',
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
terminaltype,
gender,
age,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from
(select
dt.video_id,
dt.video_name,
dt.playbill_id,
dt.playbill_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.client_type terminaltype,
dt.gender,
dt.age,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_id,
video_name,
item.nns_id playbill_id,
item.nns_name playbill_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
dt1.client_type,
nns_sex gender,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))) age,
user_id,
play_sid,
playbill_start_time,
playbill_length,
dt1.sp_id,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from
(select * from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='live') dt1
left join (select nns_id,nns_sex,nns_age_cal from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on user_id=dt2.nns_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid and dt1.sp_id=valid.sp_id
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time and dt1.sp_id=item.sp_id
group by
video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,dt1.client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,play_sid,playbill_start_time,playbill_length,dt1.sp_id) dt
group by
dt.video_id,
dt.video_name,
dt.playbill_id,
dt.playbill_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.client_type,
dt.gender,
dt.age,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id) dtt
group by video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,terminaltype,gender,age,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170823143105268]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.1-add partitions for meta-table]]></job_name> 
		<job_desc><![CDATA[v2.4.1-add partitions for meta-table]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		ALTER TABLE ${PLATFORM_ID}.nns_user ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_device ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_user_token ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_product_video ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_product ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_user_product ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_buy_order ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_vod ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_vod_index ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_assists ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_assists_category ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_assists_item ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_vod_media ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_video_label ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_live ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_live_playbill_item ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_address_code ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_ip_range ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_version_info ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_cp ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_item_tag_tmp ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_item_tag ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_product_content ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.ad_info ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_boss_user ADD PARTITION(day=${tomorrow}); 
ALTER TABLE ${PLATFORM_ID}.nns_user_extends ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.sw_nns_user ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.sw_nns_article ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.sw_nns_column ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.sw_nns_company ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.nns_auto_renew_order ADD PARTITION(day=${tomorrow});
ALTER TABLE ${PLATFORM_ID}.yun_play_log ADD PARTITION(day=${tomorrow});          
            ALTER TABLE ${PLATFORM_ID}.nns_pay_order ADD PARTITION(day=${tomorrow});
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170821160214478]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.4.0-day_user_registered_details]]></job_name> 
		<job_desc><![CDATA[v2.4.0-day_user_registered_details]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_registered_details partition(day=${yesterday})
SELECT 
nns_id,
nns_name, 
nns_email, 
nns_telephone,
nns_addr , 
nns_contact, 
nns_create_time, 
nns_user_id_card, 
nns_age, 
nns_sex , 
nns_from,
nns_addr_city, 
nns_age_cal, 
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code, 
d1.client_type, 
dt1.sp_id, 
d1.apk_version ,
d1.device_id 
FROM (
SELECT * FROM ${PLATFORM_ID}.nns_user WHERE day = ${yesterday} AND from_unixtime(CAST(nns_create_time / 1000 AS bigint), 'yyyyMMdd') = '${yesterday}' AND nns_state = 0 ) dt1
LEFT JOIN 
(SELECT user_id,max(apk_version) apk_version, max(client_type) client_type, max(device_id) device_id ,max(region_code) region_code FROM ${PLATFORM_ID}.heartbeat_log WHERE day = ${yesterday} group by user_id) d1 on dt1.nns_id = d1.user_id 
GROUP BY nns_id, nns_name, nns_email, nns_telephone, nns_addr, nns_contact, nns_create_time, nns_user_id_card, nns_age, nns_sex, nns_from, nns_addr_city, nns_age_cal, if(length(nns_addr_code)>6,nns_addr_code,region_code), apk_version, client_type, dt1.sp_id, device_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170811143811293]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-day_content_time_category_asset_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.3.1-day_content_time_category_asset_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_category_asset_terminaltype partition(day=${yesterday})
select
dt.video_type,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.client_type,
count(distinct user_id)
from
(select
video_type,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
dt1.client_type,
play_sid,
user_id
from (select category_id,asset_id,video_type,user_id,play_sid,client_type from ${PLATFORM_ID}.play_log where day=${yesterday} group by category_id,asset_id,video_type,user_id,play_sid,client_type) dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by video_type,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,dt1.client_type,play_sid,user_id) dt
group by
dt.video_type,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170811143742404]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-day_content_time_video_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.3.1-day_content_time_video_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:12.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:12.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_terminaltype partition(day=${yesterday})
select
dt.video_type,
video_id,
video_name,
client_type,
count(distinct user_id)
from
(select
video_type,
video_id,
video_name,
dt1.client_type,
play_sid,
user_id
from 
(select video_type,video_id,video_name,client_type,user_id,play_sid from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,video_id,video_name,dt1.client_type,play_sid,user_id) dt
group by dt.video_type,video_id,video_name,client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170811143450988]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-day_content_time_addr_terminaltype]]></job_name> 
		<job_desc><![CDATA[v2.3.1-day_content_time_addr_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_addr_terminaltype partition(day=${yesterday})
select
dt.video_type,
nns_addr_code,
nns_addr_city,
client_type,
count(distinct user_id)
from
(select
video_type,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
dt1.client_type,
play_sid,
user_id
from 
(select video_type,client_type,user_id,play_sid,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2
on dt1.user_id=dt2.nns_id
group by video_type,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,dt1.client_type,play_sid,user_id) dt
group by dt.video_type,nns_addr_code,nns_addr_city,client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170807135243726]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-recommend_scene_info]]></job_name> 
		<job_desc><![CDATA[v2.3.1-recommend_scene_info]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.recommend_scene_info
select scene_id,scene_name from mysql.${PLATFORM_ID}.scene_info
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170720132803320]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-month_summary]]></job_name> 
		<job_desc><![CDATA[v2.3.1-month_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_summary partition(day=${yesterday})
select
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length),
null,
null,
null,
null,
null,
null,
null,
null,
null,
null ,terminaltype,sp_id
from ${PLATFORM_ID}.day_content_time_addr_apk_video_category_mode_asset_cp_playbill_terminaltype_gender_age_user  where day>=${first_day} and day<${today}
group by video_type,terminaltype,sp_id
union all
select
null video_type,
null,
null,
null,
null,
null,
sum(cnt_user_new_total),
null,
null,
null,
null,
null,
null,
null ,terminaltype,sp_id
from ${PLATFORM_ID}.user_time_addr_gender_age_day where day>=${first_day} and day<${today} group by terminaltype,sp_id
union all
select
null video_type,
null,
null,
null,
null,
null,
null,
sum(cnt_order_pay_total),
sum(cnt_order_pay_user_total),
sum(cnt_order_pay_money_total),
null,
null,
null,
null ,client_type terminaltype,sp_id
from ${PLATFORM_ID}.day_pay_time_product_video_channel_type_addr where day>=${first_day} and day<${today} group by client_type,sp_id
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show),
sum(cnt_ad_click),
null,
null,null terminaltype,null sp_id
from  ${PLATFORM_ID}.day_ad_time_view where day>=${first_day} and day <=${yesterday}
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show_user),
sum(cnt_ad_click_user) ,null terminaltype,null sp_id
from  ${PLATFORM_ID}.day_ad_time_user where day>=${first_day} and day <=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170720104957857]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-week_summary]]></job_name> 
		<job_desc><![CDATA[v2.3.1-week_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_summary partition(day=${yesterday})
select 
video_type,
count(distinct user_id),
sum(cnt_play_times),
sum(cnt_play_length),
null,
null,
null,
null,
null,
null,
null,
null,
null,
null ,terminaltype,sp_id
from ${PLATFORM_ID}.day_content_time_addr_apk_video_category_mode_asset_cp_playbill_terminaltype_gender_age_user where day>=${monday} and day<${today}
group by video_type ,terminaltype,sp_id
union all
select 
null video_type,
null,
null,
null,
null,
null,
sum(cnt_user_new_total),
null,
null,
null,
null,
null,
null,
null ,terminaltype,sp_id
from ${PLATFORM_ID}.user_time_addr_gender_age_day where day>=${monday} and day<${today} group by terminaltype,sp_id
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
sum(cnt_order_pay_total),
sum(cnt_order_pay_user_total),
sum(cnt_order_pay_money_total),
null,
null,
null,
null,client_type terminaltype,sp_id
from ${PLATFORM_ID}.day_pay_time_product_video_channel_type_addr where day>=${monday} and day<${today} group by client_type,sp_id
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show),
sum(cnt_ad_click),
null,
null,null terminaltype,null sp_id
from  ${PLATFORM_ID}.day_ad_time_view where day>=${monday} and day <=${yesterday}
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(cnt_ad_show_user),
sum(cnt_ad_click_user) ,
null terminaltype,null sp_id
from  ${PLATFORM_ID}.day_ad_time_user where day>=${monday} and day <=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170711104112989]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_content_time_video_playbill_category_asset]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_content_time_video_playbill_category_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_playbill_category_asset partition(day=${yesterday})
select
'live',
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from
(select
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_id,
dt4.nns_name video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
item.nns_id playbill_id,
item.nns_name playbill_name,
user_id,
play_sid,
playbill_start_time,
playbill_length,
dt1.sp_id,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='live') dt1
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time  and dt1.sp_id=item.sp_id left join (select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_live where day=${yesterday})dt4 on dt1.video_id=dt4.nns_id and dt1.sp_id=dt4.sp_id
group by video_id,dt4.nns_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,user_id,play_sid,playbill_start_time,playbill_length,dt1.sp_id) dt
group by
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.playbill_id,
dt.playbill_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id) dtt
group by video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170709113126067]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.0-day_tag_use]]></job_name> 
		<job_desc><![CDATA[v2.3.0-day_tag_use]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 35 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_tag_use partition(day=${yesterday})
select tag2_code,tag3_name,sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,nns_addr_city,sum(tag3_cnt) cnt_tag_use_total from 
(select * from ${PLATFORM_ID}.user_tag_day where day=${yesterday} and tag1_code=01)dt1 left join (select * from ${PLATFORM_ID}.nns_user where day = ${yesterday})dt2 on dt1.user_id = dt2.nns_id 
left join (select user_id, max(user_addr) region_code from ${PLATFORM_ID}.day_devicecomb where day=${yesterday} group by user_id) dt3
on dt1.user_id=dt3.user_id 
group by tag2_code,tag3_name,sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170709110708840]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.0-day_search_words]]></job_name> 
		<job_desc><![CDATA[v2.3.0-day_search_words]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_search_words partition(day=${yesterday})
select search_key,result_key,dt.sp_id,apk_version,client_type,if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,nns_addr_city,count(1) cnt_search_word from (select dt1.*,dt2.apk_version,dt2.client_type,dt2.user_id,dt2.region_code from (select session_id,event_value['search_key'] search_key,event_value['result_key'] result_key,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name = 'search' and event_value['result_key'] is not null)dt1 left join (select * from ${PLATFORM_ID}.session_log where day=${yesterday})dt2 on dt1.session_id = dt2.session_id)dt left join (select * from ${PLATFORM_ID}.nns_user where day = ${yesterday})user on dt.user_id = user.nns_id group by search_key,result_key,dt.sp_id,apk_version,client_type,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170703171330387]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.4-day_user_portrait]]></job_name> 
		<job_desc><![CDATA[v2.2.4-day_user_portrait]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_portrait partition(day=${yesterday})
select  user.nns_id,min(user.nns_state),min(user.nns_sex),min(user.nns_age_cal),min(user.nns_from),min(user.nns_addr_city),min(addr.nns_name),min(device.client_type),max(datediff(cast(device.day as string),cast(create_time as string))) online_days,max(device.system_name),max(device.system_version),max(device.network_type),sum(money),max(pay_channel),concat_ws(',',collect_list(vod.nns_view_type)) view_type,concat_ws(',',collect_list(vod.nns_area)) area,concat_ws(',',collect_list(vod.show_time)) show_time,concat_ws(',',collect_list(vod.nns_language)) language,concat_ws(',',collect_list(vod.nns_director)) director,concat_ws(',',collect_list(regexp_replace(nns_actor,'[/+]',','))) actor,concat_ws(',',collect_list(vod.nns_producer)) producer,concat_ws(',',collect_list(vod.nns_screenwriter)) screenwriter,concat_ws(',',collect_list(vod.nns_copyright)) copyright,concat_ws(',',collect_list(vodMedia.nns_mode)) mode,concat_ws(',',collect_list(vodMedia.nns_dimensions)) dimensions,concat_ws(',',collect_list(vodMedia.nns_file_coding)) file_code,concat_ws(',',collect_list(if(hot.video_id is not null,'hot',hot.video_id))) from (select nns_id,max(nns_state) nns_state,max(nns_sex) nns_sex,max(nns_age_cal) nns_age_cal,max(nns_from) nns_from,min(nns_addr_city) nns_addr_city,sp_id,max(nns_addr_code) nns_addr_code from ${PLATFORM_ID}.nns_user where day = ${yesterday} group by nns_id,sp_id)user left join (select sp_id,nns_code,nns_name from ${PLATFORM_ID}.nns_address_code where day=${yesterday} and length(nns_code)=6)addr on substr(user.nns_addr_code,1,6)= addr.nns_code and user.sp_id=addr.sp_id left join (select user_id,video_id,episode_id,play_time_length from ${PLATFORM_ID}.day_content_user_time_device_video_playbill_apk_type where day=${yesterday} and video_type = 'vod')play on user.nns_id = play.user_id left join (select *,from_unixtime(cast(nns_show_time/1000 as bigint),'yyyy') show_time from ${PLATFORM_ID}.nns_vod where day=${yesterday})vod on play.video_id = vod.nns_id left join (select nns_vod_id,nns_mode,nns_vod_index_id,nns_dimensions,nns_file_coding from ${PLATFORM_ID}.nns_vod_media where day=${yesterday})vodMedia on play.video_id=vodMedia.nns_vod_id and play.episode_id = vodMedia.nns_vod_index_id left join (select video_id,sum(scorce) scorces from ${PLATFORM_ID}.day_recommed_hot_play_video_scorce where day >=${today-7} and day <=${yesterday} group by video_id order by scorces desc limit 200)hot on play.video_id = hot.video_id left join (select user_id,max(day) day,min(create_time) create_time,min(client_type) client_type,max(system_name) system_name,max(system_version) system_version,max(network_type) network_type from ${PLATFORM_ID}.day_devicecomb where day=${yesterday} group by user_id)device on user.nns_id = device.user_id left join (select nns_user_id,sum(nns_order_price) money,concat_ws(',',collect_list(nns_pay_channel_id)) pay_channel from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-31}' group by nns_user_id)sale on sale.nns_user_id = user.nns_id group by user.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170703093614723]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.4-dayly_device_time_online]]></job_name> 
		<job_desc><![CDATA[v1.8.4-dayly_device_time_online]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 34 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_device_time_online1 partition(${partition_last_4_5m})
select coalesce(dt.device_id,history.device_id),coalesce(dt.user_id,history.user_id),coalesce(dt.client_type,history.client_type),
coalesce(dt.apk_version,history.apk_version),coalesce(dt.sp_id,history.sp_id),coalesce(dt.mac,history.mac),coalesce(dt.ip,history.ip),
coalesce(dt.system_name,history.system_name),coalesce(dt.system_version,history.system_version),coalesce(dt.server_time,history.server_time),
coalesce(dt.states,'offline') from 
(select device_id,user_id,max(client_type) client_type, max(apk_version) apk_version,max(sp_id) sp_id,max(mac) mac,max(ip) ip,max(system_name) system_name,max(system_version) system_version,max(server_time) server_time from ${PLATFORM_ID}.day_device_time_online1 where ${where_last_160_10m} group by device_id,user_id)history  full outer join  (select dt1.device_id,dt1.user_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version,from_unixtime(cast(dt1.server_time/1000 as bigint),'yyyy-MM-dd HH:mm:ss') server_time,'online' states from 
(select device_id,user_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version, server_time from ${PLATFORM_ID}.heartbeat_log where 
${where_last_4_5m})dt1 join (select user_id,device_id,max(server_time) last_time from ${PLATFORM_ID}.heartbeat_log where ${where_last_4_5m} group by user_id,device_id)dt2 on 
dt1.device_id=dt2.device_id and dt1.user_id=dt2.user_id and dt1.server_time=dt2.last_time)dt on dt.device_id=history.device_id and dt.user_id = history.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170630171744645]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-get_target_list]]></job_name> 
		<job_desc><![CDATA[v2.2.1-get_target_list]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.pay_page_list
select target,sp_id from (select target,sp_id from ${PLATFORM_ID}.day_pay_graphx_sp_apk_client where target like '%-pay_cancel' or target like '%-pay_create' or target like '%-pay_error' or target like '%-pay_ok'  and day = ${yesterday} group by target,sp_id union all select target,sp_id from ${PLATFORM_ID}.pay_page_list)a group by target,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170630113235005]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_content_time_sp]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_content_time_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_sp partition(day=${yesterday})
select
sp_id,
dt.video_type,
count(distinct user_id),
sum(cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
null
from
(select
dt1.sp_id,
video_type,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from 
(select * from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by dt1.sp_id,video_type,play_sid,user_id) dt
group by sp_id,dt.video_type
union all
select
dt1.sp_id,
"vod" video_type,
null,
null,
null,
sum(1),
count(distinct user_id)
from
(select sp_id,session_id,event_value from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170630110446216]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_content_cnt_category]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_content_cnt_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_cnt_category partition(day=${yesterday})
select
'vod',
dt2.nns_mode,
dt3.nns_id,
dt1.nns_cp,
nns_category_id,
dt1.sp_id
from
(select nns_id,nns_cp,sp_id from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1 
left join
(select nns_vod_id,nns_mode,sp_id from ${PLATFORM_ID}.nns_vod_media where day=${yesterday})  dt2
on dt1.nns_id=dt2.nns_vod_id and dt1.sp_id=dt2.sp_id
left join
(select nns_id,nns_name,sp_id from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt3
on dt1.nns_cp=dt3.nns_name and dt1.sp_id=dt3.sp_id
left join
(select nns_video_id,nns_category_id,sp_id from ${PLATFORM_ID}.nns_assists_item where day=${yesterday}) dt4 on dt1.nns_id=dt4.nns_video_id and dt1.sp_id=dt4.sp_id
group by
dt2.nns_mode,
dt3.nns_id,
dt1.nns_cp,
nns_category_id,
dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170628144555236]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.1.0-sdkws-outfile]]></job_name> 
		<job_desc><![CDATA[sdkws-outfile]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 2/10 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[bash /cluster/jobs/sdkws-outfile-*/bin/yarn-client]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[1]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170627153617754]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.0-day_devicecomb1]]></job_name> 
		<job_desc><![CDATA[v2.2.0-day_devicecomb1]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_devicecomb partition(day=${yesterday}) 
select coalesce(dt.device_id,history.device_id),coalesce(dt.client_type,history.client_type),
coalesce(dt.apk_version,history.apk_version),coalesce(dt.sp_id,history.sp_id),coalesce(dt.mac,history.mac),coalesce(dt.ip,history.ip),
coalesce(dt.system_name,history.system_name),coalesce(dt.system_version,history.system_version),coalesce(dt.region,history.user_addr),
coalesce(dt.nns_name,history.user_addr_name),coalesce(history.create_time,dt.create_time),coalesce(dt.user_id,history.user_id),coalesce(dt.network_type,history.network_type),coalesce(dt.report_source,history.report_source), coalesce(dt.modify_time,history.modify_time) from 
(select device_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version,user_addr,user_addr_name,create_time,user_id,network_type,report_source, modify_time from ${PLATFORM_ID}.day_devicecomb where day=${today-2} group by device_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version,user_addr,user_addr_name,create_time,user_id,network_type,report_source, modify_time) as history full outer join (select dt1.device_id,client_type,apk_version,dt1.sp_id,mac,ip,system_name,system_version,if(length(nns_addr_code)>6,nns_addr_code,region_code) region,nns_addr_city nns_name,${yesterday} create_time,user_id,network_type,report_source, dt2.modify_time from 
(select device_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version,server_time,user_id,network_type,report_source,max(region_code) region_code from ${PLATFORM_ID}.heartbeat_log where 
day=${yesterday} group by device_id,client_type,apk_version,sp_id,mac,ip,system_name,system_version,server_time,user_id,network_type,report_source)dt1 join (select device_id,min(server_time) last_time, max(server_time) modify_time from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by device_id)dt2 on 
dt1.device_id=dt2.device_id and dt1.server_time=dt2.last_time left join (select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) user_info on dt1.user_id = user_info.nns_id)dt on history.device_id = dt.device_id and history.sp_id=dt.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170626162037145]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-detail_user]]></job_name> 
		<job_desc><![CDATA[v2.3.1-detail_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.detail_user partition(day=${yesterday})
select
dt.user_id,
dt.device_id,
dt.video_type,
nns_addr_code,
nns_addr_city,
category_id,
nns_category_name,
asset_id,
asset_name,
video_id,
video_name,
sp_id,
apk_version,
client_type,
nns_nns_boss_area_bind,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
user_id,
dt4.nns_id device_id,
video_type,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
category_id,
nns_category_name,
asset_id,
dt3.nns_name asset_name,
video_id,
video_name,
dt1.sp_id,
apk_version,
dt1.client_type,
nns_nns_boss_area_bind,
play_sid,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,video_type,video_id,video_name,category_id,asset_id,event_type,play_sid,server_time,duration,apk_version,client_type,sp_id,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt3.sp_id=dt1.sp_id
left join
(select nns_id,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
left join
(select nns_id,nns_user_id,sp_id from ${PLATFORM_ID}.nns_device where day=${yesterday}) dt4
on dt1.user_id=dt4.nns_user_id and dt1.sp_id=dt4.sp_id
group by
user_id,
dt4.nns_id,
video_type,
if(length(nns_addr_code)>6,nns_addr_code,region_code),
nns_addr_city,
category_id,
nns_category_name,
asset_id,
dt3.nns_name,
video_id,
video_name,
dt1.sp_id,
apk_version,
dt1.client_type,
nns_nns_boss_area_bind,
play_sid) dt
group by
dt.user_id,
dt.device_id,
dt.video_type,
nns_addr_code,
nns_addr_city,
category_id,
nns_category_name,
asset_id,
asset_name,
video_id,
video_name,
sp_id,
apk_version,
client_type,
nns_nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170626155425240]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_view_time_video_category_asset_cp_sp]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_view_time_video_category_asset_cp_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_view_time_video_category_asset_cp_sp partition(day=${yesterday})
select
"vod",
event_value['video_id'] video_id,
event_value['video_name'] video_name,
event_value['category_id'] category_id,
dt2.nns_category_name cn,
event_value['asset_id'] asset_id,
dt2.nns_name an,
dt4.nns_id,
nns_cp,
dt1.sp_id,
sum(1),
event_value['page_id'],
apk_version
from
(select session_id,event_value,sp_id,event_value['page_id'] from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,apk_version from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,apk_version)session on dt1.session_id = session.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt2
on event_value['category_id']=dt2.nns_category_id and event_value['asset_id']=dt2.nns_id
left join
(select nns_id,nns_cp from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt3
on event_value['video_id']=dt3.nns_id
left join
(select nns_id,nns_name from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt4
on dt3.nns_cp=dt4.nns_name
group by
event_value['video_id'],
event_value['video_name'],
event_value['category_id'],
dt2.nns_category_name,
event_value['asset_id'],
dt2.nns_name,
dt4.nns_id,
nns_cp,
dt1.sp_id,
event_value['page_id'],
apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170620213528397]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.0-day_pay_time_user]]></job_name> 
		<job_desc><![CDATA[v2.2.0-day_pay_time_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_pay_time_user partition(day=${yesterday})
select user_id,sum(order_price) cnt_order_pay_money_total,count(1) cnt_order_pay_total,nns_boss_area_bind,sp_id from ${PLATFORM_ID}.day_sales_basic_data where day=${yesterday} and nns_order_state = 1 group by user_id,nns_boss_area_bind,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170619122137671]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_content_time_video]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_content_time_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video partition(day=${yesterday})
select
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.video_type,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
null,
nns_view_type content_type,
dt.apk_version,
null  page_id,
dt.sp_id 
from
(select
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
video_type,
play_sid,
user_id,
nns_view_type,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time,
apk_version,
dt1.sp_id 
from (select video_id,video_name,category_id,asset_id,video_type,user_id,event_type,play_sid,server_time,duration,apk_version,sp_id from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and  dt1.sp_id=dt3.sp_id 
left join (select nns_id,nns_view_type,sp_id  from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt4 on dt1.video_id=dt4.nns_id and  dt1.sp_id=dt4.sp_id 
group by video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,video_type,play_sid,user_id,nns_view_type,dt1.apk_version,dt1.sp_id) dt
group by
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.video_type,
nns_view_type,
dt.apk_version,
dt.sp_id 
union all
select
event_value['video_id'] video_id,
event_value['video_name'] video_name,
event_value['category_id'] category_id,
dt4.nns_category_name cn,
event_value['asset_id'] asset_id,
dt4.nns_name an,
"vod" video_type,
null,
null,
null,
sum(1),
count(distinct user_id),
null content_type,
apk_version,
null page_id,
dt1.sp_id
from
(select session_id,event_value,sp_id from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id,apk_version,sp_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,apk_version,sp_id) dt2
on dt1.session_id=dt2.session_id and dt1.sp_id=dt2.sp_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by
event_value['video_id'],
event_value['video_name'],
event_value['category_id'],
dt4.nns_category_name,
event_value['asset_id'],
dt4.nns_name,
dt2.apk_version,
dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614105544224]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-monthly delete cnt_user]]></job_name> 
		<job_desc><![CDATA[v2.2.1-monthly delete cnt_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		delete from ${PLATFORM_ID}.cnt_play_user;
delete from ${PLATFORM_ID}.cnt_user_online;
delete from ${PLATFORM_ID}.cnt_user_active;
delete from ${PLATFORM_ID}.cnt_order_user_total
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/mysql-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614105449942]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-cnt_order_user_total]]></job_name> 
		<job_desc><![CDATA[v2.2.1-cnt_order_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.cnt_order_user_total
select cast(nns_user_id as varchar(100)) nns_user_id 
from hive.${PLATFORM_ID}.nns_buy_order where day=${yesterday} 
and date_format(from_unixtime(cast(nns_create_time/1000 as bigint)),'%Y%m%d')='${yesterday}' and nns_order_state = 1 group by nns_user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614105334293]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-cnt_user_active]]></job_name> 
		<job_desc><![CDATA[v2.3.1-cnt_user_active]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.cnt_user_active
select 
if(uid is null,cast('' as varchar(100)),cast(uid as varchar(100))) uid, 
if(client_type is null,cast('' as varchar(100)),cast(client_type as varchar(100))) client_type, 
if(sp_id is null,cast('' as varchar(100)),cast(sp_id as varchar(100))) sp_id 
from hive.${PLATFORM_ID}.valid 
where day=${yesterday} 
group by uid,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614105234990]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-cnt_user_online]]></job_name> 
		<job_desc><![CDATA[v2.3.1-cnt_user_online]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.cnt_user_online
select cast(user_id as varchar(100)) user_id,cast(client_type as varchar(100)) client_type,cast(sp_id as varchar(100)) from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by user_id,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614105041279]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-cnt_play_user]]></job_name> 
		<job_desc><![CDATA[v2.2.1-cnt_play_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.cnt_play_user
select
cast(video_type as varchar(100)) video_type,
cast(user_id as varchar(100)) user_id
from
hive.${PLATFORM_ID}.valid d1 join (select user_id,video_type from hive.${PLATFORM_ID}.play_log where day=${yesterday} group by user_id,video_type) d2
on d1.uid=d2.user_id
where d1.day=${yesterday}
group by video_type,user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170614104854012]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1-day_user]]></job_name> 
		<job_desc><![CDATA[v2.2.1-day_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.day_user select ${yesterday},schema_id,run_status,sample_space/100*(select sum(1)*1.0 from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) from (select schema_id,run_status,sample_space from mysql.${PLATFORM_ID}.schema_info group by schema_id,run_status,sample_space) dt
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170516141704739]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[drop-partitions-for-5mins]]></job_name> 
		<job_desc><![CDATA[drop-partitions-for-5mins]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		${PLATFORM_ID}.user_time_addr_apk_terminaltype_gender_age_5minute;
${PLATFORM_ID}.user_time_sp_5minute;
${PLATFORM_ID}.user_time_terminaltype_5minute;
${PLATFORM_ID}.user_time_5minute;
${PLATFORM_ID}.ad_time_content_user_view_5minute;
${PLATFORM_ID}.day_device_time_online1;
${PLATFORM_ID}.devicecomb2_5minute;
${PLATFORM_ID}.usercomb2_5minute;
${PLATFORM_ID}.usercomb1_5minute;
${PLATFORM_ID}.user_time_apk_5minute;
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/del-partitions.sh ${run_id} ${run_time} 2]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170414103352218]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-recommend_times]]></job_name> 
		<job_desc><![CDATA[v1.7.1-recommend_times]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[python /cluster/jobs/recommend_times/main.py ${yesterday} eshost=${ESHOST} ${MYSQL}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170412143845257]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-day_user_time_startup]]></job_name> 
		<job_desc><![CDATA[v1.8.1-day_user_time_startup]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_startup partition(day=${yesterday})
select from_unixtime(cast(cast(server_time as double)/1000 as bigint),'yyyy-MM-dd HH:mm:ss') as startup_time,user_id,device_id,sp_id,apk_version,client_type  from ${PLATFORM_ID}.startup_log where day = ${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329141332258]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-month_user_time_apk]]></job_name> 
		<job_desc><![CDATA[v1.8.1-month_user_time_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_user_time_apk partition(day=${last_month})
select
apk_version,
count(distinct user_id),
null
from ${PLATFORM_ID}.usercomb1_day where day>=${last_month} and day<=${yesterday}
group by apk_version
union all
select
apk_version,
null,
count(distinct user_id)
from
${PLATFORM_ID}.usercomb2_day where day>=${last_month} and day<=${yesterday}
group by apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329141157414]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-month_user_time_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.8.1-month_user_time_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_user_time_terminaltype partition(day=${last_month})
select
terminaltype,
count(distinct user_id),
null
from ${PLATFORM_ID}.usercomb1_day where day>=${last_month} and day<=${yesterday}
group by terminaltype
union all
select
terminaltype,
null,
count(distinct user_id)
from
 ${PLATFORM_ID}.usercomb2_day  where day>=${last_month} and day<=${yesterday}
group by terminaltype
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329130510398]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-usercomb2_month]]></job_name> 
		<job_desc><![CDATA[v1.8.1-usercomb2_month]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 6 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.usercomb2_month partition(day=${last_month})
select
video_type,user_addr ,user_addr_name,apk_version,category_id,category_name,asset_id,asset_name,cp_id,cp_name,terminaltype,gender,age,user_id,sp_id,network_type,nns_boss_area_bind 
from  ${PLATFORM_ID}.usercomb2_day where day >=${last_month} and day<=${yesterday} group by video_type,user_addr ,user_addr_name,apk_version,category_id,category_name,asset_id,asset_name,cp_id,cp_name,terminaltype,gender,age,user_id,sp_id,network_type,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329125833004]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-usercomb1_month]]></job_name> 
		<job_desc><![CDATA[v1.8.1-usercomb1_month]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 6 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.usercomb1_month partition(day=${last_month})
select
video_type,user_addr,user_addr_name,apk_version,video_id,video_name,category_id,category_name ,nns_mode,asset_id,asset_name,cp_id ,cp_name,terminaltype,gender,age,user_id,sp_id,heartbeat_type,network_type,nns_boss_area_bind from ${PLATFORM_ID}.usercomb1_day where day>=${last_month} and day<=${yesterday}
group by
video_type,user_addr,user_addr_name,apk_version,video_id,video_name,category_id,category_name ,nns_mode,asset_id,asset_name,cp_id ,cp_name,terminaltype,gender,age,user_id,sp_id,heartbeat_type,network_type,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329124546848]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-usercomb1_week]]></job_name> 
		<job_desc><![CDATA[v1.8.1-usercomb1_week]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.usercomb1_week partition(day=${today-7})
select
video_type,user_addr,user_addr_name,apk_version,video_id,video_name,category_id,category_name ,nns_mode,asset_id,asset_name,cp_id ,cp_name,terminaltype,gender,age,user_id,sp_id,heartbeat_type,network_type,nns_boss_area_bind from ${PLATFORM_ID}.usercomb1_day where day>=${today-7} and day<=${yesterday}
group by
video_type,user_addr,user_addr_name,apk_version,video_id,video_name,category_id,category_name ,nns_mode,asset_id,asset_name,cp_id ,cp_name,terminaltype,gender,age,user_id,sp_id,heartbeat_type,network_type,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170329110732779]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-usercomb2_week]]></job_name> 
		<job_desc><![CDATA[v1.8.1-usercomb2_week]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 10 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.usercomb2_week partition(day=${today-7})
select
video_type,user_addr ,user_addr_name,apk_version,category_id,category_name,asset_id,asset_name,cp_id,cp_name,terminaltype,gender,age,user_id,sp_id,network_type,nns_boss_area_bind
from  ${PLATFORM_ID}.usercomb2_day where day >=${today-7} and day<=${yesterday} group by video_type,user_addr ,user_addr_name,apk_version,category_id,category_name,asset_id,asset_name,cp_id,cp_name,terminaltype,gender,age,user_id,sp_id,network_type,nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170328162220838]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-user_time_addr_gender_age_month]]></job_name> 
		<job_desc><![CDATA[v1.8.1-user_time_addr_gender_age_month]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_addr_gender_age_month partition(day=${last_month})
select user_addr,user_addr_name,gender,age,max(cnt_user_all_stored),sum(cnt_user_new_total),sum(cnt_user_downtime),sp_id,apk_version,terminaltype from ${PLATFORM_ID}.user_time_addr_gender_age_day where day>=${last_month} and day<=${yesterday} group by user_addr,user_addr_name,gender,age,sp_id,apk_version,terminaltype
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170328140814256]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-user_time_addr_gender_age_week]]></job_name> 
		<job_desc><![CDATA[v1.8.1-user_time_addr_gender_age_week]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_addr_gender_age_week partition(day=${today-7})
select user_addr,user_addr_name,gender,age,max(cnt_user_all_stored),sum(cnt_user_new_total),sum(cnt_user_downtime),sp_id,apk_version,terminaltype from ${PLATFORM_ID}.user_time_addr_gender_age_day where day>=${today-7} and day<=${yesterday} group by user_addr,user_addr_name,gender,age,sp_id,apk_version,terminaltype
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170323153648436]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V1.8.1-month_user_total_month]]></job_name> 
		<job_desc><![CDATA[V1.8.1-month_user_total_month]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 3 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_user_total partition(day=${last_month})
select count(distinct nns_id) from ${PLATFORM_ID}.nns_user where day=${yesterday} and nns_state = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170323152834249]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V1.8.1-month_user_total]]></job_name> 
		<job_desc><![CDATA[V1.8.1-month_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_user_total partition(day=${first_day})
select count(distinct nns_id) from ${PLATFORM_ID}.nns_user where day=${yesterday} and nns_state = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170323152007871]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V1.8.1-week_user_total_week]]></job_name> 
		<job_desc><![CDATA[V1.8.1-week_user_total_week]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 10 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_total partition(day=${today-7})
select count(distinct nns_id) from ${PLATFORM_ID}.nns_user where day=${yesterday} and nns_state = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170323151133554]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[V1.8.1-week_user_total]]></job_name> 
		<job_desc><![CDATA[V1.8.1-week_user_total]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 35 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_total partition(day=${monday})
select count(distinct nns_id) from ${PLATFORM_ID}.nns_user where day=${yesterday} and nns_state = 0
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170317160143126]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_content_time_video_playbill_category_asset_apk]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_content_time_video_playbill_category_asset_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_playbill_category_asset_apk partition(day=${yesterday})
select
'live',
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
apk_version,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from
(select
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.playbill_id,
dt.playbill_name,
dt.apk_version,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
item.nns_id playbill_id,
item.nns_name playbill_name,
apk_version,
user_id,
play_sid,
playbill_start_time,
playbill_length,
dt1.sp_id,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='live') dt1 
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time
group by video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,apk_version,user_id,play_sid,playbill_start_time,playbill_length,dt1.sp_id) dt
group by
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.playbill_id,
dt.playbill_name,
dt.apk_version,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id) dtt
group by video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,apk_version,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170317160018111]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_content_time_video_playbill_category_asset_addr]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_content_time_video_playbill_category_asset_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_video_playbill_category_asset_addr partition(day=${yesterday})
select
'live',
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
playbill_id,
playbill_name,
nns_addr,
nns_addr_name,
sum(if(cnt_play_length>1.0,1,0)),
count(distinct user_id),
sum(cnt_play_length),
playbill_start_time,
playbill_length,
sp_id
from
(select
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn category_name,
dt.asset_id,
dt.an asset_name,
dt.playbill_id,
dt.playbill_name,
dt.ncode nns_addr,
dt.ncity nns_addr_name,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6) cnt_play_length
from
(select
video_id,
video_name,
category_id,
dt3.nns_category_name cn,
asset_id,
dt3.nns_name an,
item.nns_id playbill_id,
item.nns_name playbill_name,
nns_addr_code ncode,
nns_addr_city ncity,
user_id,
play_sid,
playbill_start_time,
playbill_length,
dt1.sp_id,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,video_id,video_name,category_id,asset_id,event_type,server_time,sp_id,playbill_name,playbill_length,playbill_start_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='live') dt1
left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}) item on dt1.video_id=item.nns_live_id and dt1.playbill_length/1000=item.nns_time_len and dt1.playbill_start_time=item.nns_begin_time
group by 
video_id,video_name,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,item.nns_id,item.nns_name,nns_addr_code,nns_addr_city,user_id,play_sid,playbill_start_time,playbill_length,dt1.sp_id) dt
group by
dt.video_id,
dt.video_name,
dt.category_id,
dt.cn,
dt.asset_id,
dt.an,
dt.playbill_id,
dt.playbill_name,
dt.ncode,
dt.ncity,
dt.user_id,
dt.playbill_start_time,
dt.playbill_length,
dt.sp_id) dtt
group by 'live',video_id,video_name,category_id,category_name,asset_id,asset_name,playbill_id,playbill_name,nns_addr,nns_addr_name,playbill_start_time,playbill_length,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170309151103697]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_graphx_apk_client]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_graphx_apk_client]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_graphx_apk_client partition(day=${yesterday})
select 
wd.source,wd.target,wd.apk_version,wd.client_type,wd.depth as page_depth,count(1) as cnt_jump_into,wd.sp_id
from ( 
    select 
    tb1.sid,tb1.source,tb1.target,tb1.depth,tb1.sp_id
    ,tb2.apk_version,tb2.client_type
    from (
        select tb0.sid,tb0.source,tb0.target,tb0.sp_id
        ,row_number() over(partition by tb0.sid order by tb0.server_time) as depth 
        from (
            select session_id as sid,source_page_id_1 as source,target_page_id_1 as target,server_time,sp_id
            from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page' and source_page_id_1!=target_page_id_1
        ) as tb0
    ) as tb1 
    left join ${PLATFORM_ID}.session_log as tb2
    on tb1.sid=tb2.session_id and tb2.day=${yesterday}
    where tb1.depth<=11    
) as wd
group by source,target,apk_version,client_type,depth,wd.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170309111335457]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_quality_play_time_type_sp]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_quality_play_time_type_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type_sp partition(day=${yesterday})
select
video_type,
sp_id,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
sp_id,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,sp_id,video_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,sp_id,user_id,play_sid) dt
group by video_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170309110012093]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_quality_error_time_addr_apk_type_ecode_etype_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_quality_error_time_addr_apk_type_ecode_etype_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 55 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_error_time_addr_apk_type_ecode_etype_terminaltype partition(day=${yesterday})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
error_code,
error_type,
client_type,
sum(1),
sp_id
from (select user_id,apk_version,error_code,error_type,client_type,sp_id,region_code from ${PLATFORM_ID}.error_log where day=${yesterday}) dt1 left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,error_code,error_type,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170309103901947]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-user_time_sp_day]]></job_name> 
		<job_desc><![CDATA[v1.7.1-user_time_sp_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_sp_day partition(day=${today-30})
select
sp_id,
sum(user_1day_retain) cnt_user_1day_retain,
sum(user_3day_retain) cnt_user_3day_retain,
sum(user_7day_retain) cnt_user_7day_retain,
sum(user_30day_retain) cnt_user_30day_retain
from
(select nns_id from ${PLATFORM_ID}.nns_user where day=${yesterday} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${today-30}') dt1
left join 
(select sp_id,user_id,1 user_1day_retain,0 user_3day_retain,0 user_7day_retain,0 user_30day_retain from ${PLATFORM_ID}.usercomb1_day where day=${today-29} group by sp_id,user_id
union all
select sp_id,user_id,0 user_1day_retain,1 user_3day_retain,0 user_7day_retain,0 user_30day_retain from ${PLATFORM_ID}.usercomb1_day where day=${today-28} group by sp_id,user_id
union all
select sp_id,user_id,0 user_1day_retain,0 user_3day_retain,1 user_7day_retain,0 user_30day_retain from ${PLATFORM_ID}.usercomb1_day where day=${today-24} group by sp_id,user_id
union all
select sp_id,user_id,0 user_1day_retain,0 user_3day_retain,0 user_7day_retain,1 user_30day_retain from ${PLATFORM_ID}.usercomb1_day where day=${yesterday} group by sp_id,user_id) dt
on dt.user_id = dt1.nns_id
where dt.user_id is not null
group by sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/user_time_day.sh ${run_id}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170223170055328]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_lat_type_relation]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_lat_type_relation]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.ad_lat_type_relation 
select 
'ad_content_type' lat,
if(ad_content_type is null or ad_content_type ='' ,'', ad_content_type)  lat_type
from ${PLATFORM_ID}.ad_info where day = ${yesterday}  group by ad_content_type 
union all 
select 
'ad_delivery_type' lat,
if(ad_delivery_type is null or ad_delivery_type ='' ,'', ad_delivery_type) lat_type 
from ${PLATFORM_ID}.ad_info where day = ${yesterday}  group by ad_delivery_type 
union all 
select 
'ad_advertisers_name' lat,
if(ad_advertisers_name  is null or ad_advertisers_name ='' ,'', ad_advertisers_name) lat_type 
from ${PLATFORM_ID}.ad_info where day = ${yesterday}  group by ad_advertisers_name 
union all 
select 
'ad_size' lat,
if(ad_size  is null or ad_size  ='' ,'', ad_size) lat_type 
from ${PLATFORM_ID}.ad_info where day = ${yesterday}  group by ad_size 
union all 
select 
'ad_delivery_terminal_type' lat,
if(ad_delivery_terminal_type is null or ad_delivery_terminal_type  ='' ,'', ad_delivery_terminal_type) lat_type 
from ${PLATFORM_ID}.ad_info where day = ${yesterday}  group by ad_delivery_terminal_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170222152106894]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_time_position_content_delivery_advertisers_size_terminal_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_time_position_content_delivery_advertisers_size_terminal_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_time_position_content_delivery_advertisers_size_terminal_view partition(day=${yesterday}) 
select dt.position_id,dt3.ad_position_name,dt.content_id,dt3.ad_content_name,
if(dt3.ad_content_type is null or dt3.ad_content_type='','',dt3.ad_content_type),if(dt3.ad_delivery_type is null or dt3.ad_delivery_type='','',dt3.ad_delivery_type),if(dt3.ad_advertisers_name is null or dt3.ad_advertisers_name='','',dt3.ad_advertisers_name),if(dt3.ad_size is null or dt3.ad_size='','',dt3.ad_size),if(dt3.ad_delivery_terminal_type is null or dt3.ad_delivery_terminal_type='','',dt3.ad_delivery_terminal_type),
dt3.ad_create_time,show,if(click is null,0,click),if(click is null,0,click)/show,show_user,
if(click_user is null,0,click_user),if(click_user is null,0,click_user)/show_user from 
(select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,count(case when event_name='show_ad' then 1 else null end) show,
count(case when event_name='click_ad' then 1 else null end) click from ${PLATFORM_ID}.user_log where day= ${yesterday} and 
(event_name='click_ad' or event_name='show_ad') group by event_value['ad_content_id'],event_value['ad_position_id'])dt left join
(select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,count(distinct case when event_name='show_ad' then user_id else null end) show_user,
count(distinct case when event_name='click_ad' then user_id else null end) click_user from
(select event_name,event_value,session_id from ${PLATFORM_ID}.user_log where day=${yesterday} and 
(event_name='click_ad' or event_name='show_ad'))dt1 left join 
(select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday})dt2 on dt1.session_id = dt2.session_id 
group by event_value['ad_content_id'],event_value['ad_position_id'])dt0 on 
dt.content_id = dt0.content_id and dt.position_id = dt0.position_id left join 
(select * from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt.position_id = dt3.ad_position_id and dt.content_id = dt3.ad_content_id where dt3.ad_content_name is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172013383]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-user_profile]]></job_name> 
		<job_desc><![CDATA[v1.7.1-user_profile]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_tag_tmp partition(day=${yesterday})
select
dt.user_id,
dt.video_id,
nns_view_type,
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
user_id,
video_id,
play_sid,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='paused',duration,0)) paused_time
from
(select user_id,video_id,play_sid,event_type,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='vod' and user_id is not null and video_id is not null) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by user_id,video_id,play_sid) dt
left join
(select nns_id,nns_view_type from ${PLATFORM_ID}.nns_vod where day=${yesterday}) d
on dt.video_id=d.nns_id
group by
dt.user_id,
dt.video_id,
nns_view_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170215163535051]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1-day_user_time_sp]]></job_name> 
		<job_desc><![CDATA[v1.6.1-day_user_time_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_sp partition(day=${yesterday})
select
sp_id,
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}
group by
sp_id
union all
select
sp_id,
null,
count(distinct uid)
from ${PLATFORM_ID}.valid where day=${yesterday} group by sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170213100828330]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_advertisers_name_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_advertisers_name_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 35 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_advertisers_name_user partition(day=${yesterday}) 
select dt.ad_advertisers_name,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt3.ad_advertisers_name,count(distinct user_id) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_advertisers_name is null or ad_advertisers_name = '','',ad_advertisers_name) ad_advertisers_name  from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_advertisers_name)dt left join 
(select dt3.ad_advertisers_name,count(distinct user_id) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_advertisers_name is null or ad_advertisers_name = '','',ad_advertisers_name) ad_advertisers_name from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_advertisers_name)dt0 on dt.ad_advertisers_name = dt0.ad_advertisers_name where dt.ad_advertisers_name is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170213100613956]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_delivery_terminal_type_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_delivery_terminal_type_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 28 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_delivery_terminal_type_user partition(day=${yesterday}) 
select dt.ad_delivery_terminal_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt3.ad_delivery_terminal_type,count(distinct user_id) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_delivery_terminal_type is null or ad_delivery_terminal_type = '','',ad_delivery_terminal_type) ad_delivery_terminal_type  from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_delivery_terminal_type)dt left join 
(select dt3.ad_delivery_terminal_type,count(distinct user_id) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_delivery_terminal_type is null or ad_delivery_terminal_type = '','',ad_delivery_terminal_type) ad_delivery_terminal_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_delivery_terminal_type)dt0 on dt.ad_delivery_terminal_type = dt0.ad_delivery_terminal_type where dt.ad_delivery_terminal_type is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170213095941204]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_size_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_size_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_size_user partition(day=${yesterday}) 
select dt.ad_size,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt3.ad_size,count(distinct user_id) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_size is null or ad_size = '','',ad_size) ad_size  from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_size)dt left join 
(select dt3.ad_size,count(distinct user_id) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_size is null or ad_size = '','',ad_size) ad_size from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_size)dt0 on dt.ad_size = dt0.ad_size where dt.ad_size is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209162907627]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_delivery_type_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_delivery_type_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 24 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_delivery_type_user partition(day=${yesterday}) 
select dt.ad_delivery_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt3.ad_delivery_type,count(distinct user_id) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_delivery_type is null or ad_delivery_type = '','',ad_delivery_type) ad_delivery_type  from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_delivery_type)dt left join 
(select dt3.ad_delivery_type,count(distinct user_id) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_delivery_type is null or ad_delivery_type = '','',ad_delivery_type) ad_delivery_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_delivery_type)dt0 on dt.ad_delivery_type = dt0.ad_delivery_type where dt.ad_delivery_type is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209162035358]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_content_type_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_content_type_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_content_type_user partition(day=${yesterday}) 
select dt.ad_content_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt3.ad_content_type,count(distinct user_id) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_content_type is null or ad_content_type = '','',ad_content_type) ad_content_type  from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_content_type)dt left join 
(select dt3.ad_content_type,count(distinct user_id) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id,session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id left join 
(select ad_position_id,ad_content_id,if(ad_content_type is null or ad_content_type = '','',ad_content_type) ad_content_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt3 on dt1.position_id = dt3.ad_position_id and dt1.content_id = dt3.ad_content_id group by dt3.ad_content_type)dt0 on dt.ad_content_type = dt0.ad_content_type where dt.ad_content_type is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209153001642]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_time_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_time_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 46 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_time_user partition(day=${yesterday}) 
select dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select count(distinct user_id) show from (select session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id)dt left join 
(select count(distinct user_id) click from (select session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${yesterday})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${yesterday}) dt2 on dt1.session_id = dt2.session_id)dt0 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209150554453]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_advertisers_name_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_advertisers_name_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 34 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_advertisers_name_view partition(day=${yesterday})
select dt.ad_advertisers_name,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt2.ad_advertisers_name,count(1) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_advertisers_name is null or ad_advertisers_name = '','',ad_advertisers_name) ad_advertisers_name from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_advertisers_name)dt left join 
(select dt2.ad_advertisers_name,count(1) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_advertisers_name is null or ad_advertisers_name = '','',ad_advertisers_name) ad_advertisers_name from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_advertisers_name)dt0 on dt.ad_advertisers_name = dt0.ad_advertisers_name 
where dt.ad_advertisers_name is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209145812760]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_delivery_terminal_type_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_delivery_terminal_type_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_delivery_terminal_type_view partition(day=${yesterday}) 
select dt.ad_delivery_terminal_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt2.ad_delivery_terminal_type,count(1) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_delivery_terminal_type is null or ad_delivery_terminal_type = '','',ad_delivery_terminal_type) ad_delivery_terminal_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_delivery_terminal_type)dt left join 
(select dt2.ad_delivery_terminal_type,count(1) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_delivery_terminal_type is null or ad_delivery_terminal_type = '','',ad_delivery_terminal_type) ad_delivery_terminal_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_delivery_terminal_type)dt0 on dt.ad_delivery_terminal_type = dt0.ad_delivery_terminal_type 
where dt.ad_delivery_terminal_type is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209145530633]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_size_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_size_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 38 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_size_view partition(day=${yesterday}) 
select dt.ad_size,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt2.ad_size,count(1) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_size is null or ad_size = '','',ad_size) ad_size from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_size)dt left join 
(select dt2.ad_size,count(1) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_size is null or ad_size = '','',ad_size) ad_size from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_size)dt0 on dt.ad_size = dt0.ad_size 
where dt.ad_size is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209145227347]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-.day_ad_delivery_type_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-.day_ad_delivery_type_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 36 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_delivery_type_view partition(day=${yesterday}) 
select dt.ad_delivery_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt2.ad_delivery_type,count(1) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_delivery_type is null or ad_delivery_type = '','',ad_delivery_type) ad_delivery_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_delivery_type)dt left join 
(select dt2.ad_delivery_type,count(1) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_delivery_type is null or ad_delivery_type = '','',ad_delivery_type) ad_delivery_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_delivery_type)dt0 on dt.ad_delivery_type = dt0.ad_delivery_type 
where dt.ad_delivery_type is not null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209144947161]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_content_type_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_content_type_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 34 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_content_type_view partition(day=${yesterday}) 
select dt.ad_content_type,dt.show,case when dt0.click is null then 0 else dt0.click end,if(dt0.click is null,0,dt0.click)/dt.show from 
(select dt2.ad_content_type,count(1) show from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_content_type is null or ad_content_type = '','',ad_content_type) ad_content_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_content_type)dt left join 
(select dt2.ad_content_type,count(1) click from (select event_value['ad_content_id'] content_id,event_value['ad_position_id'] position_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt1 left join 
(select ad_position_id,ad_content_id,if(ad_content_type is null or ad_content_type = '','',ad_content_type) ad_content_type from ${PLATFORM_ID}.ad_info where day = ${yesterday})dt2 on dt1.position_id = dt2.ad_position_id 
and dt1.content_id = dt2.ad_content_id group by dt2.ad_content_type)dt0 on dt.ad_content_type = dt0.ad_content_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170209144431289]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_ad_time_view]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_ad_time_view]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_ad_time_view partition(day=${yesterday}) 
select show,case when click is null then 0 else click end ,if(click is null,0,click)/show from (select count(1) show from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${yesterday})dt1 left join 
(select count(1) click from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${yesterday})dt2 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112154325695]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.5.1-day_profile_product]]></job_name> 
		<job_desc><![CDATA[v1.5.1-day_profile_product]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_profile_product partition(day=${yesterday})
select
dt1.nns_user_id,
dt2.nns_name,
dt1.nns_product_id,
dt3.nns_product_name,
sum(case when nns_order_state=1 then nns_order_price end),
sum(case when nns_order_state=1 then 1 end)
from ${PLATFORM_ID}.nns_buy_order dt1 left join 
(select nns_id,nns_name from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.nns_user_id=dt2.nns_id left join
(select nns_product_id,nns_product_name from ${PLATFORM_ID}.nns_product where day=${yesterday}) dt3 on dt1.nns_product_id=dt3.nns_product_id
where dt1.day=${yesterday} and dt1.nns_order_state in (1,5) and from_unixtime(cast(dt1.nns_create_time/1000 as bigint),'yyyyMMdd')='${yesterday}'
group by
dt1.nns_user_id,
dt2.nns_name,
dt1.nns_product_id,
dt3.nns_product_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112115234625]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_month_sales_time_user_rebuy]]></job_name> 
		<job_desc><![CDATA[v1.6.1_month_sales_time_user_rebuy]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.month_sales_time_user_rebuy 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
rebuy_order_user,${yesterday} day,dt3.nns_boss_area_bind,dt1.sp_id from (select nns_user_id user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
nns_order_state = 1 and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${last_month}')dt1 left join (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${last_month}')dt2 on dt1.user_id = dt2.user_id left join (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)dt3 on dt1.user_id=dt3.nns_id group by nns_boss_area_bind,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112115135931]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_week_sales_time_user_rebuy]]></job_name> 
		<job_desc><![CDATA[v1.6.1_week_sales_time_user_rebuy]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.week_sales_time_user_rebuy 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
rebuy_order_user,${today-7} day,dt3.nns_boss_area_bind,dt1.sp_id from (select nns_user_id user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and  from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-7}')dt1 left join 
(select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${today-7}')dt2 on dt1.user_id = dt2.user_id left join (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)dt3 on dt1.user_id=dt3.nns_id group by nns_boss_area_bind,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112115008839]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_month_sales_time_user_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_month_sales_time_user_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with dt1 as (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${last_month}') 
insert into table ${PLATFORM_ID}.month_sales_time_user_order  
select dt4.active_order_user,dt4.active_user,dt5.register_order_user,dt5.register_user,${last_month} day from 
(select count(distinct dt2.user_id) active_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) active_order_user from 
(select uid user_id from ${PLATFORM_ID}.valid where day <= ${yesterday} and day >= ${last_month})dt2 left join dt1 on dt1.user_id = dt2.user_id)dt4 left join 
(select count(distinct dt3.nns_id) register_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) register_order_user from 
(select nns_id from ${PLATFORM_ID}.nns_user where day = ${yesterday} and nns_state = 0 and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${last_month}')dt3 left join dt1 on dt1.user_id = dt3.nns_id)dt5 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112114912138]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_week_sales_time_user_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_week_sales_time_user_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 3 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with dt1 as (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-7}') 
insert into table ${PLATFORM_ID}.week_sales_time_user_order  
select dt4.active_order_user,dt4.active_user,dt5.register_order_user,dt5.register_user,${today-7} day from 
(select count(distinct dt2.user_id) active_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) active_order_user from 
(select uid user_id from ${PLATFORM_ID}.valid where day <= ${yesterday} and day >= ${today-7})dt2 left join dt1 on dt1.user_id = dt2.user_id)dt4 left join 
(select count(distinct dt3.nns_id) register_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) register_order_user from 
(select nns_id from ${PLATFORM_ID}.nns_user where day = ${yesterday} and nns_state = 0 and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${today-7}')dt3 left join dt1 on dt1.user_id = dt3.nns_id)dt5 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112114808532]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_month_sales_time_pay_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_month_sales_time_pay_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.month_sales_time_pay_order 
select count(1) pay_order,if(sum(nns_order_price) is null,0,sum(nns_order_price)) pay_money,count(distinct nns_user_id) pay_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_pay_user,${last_month} day from 
(select nns_user_id,nns_order_price from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${last_month}')dt1 left join 
(select distinct(nns_user_id) user_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 
and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${last_month}')dt2 on dt1.nns_user_id = dt2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112114650272]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_week_sales_time_pay_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_week_sales_time_pay_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.week_sales_time_pay_order 
select count(1) pay_order,if(sum(nns_order_price) is null,0,sum(nns_order_price)) pay_money,count(distinct nns_user_id) pay_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_pay_user,${today-7} day from 
(select nns_user_id,nns_order_price from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-7}')dt1 left join 
(select distinct(nns_user_id) user_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 
and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${today-7}')dt2 on dt1.nns_user_id = dt2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112114548079]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_month_sales_time_place_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_month_sales_time_place_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.month_sales_time_place_order 
select dt.total_order,dt.order_money,dt.order_user,dt.new_order_user,dt3.online_user,${yesterday} day,coalesce(dt.nns_boss_area_bind,dt3.nns_boss_area_bind) nns_boss_area_bind,dt.sp_id from 
(select count(1) total_order,if(sum(dt1.nns_order_price) is null,0,sum(dt1.nns_order_price))  order_money,count(distinct dt1.nns_user_id) order_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_order_user,nns_boss_area_bind,dt1.sp_id from 
(select nns_user_id,nns_order_price,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${last_month}')dt1 left join (select distinct(nns_user_id) user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} 
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') < '${last_month}')dt2 on dt1.nns_user_id = dt2.user_id and dt1.sp_id=dt2.sp_id left join user on dt1.nns_user_id=user.nns_id group by nns_boss_area_bind,dt1.sp_id)dt full outer join 
(select count(1) online_user,nns_boss_area_bind,b.sp_id from (select user_id,sp_id from ${PLATFORM_ID}.heartbeat_log where day <= ${yesterday} and day >= ${last_month} group by user_id,sp_id)b left join user on nns_id=user_id group by nns_boss_area_bind,sp_id)dt3 on dt.nns_boss_area_bind=dt3.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112113725349]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_week_sales_time_place_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_week_sales_time_place_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.week_sales_time_place_order 
select dt.total_order,dt.order_money,dt.order_user,dt.new_order_user,dt3.online_user,${yesterday} day,coalesce(dt.nns_boss_area_bind,dt3.nns_boss_area_bind) nns_boss_area_bind,dt.sp_id from 
(select count(1) total_order,if(sum(dt1.nns_order_price) is null,0,sum(dt1.nns_order_price))  order_money,count(distinct dt1.nns_user_id) order_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_order_user,nns_boss_area_bind,dt1.sp_id from 
(select nns_user_id,nns_order_price,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${today-7}')dt1 left join (select distinct(nns_user_id) user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} 
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') < '${today-7}')dt2 on dt1.nns_user_id = dt2.user_id and dt1.sp_id=dt2.sp_id left join user on dt1.nns_user_id=user.nns_id group by nns_boss_area_bind,dt1.sp_id)dt full outer join 
(select count(1) online_user,nns_boss_area_bind,b.sp_id from (select user_id,sp_id from ${PLATFORM_ID}.heartbeat_log where day <= ${yesterday} and day >= ${today-7} group by user_id,sp_id)b left join user on nns_id=user_id group by nns_boss_area_bind,sp_id)dt3 on dt.nns_boss_area_bind=dt3.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112113531406]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_month_sales_time_fail]]></job_name> 
		<job_desc><![CDATA[v1.6.1_month_sales_time_fail]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.month_sales_time_fail 
select dt1.total_order,dt2.fail_order,${yesterday} day,coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind,dt1.sp_id from 
(select nns_boss_area_bind,sum(total_order) total_order,sp_id from (select nns_user_id,count(1) total_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' 
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${last_month}' 
or ((nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${last_month}') group by nns_user_id,sp_id)a left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt1 full outer join 
(select nns_boss_area_bind,sum(fail_order) fail_order,sp_id from (select nns_user_id,count(1) fail_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and 
(nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${last_month}' group by nns_user_id,sp_id)b left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt2 on dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170112110624796]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_week_sales_time_fail]]></job_name> 
		<job_desc><![CDATA[v1.6.1_week_sales_time_fail]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.week_sales_time_fail 
select dt1.total_order,dt2.fail_order,${yesterday} day,coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind,dt1.sp_id from 
(select nns_boss_area_bind,sum(total_order) total_order,sp_id from (select nns_user_id,count(1) total_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' 
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')>='${today-7}' 
or ((nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-7}') group by nns_user_id,sp_id)a left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt1 full outer join 
(select nns_boss_area_bind,sum(fail_order) fail_order,sp_id from (select nns_user_id,count(1) fail_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and (nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')<='${yesterday}' and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')>='${today-7}' group by nns_user_id,sp_id)b left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt2 on dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111183252142]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_day_sales_time_user_rebuy]]></job_name> 
		<job_desc><![CDATA[v1.6.1_day_sales_time_user_rebuy]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 35 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.day_sales_time_user_rebuy 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
rebuy_order_user,${yesterday} day,dt3.nns_boss_area_bind,dt1.sp_id from (select nns_user_id user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}')dt1 left join 
(select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${yesterday}')dt2 on dt1.user_id = dt2.user_id left join (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from ${PLATFORM_ID}.nns_user where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)dt3 on dt1.user_id=dt3.nns_id group by nns_boss_area_bind,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111175236886]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.1_day_sales_time_user_retain]]></job_name> 
		<job_desc><![CDATA[v2.2.1_day_sales_time_user_retain]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with dt2 as (select uid user_id from ${PLATFORM_ID}.valid where day = ${yesterday}) 
insert into table ${PLATFORM_ID}.day_sales_time_user_retain 
select count(distinct nns_user_id) order_user,null retain_order_user,'1day' retaim_type,${yesterday} day from ${PLATFORM_ID}.nns_buy_order where day=${yesterday} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}'
union all
select null order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end)
 retain_order_user,'1day' retaim_type,${today-2} day from (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${today-2} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${today-2}')dt1 left join 
 dt2 on dt1.user_id = dt2.user_id 
union all 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
retain_order_user,'3day' retaim_type,${today-4} day from (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${today-4} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${today-4}')dt1 left join 
 dt2 on dt1.user_id = dt2.user_id 
union all 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
retain_order_user,'7day' retaim_type,${today-8} day from (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${today-8} and nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${today-8}')dt1 left join 
 dt2 on dt1.user_id = dt2.user_id 
union all 
select count(distinct dt1.user_id) order_user,count(distinct case when dt2.user_id is not null then dt2.user_id end) 
retain_order_user,'30day' retaim_type,${today-31} day from (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where day=${today-31} 
and nns_order_state = 1 and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${today-31}')dt1 left join 
 dt2 on dt1.user_id = dt2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111165508156]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_day_sales_time_user_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_day_sales_time_user_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with dt1 as (select nns_user_id user_id from ${PLATFORM_ID}.nns_buy_order where nns_order_state = 1 and day = ${yesterday} and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}') 
insert into table ${PLATFORM_ID}.day_sales_time_user_order  
select dt4.active_order_user,dt4.active_user,dt5.register_order_user,dt5.register_user,${yesterday} day from 
(select count(distinct dt2.user_id) active_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) active_order_user from 
(select uid user_id from ${PLATFORM_ID}.valid where day = ${yesterday})dt2 left join dt1 on dt1.user_id = dt2.user_id)dt4 left join 
(select count(distinct dt3.nns_id) register_user,count(distinct case when dt1.user_id is not null then dt1.user_id end) register_order_user from 
(select nns_id from ${PLATFORM_ID}.nns_user where nns_state = 0 and day = ${yesterday} and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${yesterday}')dt3 left join dt1 on dt1.user_id = dt3.nns_id)dt5 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111165320162]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_day_sales_time_pay_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_day_sales_time_pay_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 35 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into table ${PLATFORM_ID}.day_sales_time_pay_order 
select count(1) pay_order,if(sum(nns_order_price) is null,0,sum(nns_order_price)) pay_money,count(distinct nns_user_id) pay_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_pay_user,${yesterday} day from
(select nns_user_id,nns_order_price from ${PLATFORM_ID}.nns_buy_order where nns_order_state = 1 and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}' and day = ${yesterday})dt1 left join 
(select distinct(nns_user_id) user_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 
and from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd') < '${yesterday}')dt2 on dt1.nns_user_id = dt2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111164749741]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_day_sales_time_place_order]]></job_name> 
		<job_desc><![CDATA[v1.6.1_day_sales_time_place_order]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.day_sales_time_place_order 
select dt.total_order,dt.order_money,dt.order_user,dt.new_order_user,dt3.online_user,${yesterday} day,coalesce(dt.nns_boss_area_bind,dt3.nns_boss_area_bind) nns_boss_area_bind,dt.sp_id from 
(select count(1) total_order,if(sum(dt1.nns_order_price) is null,0,sum(dt1.nns_order_price))  order_money,count(distinct dt1.nns_user_id) order_user,
count(distinct case when dt2.user_id is null then dt1.nns_user_id end) new_order_user,nns_boss_area_bind,dt1.sp_id from 
(select nns_user_id,nns_order_price,sp_id from ${PLATFORM_ID}.nns_buy_order where from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')=
'${yesterday}' and day = ${yesterday})dt1 left join (select distinct(nns_user_id) user_id,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} 
and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd') < '${yesterday}')dt2 on dt1.nns_user_id = dt2.user_id and dt1.sp_id=dt2.sp_id left join user on dt1.nns_user_id=user.nns_id group by nns_boss_area_bind,dt1.sp_id)dt full outer join 
(select count(1) online_user,nns_boss_area_bind,b.sp_id from (select user_id,sp_id from ${PLATFORM_ID}.heartbeat_log where day = ${yesterday} group by user_id,sp_id)b left join user on nns_id=user_id group by nns_boss_area_bind,sp_id)dt3 on dt.nns_boss_area_bind=dt3.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170111164509143]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.6.1_day_sales_time_fail]]></job_name> 
		<job_desc><![CDATA[v1.6.1_day_sales_time_fail]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 25 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with user as (select nns_id,nns_nns_boss_area_bind nns_boss_area_bind from  ${PLATFORM_ID}.nns_user  where day=${yesterday} group by nns_id,nns_nns_boss_area_bind)
insert into table ${PLATFORM_ID}.day_sales_time_fail 
select dt1.total_order,dt2.fail_order,${yesterday} day,coalesce(dt1.nns_boss_area_bind,dt2.nns_boss_area_bind) nns_boss_area_bind,dt1.sp_id from 
(select nns_boss_area_bind,sum(total_order) total_order,sp_id from (select nns_user_id,count(1) total_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and 
from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${yesterday}' 
or ((nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}') group by nns_user_id,sp_id)a left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt1 full outer join 
(select nns_boss_area_bind,sum(fail_order) fail_order,sp_id from (select nns_user_id,count(1) fail_order,sp_id from ${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and (nns_order_state = 2 or nns_order_state = 3) and 
from_unixtime(cast(nns_modify_time/1000 as bigint),'yyyyMMdd')='${yesterday}' group by nns_user_id,sp_id)b left join user on nns_user_id=nns_id group by nns_boss_area_bind,sp_id)dt2 on dt1.nns_boss_area_bind=dt2.nns_boss_area_bind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161228143415839]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.0-day_update_user_huaxiang]]></job_name> 
		<job_desc><![CDATA[v2.2.0-day_update_user_huaxiang]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[bash /cluster/jobs/sdk_es-*/run.sh ${today} eshost=${ESHOST} presto=${PRESTOHOST} db=${DB}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[1]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161226154421237]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.5.1-day_profile_kind]]></job_name> 
		<job_desc><![CDATA[v1.5.1-day_profile_kind]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with
kind as
(
select nns_product_id,nns_kind from(
select nns_product_id,nns_video_id from(
select nns_product_id,nns_video_id from ${PLATFORM_ID}.nns_product_video where day=${yesterday}
union all
select nns_product_id,nns_video_id from
(select nns_product_id,nns_content_id,nns_category_id from ${PLATFORM_ID}.nns_product_content where day=${yesterday}) dtt1
join
(select nns_video_id,nns_assist_id,nns_category_id from ${PLATFORM_ID}.nns_assists_item where day=${yesterday}) dtt2
on dtt1.nns_content_id=dtt2.nns_assist_id and dtt1.nns_category_id=dtt2.nns_category_id
) dt1
group by nns_product_id,nns_video_id) d1
left join
(select nns_id,nns_kind from ${PLATFORM_ID}.nns_vod where day=${yesterday}) d2
on d1.nns_video_id=d2.nns_id
group by nns_product_id,nns_kind
)
insert overwrite table ${PLATFORM_ID}.day_profile_kind partition(day=${yesterday})
select
dt1.nns_user_id,
dt2.nns_name,
nns_kind,
sum(case when nns_order_state=1 then nns_order_price end),
sum(case when nns_order_state=1 then 1 end)
from ${PLATFORM_ID}.nns_buy_order dt1 left join 
(select nns_id,nns_name from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.nns_user_id=dt2.nns_id left join
kind on dt1.nns_product_id=kind.nns_product_id
where dt1.day=${yesterday} and dt1.nns_order_state in (1,5) and from_unixtime(cast(dt1.nns_create_time/1000 as bigint),'yyyyMMdd')='${yesterday}'
group by
dt1.nns_user_id,
dt2.nns_name,
nns_kind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161222101847303]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.5.1-day_profile_video]]></job_name> 
		<job_desc><![CDATA[v1.5.1-day_profile_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_profile_video partition(day=${yesterday})
select
dt.user_id,
dt.nns_name,
dt.video_type,
dt.video_id,
dt.video_name,
dt.nns_kind,
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
video_id,
video_name,
video_type,
play_sid,
user_id,
dt2.nns_name,
dt3.nns_kind,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='paused',duration,0)) paused_time
from (select video_id,video_name,video_type,user_id,event_type,play_sid,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select nns_id,nns_name from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
left join (select nns_id,nns_kind from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt3 on dt1.video_id=dt3.nns_id
group by video_id,video_name,video_type,play_sid,user_id,dt2.nns_name,dt3.nns_kind) dt
group by
dt.user_id,
dt.nns_name,
dt.video_type,
dt.video_id,
dt.video_name,
dt.nns_kind
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110164640149]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-week_content_time_asset]]></job_name> 
		<job_desc><![CDATA[v1.4.1-week_content_time_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_asset partition(day=${today-7})
select
video_type,
asset_id,
nns_name asset_name,
count(distinct user_id),
null,
null,
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,asset_id,category_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
left join ${PLATFORM_ID}.nns_assists_category dt3 on dt2.category_id=dt3.nns_category_id and dt2.asset_id=dt3.nns_id
where dt1.day=${today-7} and dt3.day=${yesterday}
group by video_type,asset_id,nns_name
union all
select
video_type,
asset_id,
asset_name,
null,
sum(cnt_play_times),
sum(cnt_play_length),
sum(cnt_page_view),
null
from ${PLATFORM_ID}.day_content_time_asset where day>=${today-7} and day<${today}
group by
video_type,
asset_id,
asset_name
union all
select
"vod" video_type,
event_value['asset_id'] asset_id,
dt4.nns_name asset_name,
null,
null,
null,
null,
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day>=${today-7} and day<${today} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day>=${today-7} and day<${today} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by
event_value['asset_id'],
dt4.nns_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110164341203]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-day_content_time_asset]]></job_name> 
		<job_desc><![CDATA[v1.4.1-day_content_time_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_asset partition(day=${yesterday})
select
'vod',
dt.asset_id,
dt.an,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
null
from
(select
asset_id,
dt3.nns_name an,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select category_id,asset_id,user_id,event_type,play_sid,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='vod') dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by asset_id,dt3.nns_name,play_sid,user_id) dt
group by
dt.asset_id,
dt.an
union all
select
"vod",
event_value['asset_id'] asset_id,
dt4.nns_name an,
null,
null,
null,
sum(1),
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by
event_value['asset_id'],
dt4.nns_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110163712253]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-week_content_time_category]]></job_name> 
		<job_desc><![CDATA[v1.4.1-week_content_time_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_category partition(day=${today-7})
select
video_type,
category_id,
nns_category_name category_name,
count(distinct user_id),
null,
null,
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,category_id,asset_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
left join ${PLATFORM_ID}.nns_assists_category dt3 on dt2.category_id=dt3.nns_category_id and dt2.asset_id=dt3.nns_id
where dt1.day=${today-7} and dt3.day=${yesterday}
group by video_type,category_id,nns_category_name
union all
select
video_type,
category_id,
category_name,
null,
sum(cnt_play_times),
sum(cnt_play_length),
sum(cnt_page_view),
null
from ${PLATFORM_ID}.day_content_time_category where day>=${today-7} and day<${today}
group by
video_type,
category_id,
category_name
union all
select
"vod" video_type,
event_value['category_id'] category_id,
dt4.nns_category_name category_name,
null,
null,
null,
null,
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day>=${today-7} and day<${today} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day>=${today-7} and day<${today} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by
event_value['category_id'],
dt4.nns_category_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110163223624]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-day_content_time_category]]></job_name> 
		<job_desc><![CDATA[v1.4.1-day_content_time_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_category partition(day=${yesterday})
select
'vod',
dt.category_id,
dt.cn,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
null
from
(select
category_id,
play_sid,
user_id,
dt3.nns_category_name cn,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select category_id,asset_id,user_id,event_type,play_sid,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type='vod') dt1
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,dt3.nns_category_name,play_sid,user_id) dt
group by
dt.category_id,
dt.cn
union all
select
'vod',
event_value['category_id'] category_id,
dt4.nns_category_name cn,
null,
null,
null,
sum(1),
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt4
on event_value['category_id']=dt4.nns_category_id and event_value['asset_id']=dt4.nns_id
group by
event_value['category_id'],
dt4.nns_category_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110162754258]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-month_content_time_video]]></job_name> 
		<job_desc><![CDATA[v1.4.1-month_content_time_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_content_time_video partition(day=${last_month})
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
count(distinct user_id),
null,
null,
null,
null,
sp_id 
from
${PLATFORM_ID}.contentcomb1_day
where day>=${last_month} and day<${today}
group by video_id,video_name,category_id,category_name,asset_id,asset_name,video_type,sp_id 
union all
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length),
sum(cnt_page_view),
null,
sp_id 
from ${PLATFORM_ID}.day_content_time_video where day>=${last_month} and day<${today}
group by
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
sp_id 
union all
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
null,
null,
null,
null,
count(distinct user_id),
sp_id 
from
${PLATFORM_ID}.viewcomb1_day
where day>=${last_month} and day<${today}
group by
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110162344884]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-week_content_time_video]]></job_name> 
		<job_desc><![CDATA[v1.4.1-week_content_time_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_video partition(day=${today-7})
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
count(distinct user_id),
null,
null,
null,
null,
sp_id 
from
${PLATFORM_ID}.contentcomb1_day
where day>=${today-7} and day<${today}
group by video_id,video_name,category_id,category_name,asset_id,asset_name,video_type,sp_id 
union all
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length),
sum(cnt_page_view),
null,
sp_id 
from ${PLATFORM_ID}.day_content_time_video where day>=${today-7} and day<${today}
group by
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
sp_id 
union all
select
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
null,
null,
null,
null,
count(distinct user_id),
sp_id 
from
${PLATFORM_ID}.viewcomb1_day
where day>=${today-7} and day<${today}
group by
video_id,
video_name,
category_id,
category_name,
asset_id,
asset_name,
video_type,
sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161110160526038]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.4.1-week_content_time]]></job_name> 
		<job_desc><![CDATA[v1.4.1-week_content_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time partition(day=${today-7})
select
video_type,
count(distinct user_id),
null,
null,
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
where dt1.day=${today-7}
group by video_type
union all
select
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length),
sum(cnt_page_view),
null
from ${PLATFORM_ID}.day_content_time where day>=${today-7} and day<${today}
group by video_type
union all
select
"vod" video_type,
null,
null,
null,
null,
count(distinct user_id)
from
(select session_id,event_value from ${PLATFORM_ID}.user_log where day>=${today-7} and day<${today} and event_name='open_page') dt1 
join
(select session_id,user_id from ${PLATFORM_ID}.session_log where day>=${today-7} and day<${today} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161107101114257]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_view_depth_addr_apk_user]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_view_depth_addr_apk_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with dt as(select session_id,source_page_id_1,target_page_id_1,event_value from ${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') 
insert overwrite table ${PLATFORM_ID}.day_view_depth_addr_apk_user partition(day=${yesterday})
select if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,nns_addr_city,apk_version,num,count(1),sum(if(play_num>0,1,0)),sp_id from (select session_id ,count(1) num,sum(if(target_page_id_1 regexp '(?=.*player)^.*$' or target_page_id_1='page_VideoPlay',1,0)) play_num 
from dt group by session_id)dt1 left join (select session_id,user_id,apk_version,sp_id,region_code from ${PLATFORM_ID}.session_log where day=${yesterday} 
group by session_id,user_id,apk_version,sp_id,region_code) dt2 on dt1.session_id=dt2.session_id left join 
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,apk_version,num,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161018120054812]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v2.2.0-createGx]]></job_name> 
		<job_desc><![CDATA[v2.2.0-createGx]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		
		]]></sql_statement> 
		<shell_script><![CDATA[python /cluster/jobs/createGX-*/bin/runJob.py ${yesterday} ${NEO4J}  jdbc:presto://${PRESTOHOST}/hive/${DB}    apk_version,client_type,sp_id]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[0]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161014183731593]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.3.1-week_view_time]]></job_name> 
		<job_desc><![CDATA[v1.3.1-week_view_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_view_time partition(day=${today-7})
select
null,
count(distinct user_id),
null,
null,
null,
null,
null,
null,
null,
null,
null
from ${PLATFORM_ID}.session_log
where day>=${today-7} and day<${today}
union all
select
sum(cnt_page_view),
null,
sum(cnt_page_stay),
sum(cnt_page_ready_duration),
sum(cnt_page_ready),
sum(cnt_page_loaded_duration),
sum(cnt_page_loaded),
max(max_page_ready_duration_),
max(max_page_loaded_duration_),
min(min_page_ready_duration_),
min(min_page_loaded_duration_)
from
${PLATFORM_ID}.day_view_time
where day>=${today-7} and day<${today}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20161014181911538]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.3.1-week_view_time_addr_apk_type_page]]></job_name> 
		<job_desc><![CDATA[v1.3.1-week_view_time_addr_apk_type_page]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 2 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_view_time_addr_apk_type_page partition(day=${today-7})
select
addr_code,
addr_name,
apk_version,
page_type,
page_id,
sum(cnt_page_view),
sum(cnt_page_stay),
sum(cnt_page_ready_duration),
sum(cnt_page_ready),
sum(cnt_page_loaded_duration),
sum(cnt_page_loaded),
max(max_page_ready_duration_),
max(max_page_loaded_duration_),
min(min_page_ready_duration_),
min(min_page_loaded_duration_),
client_type
from
${PLATFORM_ID}.day_view_time_addr_apk_type_page
where day>=${today-7} and day<${today}
group by
addr_code,
addr_name,
apk_version,
page_type,
page_id,
client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907175204095]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_play_time_type_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_play_time_type_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_type_terminaltype partition(day=${today-7})
select
video_type,
client_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
client_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,client_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,client_type,user_id,play_sid) dt
group by video_type,client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907175105928]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_quality_play_time_type_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-day_quality_play_time_type_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type_terminaltype partition(day=${yesterday})
select
video_type,
client_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
client_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,client_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,client_type,user_id,play_sid) dt
group by video_type,client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907174733120]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_play_time_type_video]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_play_time_type_video]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_type_video partition(day=${today-7})
select
video_type,
video_id,
video_name,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
video_id,
video_name,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,video_id,video_name,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,video_id,video_name,user_id,play_sid) dt
group by video_type,video_id,video_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907174008964]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_play_time_type_apk]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_play_time_type_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_type_apk partition(day=${today-7})
select
video_type,
apk_version,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
apk_version,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,apk_version,video_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,apk_version,user_id,play_sid) dt
group by video_type,apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907173907901]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_quality_play_time_type_apk]]></job_name> 
		<job_desc><![CDATA[v1.2-day_quality_play_time_type_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type_apk partition(day=${yesterday})
select
video_type,
apk_version,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
apk_version,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,apk_version,video_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,apk_version,user_id,play_sid) dt
group by video_type,apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907173335044]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_play_time_type_addr]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_play_time_type_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_type_addr partition(day=${today-7})
select
video_type,
nns_addr_code,
nns_addr_city,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
video_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,event_type,server_time,play_sid,duration,region_code from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by video_type,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,user_id,play_sid) dt
group by video_type,nns_addr_code,nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907172755225]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_quality_play_time_type_addr]]></job_name> 
		<job_desc><![CDATA[v1.2-day_quality_play_time_type_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type_addr partition(day=${yesterday})
select
video_type,
nns_addr_code,
nns_addr_city,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
if(length(nns_addr_city)>6,nns_addr_city,region_code) nns_addr_code,
nns_addr_city,
video_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,event_type,server_time,play_sid,duration,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by video_type,if(length(nns_addr_city)>6,nns_addr_city,region_code),nns_addr_city,user_id,play_sid) dt
group by video_type,nns_addr_code,nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907171907314]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_play_time_type]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_play_time_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_play_time_type partition(day=${today-7})
select
video_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day>=${today-7} and day<=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,user_id,play_sid) dt
group by video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907164051375]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_quality_play_time_type]]></job_name> 
		<job_desc><![CDATA[v1.2-day_quality_play_time_type]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_play_time_type partition(day=${yesterday})
select
video_type,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(ready_time)/(60.0*1000),6)
from
(select
video_type,
user_id,
play_sid,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time
from (select user_id,video_type,event_type,server_time,play_sid,duration from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join
(select uid,pid from ${PLATFORM_ID}.valid where day=${yesterday}) valid on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,user_id,play_sid) dt
group by video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907143645456]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_startup_time_addr_apk_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_startup_time_addr_apk_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_startup_time_addr_apk_terminaltype partition(day=${today-7})
select
nns_addr_code,
nns_addr_city,
apk_version,
client_type,
sum(duration/1000),
sum(1)
from ${PLATFORM_ID}.startup_log dt1 left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
where dt1.day>=${today-7} and dt1.day<=${yesterday}
group by
nns_addr_code,
nns_addr_city,
apk_version,
client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907142914656]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_quality_startup_time_addr_apk_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-day_quality_startup_time_addr_apk_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_startup_time_addr_apk_terminaltype partition(day=${yesterday})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
client_type,
sum(duration/1000),
sum(1)
from ${PLATFORM_ID}.startup_log dt1 left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
where dt1.day=${yesterday}
group by
if(length(nns_addr_code)>6,nns_addr_code,region_code),
nns_addr_city,
apk_version,
client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160907112247563]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_quality_error_time_addr_apk_type_ecode_etype_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-week_quality_error_time_addr_apk_type_ecode_etype_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_quality_error_time_addr_apk_type_ecode_etype_terminaltype partition(day=${today-7})
select
user_addr,
user_addr_name,
apk_version,
error_code,
error_type,
terminaltype,
sum(cnt_error)
from ${PLATFORM_ID}.day_quality_error_time_addr_apk_type_ecode_etype_terminaltype
where day>=${today-7} and day<=${yesterday}
group by user_addr,user_addr_name,apk_version,error_code,error_type,terminaltype
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906145704921]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-user_time_day]]></job_name> 
		<job_desc><![CDATA[v1.2-user_time_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_day partition(day=${today-30})
select
sum(1),
null,
null,
null
from (select nns_id from ${PLATFORM_ID}.nns_user where day=${today-30} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${today-30}') dt1 join 
(select user_id from ${PLATFORM_ID}.heartbeat_log where day=${today-29} group by user_id) dt2 on dt1.nns_id=dt2.user_id
union all
select
null,
sum(1),
null,
null
from (select nns_id from ${PLATFORM_ID}.nns_user where day=${today-30} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${today-30}') dt1 join 
(select user_id from ${PLATFORM_ID}.heartbeat_log where day=${today-28} group by user_id) dt2 on dt1.nns_id=dt2.user_id
union all
select
null,
null,
sum(1),
null
from (select nns_id from ${PLATFORM_ID}.nns_user where day=${today-30} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${today-30}') dt1 join 
(select user_id from ${PLATFORM_ID}.heartbeat_log where day=${today-24} group by user_id) dt2 on dt1.nns_id=dt2.user_id
union all
select
null,
null,
null,
sum(1)
from (select nns_id from ${PLATFORM_ID}.nns_user where day=${today-30} and from_unixtime(cast(nns_create_time/1000 as bigint),'yyyyMMdd')='${today-30}') dt1 join 
(select user_id from ${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by user_id) dt2 on dt1.nns_id=dt2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/user_time_day.sh ${run_id}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906143833300]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_gender]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_gender]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_gender partition(day=${today-7})
select
nns_sex,
count(distinct user_id),
null
from (select user_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}) dt1 left join
(select nns_id,nns_sex from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by nns_sex
union all
select
nns_sex,
null,
sum(1)
from (select * from ${PLATFORM_ID}.week_valid where day=${today-7}) dt1 left join
(select nns_id,nns_sex from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.uid=dt2.nns_id
group by nns_sex
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906143719115]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_user_time_gender]]></job_name> 
		<job_desc><![CDATA[v1.2-day_user_time_gender]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_gender partition(day=${yesterday})
select
nns_sex,
count(distinct user_id),
null
from (select user_id from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1 left join
(select nns_id,nns_sex from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by nns_sex
union all
select
nns_sex,
null,
count(distinct uid)
from (select * from ${PLATFORM_ID}.valid where day=${yesterday}) dt1 left join
(select nns_id,nns_sex from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.uid=dt2.nns_id
group by nns_sex
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906141801840]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_terminaltype]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_terminaltype]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_terminaltype partition(day=${today-7})
select
client_type,
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}
group by client_type
union all
select
client_type,
null,
count(distinct uid)
from
(select * from ${PLATFORM_ID}.week_valid where day=${today-7}) dt1 join
(select user_id,client_type from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt2 on dt1.uid=dt2.user_id
group by client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906135214820]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_heartbeat]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_heartbeat]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_heartbeat partition(day=${today-7})
select
heartbeat_type,
count(distinct user_id)
from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}
group by heartbeat_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906135043989]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_user_time_heartbeat]]></job_name> 
		<job_desc><![CDATA[v1.2-day_user_time_heartbeat]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_heartbeat partition(day=${yesterday})
select
heartbeat_type,
count(distinct user_id)
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}
group by heartbeat_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906124738327]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_category]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_category partition(day=${today-7})
select
category_id,
dt3.nns_category_name,
count(distinct user_id),
null
from (select user_id,asset_id,category_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,dt3.nns_category_name
union all
select
category_id,
dt3.nns_category_name,
null,
count(distinct user_id)
from
(select uid from ${PLATFORM_ID}.week_valid where day=${today-7}) dt join
(select user_id,asset_id,category_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 on dt.uid=dt1.user_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,dt3.nns_category_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906124606794]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_user_time_category]]></job_name> 
		<job_desc><![CDATA[v1.2-day_user_time_category]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_category partition(day=${yesterday})
select
category_id,
dt3.nns_category_name,
count(distinct user_id),
null
from (select user_id,asset_id,category_id from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,dt3.nns_category_name
union all
select
category_id,
dt3.nns_category_name,
null,
count(distinct user_id)
from
(select uid from ${PLATFORM_ID}.valid where day=${yesterday}) dt join
(select user_id,asset_id,category_id from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 on dt.uid=dt1.user_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,dt3.nns_category_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906123727390]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_asset]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_asset partition(day=${today-7})
select
asset_id,
dt3.nns_name,
count(distinct user_id),
null
from (select user_id,asset_id,category_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by asset_id,dt3.nns_name
union all
select
asset_id,
dt3.nns_name,
null,
count(distinct user_id)
from
(select uid from ${PLATFORM_ID}.week_valid where day=${today-7}) dt join
(select user_id,asset_id,category_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt1 on dt.uid=dt1.user_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by asset_id,dt3.nns_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906123345132]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_user_time_asset]]></job_name> 
		<job_desc><![CDATA[v1.2-day_user_time_asset]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time_asset partition(day=${yesterday})
select
asset_id,
dt3.nns_name,
count(distinct user_id),
null
from (select user_id,asset_id,category_id from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}) dt1 left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by asset_id,dt3.nns_name
union all
select
asset_id,
dt3.nns_name,
null,
count(distinct user_id)
from
(select uid from ${PLATFORM_ID}.valid where day=${yesterday}) dt join
(select user_id,asset_id,category_id from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 on dt.uid=dt1.user_id left join
(select * from ${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by asset_id,dt3.nns_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906121332748]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_apk]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_apk partition(day=${today-7})
select
apk_version,
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}
group by apk_version
union all
select
apk_version,
null,
count(distinct uid)
from
(select * from ${PLATFORM_ID}.week_valid where day=${today-7}) dt1 join
(select user_id,apk_version from ${PLATFORM_ID}.play_log where day>=${today-7} and day<=${yesterday}) dt2 on dt1.uid=dt2.user_id
group by apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906112845397]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time_addr]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time_addr partition(day=${today-7})
select
nns_addr_code,
nns_addr_city,
count(distinct user_id),
null
from (select user_id from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}) dt1 left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by nns_addr_code,nns_addr_city
union all
select
nns_addr_code,
nns_addr_city,
null,
sum(1)
from (select * from ${PLATFORM_ID}.week_valid where day=${today-7}) dt1 left join
(select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.uid=dt2.nns_id
group by nns_addr_code,nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906111429676]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_user_time]]></job_name> 
		<job_desc><![CDATA[v1.2-week_user_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_user_time partition(day=${today-7})
select
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<=${yesterday}
union all
select
null,
sum(1)
from ${PLATFORM_ID}.week_valid where day=${today-7}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906111200431]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_user_time]]></job_name> 
		<job_desc><![CDATA[v1.2-day_user_time]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_time partition(day=${yesterday})
select
count(distinct user_id),
null
from ${PLATFORM_ID}.heartbeat_log where day=${yesterday}
union all
select
null,
count(distinct uid)
from ${PLATFORM_ID}.valid where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160906103514416]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.8.1-month_user_time_addr_apk_terminaltype_gender_age]]></job_name> 
		<job_desc><![CDATA[v1.8.1-month_user_time_addr_apk_terminaltype_gender_age]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_user_time_addr_apk_terminaltype_gender_age partition(day=${last_month})
select user_addr,user_addr_name,apk_version,client_type,gender,age,count(distinct user_id),
count(user_id),sp_id from ${PLATFORM_ID}.startupcomb1_day where day>=${last_month} and day<=${yesterday} group by user_addr,user_addr_name,apk_version,client_type,gender,age,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160905140742498]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_content_time_mode]]></job_name> 
		<job_desc><![CDATA[v1.2-week_content_time_mode]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_mode partition(day=${today-7})
select
video_type,
nns_mode,
count(distinct user_id),
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,episode_id,media_id,video_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
left join (select nns_id,nns_vod_id,nns_vod_index_id,nns_mode from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt3 on dt2.video_id=dt3.nns_vod_id and dt2.episode_id=dt3.nns_vod_index_id and dt2.media_id=dt3.nns_id
where dt1.day=${today-7}
group by video_type,nns_mode
union all
select
video_type,
nns_mode,
null,
sum(cnt_play_times),
sum(cnt_play_length)
from ${PLATFORM_ID}.day_content_time_mode where day>=${today-7} and day<${today}
group by video_type,nns_mode
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160905140054573]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_content_time_cp]]></job_name> 
		<job_desc><![CDATA[v1.2-week_content_time_cp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_cp partition(day=${today-7})
select
video_type,
dt3.nns_id cp_id,
dt4.nns_cp cp_name,
count(distinct user_id),
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,video_id from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
left join (select nns_id,nns_cp from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt4 on dt2.video_id=dt4.nns_id
left join (select nns_id,nns_name from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt3 on dt4.nns_cp=dt3.nns_name
where dt1.day=${today-7}
group by video_type,dt3.nns_id,dt4.nns_cp
union all
select
video_type,
cp_id,
cp_name,
null,
sum(cnt_play_times),
sum(cnt_play_length)
from ${PLATFORM_ID}.day_content_time_cp where day>=${today-7} and day<${today}
group by video_type,cp_id,cp_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160905110649660]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_content_time_apk]]></job_name> 
		<job_desc><![CDATA[v1.2-week_content_time_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_apk partition(day=${today-7})
select
apk_version,
video_type,
count(distinct user_id),
null,
null
from
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,apk_version from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id
where dt1.day=${today-7}
group by apk_version,video_type
union all
select
apk_version,
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length)
from ${PLATFORM_ID}.day_content_time_apk where day>=${today-7} and day<${today}
group by apk_version,video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160905103600723]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_content_time_addr]]></job_name> 
		<job_desc><![CDATA[v1.2-week_content_time_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_content_time_addr partition(day=${today-7})
select
if(length(nns_addr_code)>6,nns_addr_code,region_code) user_addr,
nns_addr_city user_addr_name,
video_type,
count(distinct user_id),
null,
null
from 
${PLATFORM_ID}.week_valid dt1 join (select user_id,video_type,region_code from ${PLATFORM_ID}.play_log where day>=${today-7} and day<${today}) dt2
on dt1.uid=dt2.user_id left join (select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt1.uid=dt3.nns_id
where dt1.day=${today-7}
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,video_type
union all
select
user_addr,
user_addr_name,
video_type,
null,
sum(cnt_play_times),
sum(cnt_play_length)
from ${PLATFORM_ID}.day_content_time_addr where day>=${today-7} and day<${today}
group by user_addr,user_addr_name,video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160902174238612]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-month_valid]]></job_name> 
		<job_desc><![CDATA[v1.2-month_valid]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:13.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:13.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 1 * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.month_valid partition(day=${last_month})
select uid from ${PLATFORM_ID}.valid where day>=${last_month} and day<${today} group by uid
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160902173538311]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-week_valid]]></job_name> 
		<job_desc><![CDATA[v1.2-week_valid]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 ? * MON]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.week_valid partition(day=${today-7})
select uid from ${PLATFORM_ID}.valid where day>=${today-7} and day<${today} group by uid
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160902102348703]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_content_time_mode]]></job_name> 
		<job_desc><![CDATA[v1.2-day_content_time_mode]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_mode partition(day=${yesterday})
select
'vod',
dt.nmode,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
dt2.nns_mode nmode,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select episode_id,media_id,video_id,user_id,event_type,play_sid,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type="vod") dt1 
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select nns_id,nns_vod_id,nns_vod_index_id,nns_mode from ${PLATFORM_ID}.nns_vod_media where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_vod_id and dt1.episode_id=dt2.nns_vod_index_id and dt1.media_id=dt2.nns_id
group by dt2.nns_mode,play_sid,user_id) dt
group by
dt.nmode
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160902101930068]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_content_time_cp]]></job_name> 
		<job_desc><![CDATA[v1.2-day_content_time_cp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_cp partition(day=${yesterday})
select
'vod',
dt.cpid,
dt.cpn,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
dt3.nns_id cpid,
dt2.nns_cp cpn,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select video_id,user_id,event_type,play_sid,server_time,duration from ${PLATFORM_ID}.play_log where day=${yesterday} and video_type="vod") dt1 
join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select nns_id,nns_cp from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
left join (select * from ${PLATFORM_ID}.nns_cp where day=${yesterday}) dt3 on dt2.nns_cp=dt3.nns_name
group by dt3.nns_id,dt2.nns_cp,play_sid,user_id) dt
group by
dt.cpid,
dt.cpn
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160901173420469]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_content_time_apk]]></job_name> 
		<job_desc><![CDATA[v1.2-day_content_time_apk]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_apk partition(day=${yesterday})
select
dt.apk_version,
dt.video_type,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
apk_version,
video_type,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select * from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by apk_version,video_type,play_sid,user_id) dt
group by dt.apk_version,dt.video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20160901172536402]]></job_id> 
		<parent_job_id><![CDATA[-1]]></parent_job_id> 
		<job_name><![CDATA[v1.2-day_content_time_addr]]></job_name> 
		<job_desc><![CDATA[v1.2-day_content_time_addr]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_content_time_addr partition(day=${yesterday})
select
dt.nns_addr_code,
dt.nns_addr_city,
dt.video_type,
count(distinct user_id),
sum(dt.cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6)
from
(select
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
video_type,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,video_type,event_type,play_sid,server_time,duration,region_code from ${PLATFORM_ID}.play_log where day=${yesterday}) dt1 join (select * from ${PLATFORM_ID}.valid where day=${yesterday}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
left join (select nns_id,nns_addr_code,nns_addr_city from ${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id
group by if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city,video_type,play_sid,user_id) dt
group by
dt.nns_addr_code,
dt.nns_addr_city,
dt.video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901103616306]]></job_id> 
		<parent_job_id><![CDATA[20180901103448698]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_member_user
select count(distinct nns_id) as cnt_member_existing_user,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${last_month}
from ((select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint)>=${yesterday})tb1
left join(select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901103254873]]></job_id> 
		<parent_job_id><![CDATA[20180901102953399]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_member_user
select count(distinct nns_id) as cnt_member_existing_user,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${today-7}
from ((select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint)>=${yesterday})tb1
left join(select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901102827150]]></job_id> 
		<parent_job_id><![CDATA[20180901102605586]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_user
select count(distinct nns_id) as cnt_member_existing_user,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${yesterday}
from ((select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint)>=${yesterday})tb1
left join(select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2 on tb1.nns_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901095941586]]></job_id> 
		<parent_job_id><![CDATA[20180901095736645]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_monthly_existing_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_monthly_existing_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_member_monthly_existing_user
select count(distinct tb1.nns_user_id) as cnt_member_monthly_existing_user, nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id,${last_month} from ((select distinct nns_user_id,nns_complete_times,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 1 and nns_next_auto_renew_time_state = 1)tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id ,nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180901095332151]]></job_id> 
		<parent_job_id><![CDATA[20180901095203952]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_monthly_existing_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_monthly_existing_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_member_monthly_existing_user
select count(distinct nns_user_id) as cnt_member_monthly_existing_user, nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id,${today-7} from ((select distinct nns_user_id,nns_complete_times,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 1 and nns_next_auto_renew_time_state = 1)tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180830113146987]]></job_id> 
		<parent_job_id><![CDATA[20180901103750812]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_expired_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_expired_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_expired_user
select count(distinct nns_id) as cnt_member_expired_user,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id , ${yesterday}
from ((select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint)<${yesterday})tb1
left join(select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829234500136]]></job_id> 
		<parent_job_id><![CDATA[20180901104304940]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_status_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_status_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_member_status_user
select null as cnt_member_online_user,null as cnt_member_vod_times,count(distinct tb1.nns_id) cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${last_month}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb1 join
(select uid from hive.${PLATFORM_ID}.month_valid where day=${last_month} )tb2 on tb1.nns_id = tb2.uid
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb3
on tb1.nns_id = tb3.user_id and equal(tb1.sp_id,tb3.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select null as cnt_member_online_user,count(distinct tb4.nns_id) as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb4.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday})tb4 join
            (
            select a.user_id as a_user_id from (
            (select user_id,play_sid from hive.${PLATFORM_ID}.play_log where day>=${last_month} and day<${today} and video_type='vod')a join
             (select user_id  ,play_sid from hive.${PLATFORM_ID}.heartbeat_log where day>=${last_month} and day<${today})b on a.user_id = b.user_id and 
             a.play_sid = b.play_sid)
            )tb5 on tb4.nns_id = tb5.a_user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb6
on tb4.nns_id = tb6.user_id and equal(tb4.sp_id,tb6.sp_id)) group by tb4.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select count(distinct tb7.nns_id) as cnt_member_online_user,null as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb7.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb7 join
(select distinct user_id from hive.${PLATFORM_ID}.heartbeat_log where day>=${last_month} and day<${today} group by user_id)tb8 on tb7.nns_id = tb8.user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb9
on tb7.nns_id = tb9.user_id and equal(tb7.sp_id,tb9.sp_id)) group by tb7.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829233256977]]></job_id> 
		<parent_job_id><![CDATA[20180901104149784]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_status_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_status_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_member_status_user
select null as cnt_member_online_user,null as cnt_member_vod_times,count(distinct tb1.nns_id) cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${today-7}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb1 join
(select uid from hive.${PLATFORM_ID}.week_valid where day=${today-7})tb2 on tb1.nns_id = tb2.uid
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb3
on tb1.nns_id = tb3.user_id and equal(tb1.sp_id,tb3.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select null as cnt_member_online_user,count(distinct tb4.nns_id) as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb4.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday})tb4 join
            (
            select a.user_id as a_user_id from (
            (select user_id,play_sid from hive.${PLATFORM_ID}.play_log where day>=${today-7} and day<${today} and video_type='vod')a join
             (select user_id  ,play_sid from hive.${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<${today})b on a.user_id = b.user_id and 
             a.play_sid = b.play_sid)
            )tb5 on tb4.nns_id = tb5.a_user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb6
on tb4.nns_id = tb6.user_id and equal(tb4.sp_id,tb6.sp_id)) group by tb4.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select count(distinct tb7.nns_id) as cnt_member_online_user,null as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb7.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb7 join
(select distinct user_id from hive.${PLATFORM_ID}.heartbeat_log where day>=${today-7} and day<${today} group by user_id)tb8 on tb7.nns_id = tb8.user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb9
on tb7.nns_id = tb9.user_id and equal(tb7.sp_id,tb9.sp_id)) group by tb7.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829231636811]]></job_id> 
		<parent_job_id><![CDATA[20180901104047185]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_status_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_status_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_status_user
select null as cnt_member_online_user,null as cnt_member_vod_times,count(distinct tb1.nns_id) cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb1 join
(select uid from hive.${PLATFORM_ID}.valid where day=${yesterday})tb2 on tb1.nns_id = tb2.uid
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb3
on tb1.nns_id = tb3.user_id and equal(tb1.sp_id,tb3.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select null as cnt_member_online_user,count(distinct tb4.nns_id) as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb4.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday})tb4 join
(
            select a.user_id as a_user_id from (
            (select user_id,play_sid from hive.${PLATFORM_ID}.play_log where day=${yesterday} and video_type='vod')a join
             (select user_id  ,play_sid from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday})b on a.user_id = b.user_id and 
             a.play_sid = b.play_sid)
            )tb5 on tb4.nns_id = tb5.a_user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb6
on tb4.nns_id = tb6.user_id and equal(tb4.sp_id,tb6.sp_id)) group by tb4.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
union all
select count(distinct tb7.nns_id) as cnt_member_online_user,null as cnt_member_vod_times,null cnt_member_active_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb7.sp_id, ${yesterday}  from (
(select nns_id,sp_id from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and nns_user_level > 0 and cast(format_datetime(from_unixtime(nns_user_level_end_time/1000),'yyyyMMdd') as bigint) >= ${yesterday} )tb7 join
(select distinct user_id from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday} group by user_id)tb8 on tb7.nns_id = tb8.user_id
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb9
on tb7.nns_id = tb9.user_id and equal(tb7.sp_id,tb9.sp_id)) group by tb7.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829222520191]]></job_id> 
		<parent_job_id><![CDATA[20180901101716789]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_register_invitation_code_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_register_invitation_code_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_register_invitation_code_user
select count(distinct nns_user_id) as cnt_register_invitation_code_user, user_addr,user_addr_city,user_addr_borough,user_addr_town, tb1.sp_id,${yesterday} from (
(select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_user_extends where day=${yesterday} and nns_register_invitation_code != '' and nns_register_invitation_code is not null)tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829221708617]]></job_id> 
		<parent_job_id><![CDATA[20180901101244375]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_renewals_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_renewals_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_member_renewals_user
select count(distinct nns_user_id) as cnt_member_renewals_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id,${last_month} from (
(select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_pay_order where day=${yesterday} and  
            cast(format_datetime(from_unixtime(nns_create_time/1000),'yyyyMMdd') as bigint)< ${today} and cast(format_datetime(from_unixtime(nns_create_time/1000),'yyyyMMdd') as bigint)>=${last_month}
            and nns_status = 1 and nns_pay_type = 1 )tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829220526535]]></job_id> 
		<parent_job_id><![CDATA[20180901100854807]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_renewals_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_renewals_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_member_renewals_user
select count(distinct nns_user_id) as cnt_member_renewals_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id,${today-7} from (
(select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_pay_order where day=${yesterday} and 
            cast(format_datetime(from_unixtime(nns_create_time/1000),'yyyyMMdd') as bigint)< ${today} and cast(format_datetime(from_unixtime(nns_create_time/1000),'yyyyMMdd') as bigint)>=${today-7}
            and nns_status = 1 and nns_pay_type = 1 )tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829215402228]]></job_id> 
		<parent_job_id><![CDATA[20180901100311062]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_renewals_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_renewals_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 04 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_renewals_user
select count(distinct nns_user_id) as cnt_member_renewals_user, user_addr,user_addr_city,user_addr_borough,user_addr_town ,tb1.sp_id,${yesterday} from(
(select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_pay_order where day=${yesterday}  
            and cast(format_datetime(from_unixtime(nns_create_time/1000),'yyyyMMdd') as bigint)=${yesterday} and nns_status = 1 and nns_pay_type = 1 )tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829212059923]]></job_id> 
		<parent_job_id><![CDATA[20180901094825637]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_monthly_existing_user]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_monthly_existing_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_monthly_existing_user
            select tb1.nns_user_id, nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id,${yesterday}
            from ((select distinct nns_user_id,nns_complete_times,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 1 and nns_next_auto_renew_time_state = 1)tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by    tb1.nns_user_id,tb1.sp_id,nns_complete_times,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829200503069]]></job_id> 
		<parent_job_id><![CDATA[20180901093946217]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-month_member_monthly_unsubscribe]]></job_name> 
		<job_desc><![CDATA[v2.17.9-month_member_monthly_unsubscribe]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 04 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_member_monthly_unsubscribe
select count(distinct nns_user_id) as cnt_member_monthly_unsubscribe_user, user_addr,user_addr_city,user_addr_borough,user_addr_town, tb1.sp_id, ${last_month} from(
(select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 2)tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829194519897]]></job_id> 
		<parent_job_id><![CDATA[20180901093105803]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-week_member_monthly_unsubscribe]]></job_name> 
		<job_desc><![CDATA[v2.17.9-week_member_monthly_unsubscribe]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 04 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_member_monthly_unsubscribe
select count(distinct nns_user_id) as cnt_member_monthly_unsubscribe_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${today-7}   from ((select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 2 )tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2 on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id))
group by tb1.sp_id,user_addr,user_addr_city,user_addr_borough,user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180829192606236]]></job_id> 
		<parent_job_id><![CDATA[20180901091405807]]></parent_job_id> 
		<job_name><![CDATA[v2.17.9-day_member_monthly_unsubscribe]]></job_name> 
		<job_desc><![CDATA[v2.17.9-day_member_monthly_unsubscribe]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 03 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_member_monthly_unsubscribe
select count(distinct nns_user_id) as cnt_member_monthly_unsubscribe_user, user_addr,user_addr_city,user_addr_borough,user_addr_town,tb1.sp_id, ${yesterday} from ((select nns_user_id,sp_id from hive.${PLATFORM_ID}.nns_auto_renew_order where day=${yesterday} and nns_state = 2) tb1
left join (select user_id,user_addr,user_addr_city,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} )tb2
on tb1.nns_user_id = tb2.user_id and equal(tb1.sp_id,tb2.sp_id)) group by tb1.sp_id,tb2.user_addr,tb2.user_addr_city,tb2.user_addr_borough,tb2.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010009]]></job_id> 
		<parent_job_id><![CDATA[2018082010010008]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_play_log_special_typepresto]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_play_log_special_typepresto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_quality_play_special_log_type
select a0.user_id,
a0.video_type,
a2.user_addr,
a2.user_addr_borough,
a2.user_addr_city,
a2.user_addr_town,
a0.sp_id,
count(distinct case when a0.video_type='vod' and a0.event_type='api' and round(duration*1/1000,2)>2 then a1.play_sid end) cnt_api_play_times,
count(distinct case when a0.video_type='vod' and (a0.event_type='drag' or a0.event_type='pause') and round(duration*1/1000,2)>2 then a1.play_sid end) cnt_2s_play_times,
count(distinct case when a0.video_type='vod' and (a0.event_type='drag' or a0.event_type='pause')  then a1.play_sid end) cnt_play_times,${yesterday}
from (
select user_id,play_sid,video_type,sp_id,event_type,duration from hive.${PLATFORM_ID}.play_log where  day=${yesterday}
) a0 left join
(
select user_id,play_sid,sp_id from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday}
)a1 on a0.play_sid = a1.play_sid and a0.user_id=a1.user_id
left join 
(select user_id,user_name,user_addr,user_addr_city,stb_id,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) a2 on a0.user_id=a2.user_id and a0.sp_id = a2.sp_id
group by a0.user_id,a0.sp_id,
a0.video_type,
a2.user_addr,
a2.user_addr_borough,
a2.user_addr_city,
a2.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010006]]></job_id> 
		<parent_job_id><![CDATA[2018082010010005]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_play_log_type_presto]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_play_log_type_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_quality_play_log_type
select 
dt.user_id,dt.video_type,
d3.user_addr,
d3.user_addr_borough,
d3.user_addr_city,
d3.user_addr_town,
dt.sp_id,
count(distinct dt.play_sid) cnt_quality_play_times,${yesterday} from (select dt1.play_sid play_sid,dt1.user_id user_id,dt1.video_type,dt1.sp_id from (select play_sid,user_id,video_type,sp_id  from hive.${PLATFORM_ID}.play_log where day=${yesterday})dt1 join (select play_sid,user_id from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday})dt2 on dt1.user_id=dt2.user_id and dt1.play_sid=dt2.play_sid)dt 
left join (select play_sid from hive.${PLATFORM_ID}.play_log where event_type='error' and day=${yesterday} )d2 on dt.play_sid =d2.play_sid 
left join (select user_id,user_name,user_addr,user_addr_city,stb_id,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) d3 on dt.user_id=d3.user_id and dt.sp_id = d3.sp_id
group by dt.user_id,dt.video_type,
d3.user_addr,
d3.user_addr_borough,
d3.user_addr_city,
d3.user_addr_town,
dt.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010004]]></job_id> 
		<parent_job_id><![CDATA[2018082010010003]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_performance_log_type_presto]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_performance_log_type_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_quality_performance_log_type
select b.user_id,a.p_event_value,
c.user_addr,
c.user_addr_borough,
c.user_addr_city,
c.user_addr_town,
a.sp_id,count(1) cnt_page_times_view,
${yesterday}
from 
(
select session_id,element_at(p_event_value,'type')p_event_value,p_event_duration,sp_id,day from hive.${PLATFORM_ID}.performance_log where round(p_event_duration*1/1000,2)>2 and day=${yesterday}
) a 
left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${yesterday}) b
on a.session_id=b.session_id
left join
(select user_id,user_name,user_addr,user_addr_city,stb_id,user_addr_borough,user_addr_town,sp_id from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) c on b.user_id=c.user_id and a.sp_id = c.sp_id
group by b.user_id,a.sp_id,a.day,a.p_event_value,c.user_addr,c.user_addr_borough,
c.user_addr_city,
c.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[2018082010010002]]></job_id> 
		<parent_job_id><![CDATA[2018082010010001]]></parent_job_id> 
		<job_name><![CDATA[v2.17_day_quality_user_log_type_presto]]></job_name> 
		<job_desc><![CDATA[v2.17_day_quality_user_log_type_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_quality_user_log_type
select c.user_id,a.p_event_value,
dt4.user_addr,
dt4.user_addr_borough,
dt4.user_addr_city,
dt4.user_addr_town,
a.sp_id,count(1) cnt_page_times_view,
${yesterday}
from 
(select dt1.session_id,element_at(event_value,'type')p_event_value,dt1.user_id,sp_id,day from hive.${PLATFORM_ID}.user_log dt1
where day=${yesterday}
) a 
left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log 
where day=${yesterday} group by session_id,user_id) c on a.session_id=c.session_id
and c.user_id is not null
left join
(select user_id,user_name,user_addr,user_addr_city,sp_id,stb_id,user_addr_borough,user_addr_town from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt4 on c.user_id=dt4.user_id and a.sp_id=dt4.sp_id
group by c.user_id,a.sp_id,a.day,a.p_event_value,
dt4.user_addr,
dt4.user_addr_borough,
dt4.user_addr_city,
dt4.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121705484]]></job_id> 
		<parent_job_id><![CDATA[20180731121640012]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_churn_return_silent_user-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_churn_return_silent_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		INSERT OVERWRITE TABLE ${PLATFORM_ID}.day_churn_return_silent_user PARTITION(day=${yesterday})
SELECT tb3.cnt_silent_user_total, tb3.cnt_churn_user_total, tb2.cnt_return_user_total
    , COALESCE(tb3.cnt_condition, tb2.cnt_condition) AS cnt_condition
    , COALESCE(tb3.sp_id, tb2.sp_id) AS sp_id
FROM (
    SELECT tb0.cnt_silent_user_total, tb1.cnt_churn_user_total, COALESCE(tb0.cnt_condition, tb1.cnt_condition) AS cnt_condition
        , COALESCE(tb0.sp_id, tb1.sp_id) AS sp_id
    FROM (
        SELECT COUNT(DISTINCT user_id) AS cnt_silent_user_total, sp_id, cnt_condition, day
        FROM ${PLATFORM_ID}.day_silent_user
        WHERE day = ${yesterday}
        GROUP BY sp_id, cnt_condition, day
    ) tb0
    FULL JOIN (
        SELECT COUNT(DISTINCT user_id) AS cnt_churn_user_total, sp_id, cnt_condition, day
        FROM ${PLATFORM_ID}.day_churn_user
        WHERE day = ${yesterday}
        GROUP BY sp_id, cnt_condition, day
    ) tb1
    ON tb0.sp_id = tb1.sp_id AND tb0.cnt_condition = tb1.cnt_condition
) tb3
FULL JOIN (
    SELECT COUNT(DISTINCT user_id) AS cnt_return_user_total, sp_id, cnt_condition, day
    FROM ${PLATFORM_ID}.day_return_user
    WHERE day = ${yesterday}
    GROUP BY sp_id, cnt_condition, day
) tb2
ON tb3.sp_id = tb2.sp_id AND tb3.cnt_condition = tb2.cnt_condition
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121543112]]></job_id> 
		<parent_job_id><![CDATA[20180731121510100]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_return_user-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_return_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		INSERT OVERWRITE TABLE ${PLATFORM_ID}.day_return_user PARTITION(day=${yesterday})
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '7', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-21} AND day < ${today-14}
        ) tb1
            LEFT JOIN (
                SELECT uid, sp_id, day
                FROM ${PLATFORM_ID}.valid
                WHERE day >= ${today-14} AND day < ${today-7}
            ) tb2
            ON tb1.user_id = tb2.uid AND tb1.sp_id = tb2.sp_id
        WHERE tb2.uid IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT user_id, sp_id
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-7} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.user_id AND tb3.sp_id = tb4.sp_id
    WHERE tb4.user_id IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
UNION ALL
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '14', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-42} AND day < ${today-28}
        ) tb1
            LEFT JOIN (
                SELECT uid, sp_id, day
                FROM ${PLATFORM_ID}.valid
                WHERE day >= ${today-28} AND day < ${today-14}
            ) tb2
            ON tb1.user_id = tb2.uid AND tb1.sp_id = tb2.sp_id
        WHERE tb2.uid IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT user_id, sp_id
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-14} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.user_id AND tb3.sp_id = tb4.sp_id
    WHERE tb4.user_id IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
UNION ALL
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '30', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-90} AND day < ${today-60}
        ) tb1
            LEFT JOIN (
                SELECT uid, sp_id, day
                FROM ${PLATFORM_ID}.valid
                WHERE day >= ${today-60} AND day < ${today-30}
            ) tb2
            ON tb1.user_id = tb2.uid AND tb1.sp_id = tb2.sp_id
        WHERE tb2.uid IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT user_id, sp_id
            FROM ${PLATFORM_ID}.day_content_time_user
            WHERE day >= ${today-30} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.user_id AND tb3.sp_id = tb4.sp_id
    WHERE tb4.user_id IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731121419762]]></job_id> 
		<parent_job_id><![CDATA[20180731121352402]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_churn_user-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_churn_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		INSERT OVERWRITE TABLE ${PLATFORM_ID}.day_churn_user PARTITION(day=${yesterday})
SELECT t1.uid,t2.user_name,t2.user_create_time,null,'7',t1.sp_id
FROM (
    SELECT DISTINCT tb1.uid AS uid, tb1.sp_id
    FROM (
        SELECT uid, sp_id, day
        FROM ${PLATFORM_ID}.valid
        WHERE day >= ${today-14} AND day < ${today-7}
    ) tb1
        LEFT JOIN (
            SELECT uid, sp_id, day
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-7} AND day < ${today}
        ) tb2
        ON tb1.uid = tb2.uid
    WHERE tb2.uid IS NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.uid = t2.user_id
UNION ALL
SELECT t1.uid,t2.user_name,t2.user_create_time,null,'14',t1.sp_id
FROM (
    SELECT DISTINCT tb1.uid AS uid, tb1.sp_id
    FROM (
        SELECT uid, sp_id, day
        FROM ${PLATFORM_ID}.valid
        WHERE day >= ${today-28} AND day < ${today-14}
    ) tb1
        LEFT JOIN (
            SELECT uid, sp_id, day
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-14} AND day < ${today}
        ) tb2
        ON tb1.uid = tb2.uid
    WHERE tb2.uid IS NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.uid = t2.user_id
UNION ALL
SELECT t1.uid,t2.user_name,t2.user_create_time,null,'30',t1.sp_id
FROM (
    SELECT DISTINCT tb1.uid AS uid, tb1.sp_id
    FROM (
        SELECT uid, sp_id, day
        FROM ${PLATFORM_ID}.valid
        WHERE day >= ${today-60} AND day < ${today-30}
    ) tb1
        LEFT JOIN (
            SELECT uid, sp_id, day
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-30} AND day < ${today}
        ) tb2
        ON tb1.uid = tb2.uid
    WHERE tb2.uid IS NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
                ON t1.uid = t2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180731120929375]]></job_id> 
		<parent_job_id><![CDATA[20180731115643204]]></parent_job_id> 
		<job_name><![CDATA[v2.16.3-day_silent_user-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.3-day_silent_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		INSERT OVERWRITE TABLE ${PLATFORM_ID}.day_silent_user PARTITION(day=${yesterday})
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '7', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_view
            WHERE day >= ${today-14} AND day < ${today-7}
        ) tb1
            LEFT JOIN (
                SELECT user_id, sp_id, day
                FROM ${PLATFORM_ID}.day_view
                WHERE day >= ${today-7} AND day < ${today}
            ) tb2
            ON tb1.user_id = tb2.user_id AND tb1.sp_id = tb2.sp_id
        WHERE tb2.user_id IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT uid, sp_id
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-7} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.uid AND tb3.sp_id = tb4.sp_id
    WHERE tb4.uid IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
UNION ALL
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '14', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_view
            WHERE day >= ${today-28} AND day < ${today-14}
        ) tb1
            LEFT JOIN (
                SELECT user_id, sp_id, day
                FROM ${PLATFORM_ID}.day_view
                WHERE day >= ${today-14} AND day < ${today}
            ) tb2
            ON tb1.user_id = tb2.user_id AND tb1.sp_id = tb2.sp_id
        WHERE tb2.user_id IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT uid, sp_id
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-14} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.uid AND tb3.sp_id = tb4.sp_id
    WHERE tb4.uid IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
UNION ALL
SELECT t1.user_id, t2.user_name, t2.user_create_time, NULL, '30', t1.sp_id
FROM (
    SELECT tb3.user_id, tb3.sp_id
    FROM (
        SELECT DISTINCT tb1.user_id AS user_id, tb1.sp_id
        FROM (
            SELECT user_id, sp_id, day
            FROM ${PLATFORM_ID}.day_view
            WHERE day >= ${today-60} AND day < ${today-30}
        ) tb1
            LEFT JOIN (
                SELECT user_id, sp_id, day
                FROM ${PLATFORM_ID}.day_view
                WHERE day >= ${today-30} AND day < ${today}
            ) tb2
            ON tb1.user_id = tb2.user_id AND tb1.sp_id = tb2.sp_id
        WHERE tb2.user_id IS NULL AND tb2.sp_id IS NULL
    ) tb3
        LEFT JOIN (
            SELECT uid, sp_id
            FROM ${PLATFORM_ID}.valid
            WHERE day >= ${today-30} AND day < ${today}
        ) tb4
        ON tb3.user_id = tb4.uid AND tb3.sp_id = tb4.sp_id
    WHERE tb4.uid IS NOT NULL AND tb4.sp_id IS NOT NULL
) t1
    LEFT JOIN (
        SELECT sp_id, user_id, user_name, nns_create_time AS user_create_time
        FROM ${PLATFORM_ID}.day_user_info
        WHERE day = ${yesterday}
    ) t2
    ON t1.user_id = t2.user_id AND t1.sp_id = t2.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727183448672]]></job_id> 
		<parent_job_id><![CDATA[20180727183423906]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_pay_user-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_pay_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_pay_user
select user_id,product_id,product_name,product_type,order_type,pay_channel_id,video_id,video_name,addr_code,
addr_name,
client_type,
apk_version,
nns_boss_area_bind,
cp_id,
dt1.sp_id,
cast(nns_order_state as int),
is_new,
is_active,
if(dt2.nns_id is null,0,1),
cast(format_datetime(from_unixtime(cast(create_time/1000 as bigint)),'yyyyMMdd') as int),product_price,
${yesterday}
from 
(select * 
 from hive.${PLATFORM_ID}.day_sales_basic_data where day=${yesterday}) dt1
left join 
(select nns_id,sp_id from hive.${PLATFORM_ID}.order_paid_history_info group by nns_id,sp_id) dt2 
on dt1.user_id=dt2.nns_id and dt1.sp_id=dt2.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180727173016962]]></job_id> 
		<parent_job_id><![CDATA[20180727172944685]]></parent_job_id> 
		<job_name><![CDATA[v2.16.2-day_sales_basic_data-presto]]></job_name> 
		<job_desc><![CDATA[v2.16.2-day_sales_basic_data-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_sales_basic_data
select
dt0.nns_user_id,
dt0.nns_order_price,
dt0.nns_product_id,
dt0.nns_order_type,
dt0.nns_pay_channel_id,
dt0.nns_video_id,
dt0.sp_id,
cast(dt0.nns_order_state as varchar),
dt1.nns_product_name,
dt1.nns_product_type,
if(length(dt2.nns_addr_code)>6,dt2.nns_addr_code,region_code) nns_addr_code,
dt2.nns_addr_city,
dt3.nns_name,
if(dt4.nns_user_id is null and dt0.nns_order_state = 1,1,0),
client_type,
if(dt5.user_id is not null and dt0.nns_order_state = 1,1,0),
dt0.nns_create_time,
dt0.nns_modify_time,
apk_version,
dt3.nns_vod_ext_language,
dt0.cp_id,
dt2.nns_boss_area_bind,
dt0.nns_product_price,
${yesterday}
from 
(select nns_id,nns_user_id,nns_order_price,nns_product_price,nns_product_id,nns_order_type,nns_pay_channel_id,nns_video_id,sp_id,nns_order_state,nns_create_time ,nns_modify_time,cp_id from hive.${PLATFORM_ID}.nns_buy_order where format_datetime(from_unixtime(cast(nns_modify_time/1000 as bigint)),'yyyyMMdd')='${yesterday}' and day = ${yesterday})dt0 
left join 
(select nns_product_id,nns_product_name,nns_product_type,cp_id,sp_id from hive.${PLATFORM_ID}.nns_product where day=${yesterday})dt1 
on dt0.nns_product_id=dt1.nns_product_id and equal(dt0.cp_id,dt1.cp_id) and equal(dt0.sp_id,dt1.sp_id)
left join 
(select nns_id,nns_addr_code,nns_addr_city,nns_nns_boss_area_bind nns_boss_area_bind from hive.${PLATFORM_ID}.nns_user where day=${yesterday})dt2 
on dt0.nns_user_id = dt2.nns_id 
left join 
(select nns_id,nns_name,nns_vod_ext_language from hive.${PLATFORM_ID}.nns_vod where day=${yesterday})dt3 
on dt0.nns_video_id = dt3.nns_id 
left join 
(select nns_user_id from hive.${PLATFORM_ID}.nns_buy_order where day = ${yesterday} and nns_order_state = 1 and format_datetime(from_unixtime(cast(nns_modify_time/1000 as bigint)),'yyyyMMdd') < '${yesterday}' group by nns_user_id)dt4 
on dt0.nns_user_id = dt4.nns_user_id 
left join 
(select user_id from hive.${PLATFORM_ID}.play_log where day=${yesterday} and event_type='play' group by user_id)dt5 
on dt0.nns_user_id = dt5.user_id
left join 
(select max(client_type) client_type,max(apk_version) apk_version,user_id,max(user_addr) region_code from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} group by user_id)dt6 
on dt0.nns_user_id = dt6.user_id 
left join 
(select nns_id from hive.${PLATFORM_ID}.order_paid_history_info group by nns_id)dt7 
on dt0.nns_id=dt7.nns_id 
where dt7.nns_id is null
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180717134540789]]></job_id> 
		<parent_job_id><![CDATA[20180717134540788]]></parent_job_id> 
		<job_name><![CDATA[v2.15.1-content_live_video_playbill_time_interval_30minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.15.1-content_live_video_playbill_time_interval_30minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.content_live_video_playbill_time_interval_30minute
select video_id,video_name,playbill_name,round(sum(end_time-start_time)/(60.0*1000),6),count(distinct user_id),minute,sp_id,${yesterday} from 
(select user_id,play_sid,video_id,video_name,playbill_name,minute,max(server_time) end_time,min(server_time) start_time,sp_id from (select user_id,play_sid,video_id,video_name,playbill_name,concat(format_datetime(from_unixtime(CAST(server_time / 1000 AS bigint)), 'HH'),
(case when cast(format_datetime(from_unixtime(CAST(server_time / 1000 AS bigint)), 'mm') as bigint) < 30 then '00' else '30' end)) AS minute,server_time,sp_id from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type='live')dt1 group by user_id,play_sid,video_id,video_name,playbill_name,minute,sp_id)a group by video_id,video_name,playbill_name,minute,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180710114239052]]></job_id> 
		<parent_job_id><![CDATA[20180710114219851]]></parent_job_id> 
		<job_name><![CDATA[day_quality_error_time_page_addr_apk_terminaltype_sp]]></job_name> 
		<job_desc><![CDATA[day_quality_error_time_page_addr_apk_terminaltype_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_error_time_page_addr_apk_terminaltype_sp partition(day=${yesterday})
select
user_addr,
user_addr_name, 
apk_version,
page_id,
terminaltype,
error_type,
error_code,
count(1),
sp_id 
 from ${PLATFORM_ID}.day_quality_error_page_detail_list where day=${yesterday} group by user_addr,user_addr_name,apk_version,page_id,terminaltype,error_type,error_code,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180709171031610]]></job_id> 
		<parent_job_id><![CDATA[20180709170950213]]></parent_job_id> 
		<job_name><![CDATA[day_quality_error_time_video_addr_apk_terminaltype_sp]]></job_name> 
		<job_desc><![CDATA[day_quality_error_time_video_addr_apk_terminaltype_sp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_quality_error_time_video_addr_apk_terminaltype_sp partition(day=${yesterday})
select
user_addr,
user_addr_name, 
apk_version,
video_id,
video_name,
terminaltype,
count(1),
sp_id,
video_type 
 from ${PLATFORM_ID}.day_quality_error_video_detail_list where day=${yesterday} group by user_addr,user_addr_name,apk_version,video_id,video_name,terminaltype,sp_id,video_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-5]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180708220046541]]></job_id> 
		<parent_job_id><![CDATA[20180708215910232]]></parent_job_id> 
		<job_name><![CDATA[day_special_video_addr_sp_user-presto]]></job_name> 
		<job_desc><![CDATA[day_special_video_addr_sp_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_special_video_addr_sp_user
select special_id,special_name,video_id,video_name,user_addr,addr_city,addr_borough,addr_town,user_id,sum(cnt_play_times),progress,sp_id,${yesterday} from (select special_id,special_name,video_id,video_name,user_addr,addr_city,addr_borough,addr_town,d.user_id,cnt_play_times,progress,sp_id,${yesterday} day from (select user_id,video_id,video_name,special_id,special_name,sp_id,count(1) cnt_play_times,case when progress<25 then 25 when 25>=progress and progress<50 then 50 when progress>=50 and progress<75 then 75 else 100 end progress from (select user_id,video_id,video_name,special_id,special_name,dt1.sp_id,play_sid,if(video_duration<=0,0,(if(finishtime>0,finishtime,endtime)-if(playtime>0,playtime,starttime)-offtime)*100/video_duration)  progress from (select user_id,video_id,max(video_name) video_name,max(element_at(ext_info,'special_id')) special_id,max(element_at(ext_info,'special_name')) special_name,max(if(element_at(ext_info,'video_duration')='',0,cast(element_at(ext_info,'video_duration') as bigint))) video_duration,sp_id,play_sid,sum(if(event_type in ('buffer','pause','drag'),duration,0)) offtime,max(if(event_type='play',server_time,0)) playtime,max(if(event_type='finish',server_time,0)) finishtime from hive.${PLATFORM_ID}.play_log where day=${yesterday} and element_at(ext_info,'special_id') is not null and video_type ='vod' group by user_id,video_id,sp_id,play_sid)dt1 join (select uid,pid,starttime,endtime from hive.${PLATFORM_ID}.valid where day=${yesterday})dt2 on dt1.user_id=dt2.uid and dt1.play_sid=dt2.pid)dt group by user_id,video_id,video_name,special_id,special_name,sp_id,case when progress<25 then 25 when 25>=progress and progress<50 then 50 when progress>=50 and progress<75 then 75 else 100 end)d left join (select user_id,user_addr,user_addr_city addr_city,user_addr_borough addr_borough,user_addr_town addr_town from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})dt3 on d.user_id=dt3.user_id union all select * from hive.${PLATFORM_ID}.day_special_video_addr_sp_user where day=${today-2})dt0 group by special_id,special_name,video_id,video_name,user_addr,addr_city,addr_borough,addr_town,user_id,progress,sp_id,day
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180707220046541]]></job_id> 
		<parent_job_id><![CDATA[20180707215910232]]></parent_job_id> 
		<job_name><![CDATA[week_total_summary-presto]]></job_name> 
		<job_desc><![CDATA[week_total_summary-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_total_summary 
select sp_id,cnt_user_all_stored,cnt_user_collect_stored,cnt_vod_content,cnt_live_content,cnt_playbill_content,cnt_user_all_collected,${today-7} from hive.${PLATFORM_ID}.day_total_summary where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180707120046541]]></job_id> 
		<parent_job_id><![CDATA[20180707115910232]]></parent_job_id> 
		<job_name><![CDATA[month_total_summary-presto]]></job_name> 
		<job_desc><![CDATA[month_total_summary-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_total_summary 
select sp_id,cnt_user_all_stored,cnt_user_collect_stored,cnt_vod_content,cnt_live_content,cnt_playbill_content,cnt_user_all_collected,${last_month} from hive.${PLATFORM_ID}.day_total_summary where day=${yesterday}
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180627183202402]]></job_id> 
		<parent_job_id><![CDATA[20180627182423338]]></parent_job_id> 
		<job_name><![CDATA[month_pay_user-presto]]></job_name> 
		<job_desc><![CDATA[month_pay_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_pay_user
select user_id,product_id,product_name,product_type,order_type,pay_channel_id,video_id,video_name,nns_addr_code,nns_addr_name,client_type,apk_version,nns_boss_area_bind,cp_id,sp_id,nns_order_state,is_new,is_active,is_repeat,create_day,
${last_month}
from 
hive.${PLATFORM_ID}.day_pay_user where day>=${last_month} and day<=${yesterday} group by user_id,product_id,product_name,product_type,order_type,pay_channel_id,video_id,video_name,nns_addr_code,nns_addr_name,client_type,apk_version,nns_boss_area_bind,cp_id,sp_id,nns_order_state,is_new,is_active,is_repeat,create_day
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180627153202402]]></job_id> 
		<parent_job_id><![CDATA[20180627152423338]]></parent_job_id> 
		<job_name><![CDATA[week_pay_user-presto]]></job_name> 
		<job_desc><![CDATA[week_pay_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 50 6 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_pay_user
select user_id,product_id,product_name,product_type,order_type,pay_channel_id,video_id,video_name,nns_addr_code,nns_addr_name,client_type,apk_version,nns_boss_area_bind,cp_id,sp_id,nns_order_state,is_new,is_active,is_repeat,create_day,
${today-7}
from 
hive.${PLATFORM_ID}.day_pay_user where day>=${today-7} and day<=${yesterday} group by user_id,product_id,product_name,product_type,order_type,pay_channel_id,video_id,video_name,nns_addr_code,nns_addr_name,client_type,apk_version,nns_boss_area_bind,cp_id,sp_id,nns_order_state,is_new,is_active,is_repeat,create_day
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180621162508441]]></job_id> 
		<parent_job_id><![CDATA[20180621162411503]]></parent_job_id> 
		<job_name><![CDATA[day_online_user-presto]]></job_name> 
		<job_desc><![CDATA[day_online_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_online_user
select
tb1.user_id,
user_name,
user_addr,
user_addr_city,
user_addr_borough,
user_addr_town,
apk_version,
client_type,
num cnt_user_online_time_length,
sp_id,
${yesterday}
from 
(select user_id,apk_version,client_type,sp_id,count(*) num from hive.${PLATFORM_ID}.heartbeat_log 
where day=${yesterday} group by user_id,apk_version,client_type,sp_id)tb1
left join 
(select user_id,user_name,user_addr,user_addr_city,user_addr_borough,user_addr_town from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb2
on tb1.user_id = tb2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180621150612581]]></job_id> 
		<parent_job_id><![CDATA[20180621150216637]]></parent_job_id> 
		<job_name><![CDATA[online_user_5min-presto]]></job_name> 
		<job_desc><![CDATA[online_user_5min-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.online_user_5min
select
cast(tb1.user_id as varchar(100)),
cast(user_name as varchar(100)),
cast(user_addr as varchar(100)),
cast(user_addr_city as varchar(100)),
cast(user_addr_borough as varchar(100)),
cast(user_addr_town as varchar(100)),
cast(apk_version as varchar(100)),
cast(client_type as varchar(100)),
cast(sp_id as varchar(100)),
${day_last_3_5m},
cast(${minute_last_3_5m} as int),
cast(server_time as bigint)
from 
(select user_id,apk_version,client_type,sp_id,server_time from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m} group by user_id,apk_version,client_type,sp_id,server_time)tb1
left join 
(select user_id,user_name,user_addr,user_addr_city,user_addr_borough,user_addr_town from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday})tb2
on tb1.user_id = tb2.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180613143954070]]></job_id> 
		<parent_job_id><![CDATA[20180613143932307]]></parent_job_id> 
		<job_name><![CDATA[day_view_time-presto]]></job_name> 
		<job_desc><![CDATA[day_view_time-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_view_time
select
sum(cnt_page_view),
sum(cnt_user_active),
sum(cnt_page_stay),
sum(cnt_page_ready_duration),
sum(cnt_page_ready),
sum(cnt_page_loaded_duration),
sum(cnt_page_loaded),
sum(max_page_ready_duration_),
sum(max_page_loaded_duration_),
sum(min_page_ready_duration_),
sum(min_page_loaded_duration_),
${yesterday}
from(
select
sum(1) cnt_page_view,
count(distinct user_id) cnt_user_active,
sum(cnt_page_stay)/1000.0 cnt_page_stay,
null cnt_page_ready_duration,
null cnt_page_ready,
null cnt_page_loaded_duration,
null cnt_page_loaded,
null max_page_ready_duration_,
null max_page_loaded_duration_,
null min_page_ready_duration_,
null min_page_loaded_duration_
from
(select d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,
max(d1.server_time)-max(d2.server_time) cnt_page_stay
from
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where day = ${yesterday} and event_name='open_page') d1
left join
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where day = ${yesterday} and event_name='open_page') d2
on d1.session_id=d2.session_id and d1.source_page_id_1=d2.target_page_id_1
where d1.server_time>=coalesce(d2.server_time,0)
group by d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time) dt1
left join
(select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
union all
select
null cnt_page_view,
null cnt_user_active,
null cnt_page_stay,
sum(if(p_event_name='ready_page',p_event_duration,0)) cnt_page_ready_duration,
sum(if(p_event_name='ready_page',1,0)) cnt_page_ready,
sum(if(p_event_name='loaded_page',p_event_duration,0)) cnt_page_loaded_duration,
sum(if(p_event_name='loaded_page',1,0)) cnt_page_loaded,
max(if(p_event_name='ready_page',p_event_duration,0)) max_page_ready_duration_,
max(if(p_event_name='loaded_page',p_event_duration,0)) max_page_loaded_duration_,
min(if(p_event_name='ready_page',p_event_duration,0)) min_page_ready_duration_,
min(if(p_event_name='loaded_page',p_event_duration,0)) min_page_loaded_duration_
from
hive.${PLATFORM_ID}.performance_log where day = ${yesterday} 
) d
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[1]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180611173634334]]></job_id> 
		<parent_job_id><![CDATA[20180611173520922]]></parent_job_id> 
		<job_name><![CDATA[hour_view-presto]]></job_name> 
		<job_desc><![CDATA[hour_view-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.hour_view
select
if(length(user_addr)>6,user_addr,region_code) user_addr,
user_addr_city,
apk_version,
element_at(event_value, 'page_type'),
target_page_id_1,
dt2.user_id,
dt1.sp_id,
${day_last_3_1h},
${minute_last_3_1h}
from
(select session_id,event_value,target_page_id_1,sp_id from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='open_page') dt1 
left join
(select session_id,user_id,apk_version,max(region_code) region_code from hive.${PLATFORM_ID}.session_log where day>=${yesterday} group by session_id,user_id,apk_version) dt2
on dt1.session_id=dt2.session_id
left join
(select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id
left join
(select * from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
if(length(user_addr)>6,user_addr,region_code),
user_addr_city,
apk_version,
element_at(event_value, 'page_type'),
target_page_id_1,
dt2.user_id,
dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603193356923]]></job_id> 
		<parent_job_id><![CDATA[20171108110150690]]></parent_job_id> 
		<job_name><![CDATA[user_time_sp_new_day]]></job_name> 
		<job_desc><![CDATA[user_time_sp_new_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_sp_new_day partition(day=${yesterday})
select cnt_daily_active_user,cnt_week_active_user,cnt_month_active_user,dt1.sp_id from 
(select count(distinct user_id) cnt_month_active_user,sp_id from ${PLATFORM_ID}.day_user_time_new_user where 
 day>=${today-31} and day<${today} group by sp_id)dt1 left join (select count(distinct user_id) cnt_week_active_user,sp_id from 
 ${PLATFORM_ID}.day_user_time_new_user where day>=${today-8} and day<${today} group by sp_id)dt2 on dt1.sp_id=dt2.sp_id left join 
(select count(distinct user_id) cnt_daily_active_user,sp_id from ${PLATFORM_ID}.day_user_time_new_user where 
 day=${yesterday} group by sp_id)dt3 on dt1.sp_id=dt3.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603193356890]]></job_id> 
		<parent_job_id><![CDATA[20180530170000005]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_times_info_presto]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_times_info_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_twmz_view_times
select a.period,a.id,a.name,a.tw_language,a.layout,b.nns_addr_code,null,null,null,a.cnt_page_times_view,a.page_total,a.page_offsite,a.sp_id,a.day from (
select 
element_at(event_value,'period')period,
element_at(event_value,'id')id,
element_at(event_value,'name')name,
element_at(event_value,'tw_language')tw_language,
element_at(event_value,'layout')layout,
CASE WHEN element_at(event_value,'tw_language')='Chineses' THEN count(element_at(event_value,'id')) 
 WHEN element_at(event_value,'tw_language')='Mongolian' THEN count(element_at(event_value,'layout'))  END as cnt_page_times_view, 
cast(element_at(event_value,'page_total') as int)page_total,
cast(element_at(event_value,'page_offsite') as int)page_offsite,
user_id,session_id,
day,
sp_id
from hive.${PLATFORM_ID}.user_log  
where day=${yesterday} and event_name='view_twmz' 
group by 
element_at(event_value,'period'),
element_at(event_value,'id'),
element_at(event_value,'name'),
element_at(event_value,'tw_language'),
element_at(event_value,'layout'),
element_at(event_value,'page_total'),
element_at(event_value,'page_offsite'),
user_id,
session_id,
day,
sp_id
)a left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) c on a.session_id=c.session_id
left join (select nns_id,nns_addr_code from hive.${PLATFORM_ID}.nns_user where day=${yesterday})  b on c.user_id =  b.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603193356889]]></job_id> 
		<parent_job_id><![CDATA[20180530170000004]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_user_info_presto]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_user_info_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_twmz_view_users
select a.period,a.id,a.name,a.tw_language,a.layout,b.nns_addr_code,
null,null,null,c.user_id,
a.sp_id,
a.day
from (
select 
element_at(event_value,'period')period,
element_at(event_value,'id')id,
element_at(event_value,'name')name,
element_at(event_value,'tw_language')tw_language,
element_at(event_value,'layout')layout,
user_id,
session_id,
sp_id,day
from hive.${PLATFORM_ID}.user_log  
where day=${yesterday}  and event_name='view_twmz'
)a 
left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) c on a.session_id=c.session_id
left join (select nns_id,nns_addr_code from hive.${PLATFORM_ID}.nns_user where day=${yesterday})  b on c.user_id =  b.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603193356886]]></job_id> 
		<parent_job_id><![CDATA[20180530170000002]]></parent_job_id> 
		<job_name><![CDATA[twmz_view_users_5minute_info_presto]]></job_name> 
		<job_desc><![CDATA[twmz_view_users_5minute_info_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.twmz_view_users_5minute
select a.period,a.id,a.name,a.tw_language,a.layout,b.nns_addr_code,
null,null,null,c.user_id,
a.sp_id,
${day_last_3_5m},
${minute_last_3_5m}
from (
select 
element_at(event_value,'period')period,
element_at(event_value,'id')id,
element_at(event_value,'name')name,
element_at(event_value,'tw_language')tw_language,
element_at(event_value,'layout')layout,
user_id,
session_id,
sp_id
from hive.${PLATFORM_ID}.user_log  
where ${where_last_3_5m}  and event_name='view_twmz'
)a 
left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${today} group by session_id,user_id) c on a.session_id=c.session_id
left join (select nns_id,nns_addr_code from hive.${PLATFORM_ID}.nns_user where day=${yesterday})  b on c.user_id =  b.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603193356885]]></job_id> 
		<parent_job_id><![CDATA[20180530170000001]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_ribao_all_info_presto]]></job_name> 
		<job_desc><![CDATA[day_twmz_ribao_all_info_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 4 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.twmz_view_times_users
select count(a.id) cnt_page_times_view,count(distinct c.user_id) usercount,b.nns_addr_code,a.sp_id,a.day
from 
(select dt1.session_id,dt1.user_id,element_at(dt1.event_value,'id') id,sp_id,day from hive.${PLATFORM_ID}.user_log dt1
where day=${yesterday}  and event_name='view_twmz'
) a 
left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id) c on a.session_id=c.session_id
left join (select nns_id,nns_addr_code from hive.${PLATFORM_ID}.nns_user where day=${yesterday})  b on c.user_id =  b.nns_id
group by a.sp_id,a.day,b.nns_addr_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603192254528]]></job_id> 
		<parent_job_id><![CDATA[20180603192255528]]></parent_job_id> 
		<job_name><![CDATA[day_user_time_sp_new-presto]]></job_name> 
		<job_desc><![CDATA[day_user_time_sp_new-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_user_time_sp_new
select 
cast(avg(avg_concurrent_online_users) as bigint),max(cnt_peak_concurrent_online_users),sp_id,${yesterday} 
from mysql.${PLATFORM_ID}.hour_user_time_sp_new 
where day=${yesterday} group by sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180603185755528]]></job_id> 
		<parent_job_id><![CDATA[20180603185655528]]></parent_job_id> 
		<job_name><![CDATA[hour_user_time_sp_new-presto]]></job_name> 
		<job_desc><![CDATA[hour_user_time_sp_new-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.hour_user_time_sp_new
select cast(avg(cnt_user_online) as bigint),max(cnt_user_online),cast(sp_id as varchar(100)),${day_last_10_1h},${minute_last_10_1h} from (select sp_id,count(distinct user_id) cnt_user_online,minute from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_10_1h} group by sp_id,minute)dt group by sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530171000002]]></job_id> 
		<parent_job_id><![CDATA[20180530171000001]]></parent_job_id> 
		<job_name><![CDATA[v2.16_day_view_user_time_presto]]></job_name> 
		<job_desc><![CDATA[v2.16_day_view_user_time_presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_view_user_time
select count(a.page_sid) cnt_page_times_view,c.user_id,a.sp_id,c.client_type,a.day
from 
(select page_sid,dt1.session_id,dt1.user_id,sp_id,day from hive.${PLATFORM_ID}.user_log dt1
where day=${yesterday}  and event_name='open_page'
) a 
left join (select session_id,user_id,client_type from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,client_type) c on a.session_id=c.session_id
group by c.user_id,a.sp_id,c.client_type,a.day
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180530165942544]]></job_id> 
		<parent_job_id><![CDATA[20180530180000001]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-nmdp_time_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-nmdp_time_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.nmgdp_schema_5minute
select
cast(category_id as varchar(100)),
cast(video_id as varchar(100)),
cast(video_name as varchar(100)),
cast(dt3.nns_category_name as varchar(100)),
cast(nns_addr_code as varchar(100)),
cast(dt1.sp_id as varchar(100)),
sum(cnt_play_times) ,
count(distinct user_id),
${day_last_3_5m},
${minute_last_3_5m}
from (select user_id,video_id,video_name,asset_id,category_id,sp_id,count(distinct play_sid) cnt_play_times from hive.${PLATFORM_ID}.heartbeat_log  where ${where_last_3_5m} and play_sid is not null group by user_id,video_id,video_name,asset_id,category_id,sp_id) dt1 left join (select nns_id,nns_addr_code from hive.${PLATFORM_ID}.nns_user where day=${yesterday})dt2 on dt1.user_id=dt2.nns_id left join
(select * from hive.${PLATFORM_ID}.nns_assists_category  where day=${yesterday} ) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id
group by category_id,nns_addr_code,video_id,video_name,dt1.sp_id,dt3.nns_category_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180521103853357]]></job_id> 
		<parent_job_id><![CDATA[20180521101031755]]></parent_job_id> 
		<job_name><![CDATA[nns_address_code_extend-presto]]></job_name> 
		<job_desc><![CDATA[nns_address_code_extend-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.nns_address_code_extend
select dt1.nns_code,dt2.nns_name,dt3.nns_name,dt4.nns_name,dt1.sp_id,${yesterday} from (select substr(nns_code,1,15) nns_code,substr(nns_code,1,9) city,substr(nns_code,1,12) borough,sp_id from hive.${PLATFORM_ID}.nns_address_code where day=${yesterday} group by substr(nns_code,1,15),substr(nns_code,1,9),substr(nns_code,1,12),sp_id)dt1 left join (select nns_code,nns_name from hive.${PLATFORM_ID}.nns_address_code where day=${yesterday} and length(nns_code)=9 group by nns_code,nns_name)dt2 on dt1.city=dt2.nns_code left join (select nns_code,nns_name from hive.${PLATFORM_ID}.nns_address_code where day=${yesterday} and length(nns_code)=12 group by nns_code,nns_name)dt3 on dt1.borough=dt3.nns_code left join (select nns_code,nns_name from hive.${PLATFORM_ID}.nns_address_code where day=${yesterday} and length(nns_code)=15 group by nns_code,nns_name)dt4 on dt1.nns_code=dt4.nns_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180519161643876]]></job_id> 
		<parent_job_id><![CDATA[20180519161545320]]></parent_job_id> 
		<job_name><![CDATA[day_twmz_user-presto]]></job_name> 
		<job_desc><![CDATA[day_twmz_user-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 40 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_twmz_user
select user_id,id,name,cast(page_total as int),cast(page_offsite as int),sp_id,apk_version,nns_addr_code,nns_addr_city,cnt_page_view,duration,${yesterday} from (select user_id,id,name,page_total,page_offsite,dt1.sp_id,dt2.apk_version,sum(cast(duration as bigint)*1.0/1000) duration,count(1) cnt_page_view from (select session_id,element_at(event_value,'id') id,element_at(event_value,'name') name,element_at(event_value,'page_total') page_total,element_at(event_value,'page_offsite') page_offsite,element_at(event_value,'duration') duration,sp_id from hive.${PLATFORM_ID}.user_log where day=${yesterday} and event_name='view_twmz')dt1 left join (select session_id,max(apk_version) apk_version,user_id,sp_id from hive.${PLATFORM_ID}.session_log where day>=${today-2} and day<=${yesterday} group by session_id,user_id,sp_id)dt2 on dt1.session_id=dt2.session_id and dt1.sp_id=dt2.sp_id group by user_id,id,name,page_total,page_offsite,dt1.sp_id,dt2.apk_version)dt left join (select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday})dt3 on dt.user_id=dt3.nns_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180516231529929]]></job_id> 
		<parent_job_id><![CDATA[20180516231412753]]></parent_job_id> 
		<job_name><![CDATA[day_app_user_total-presto]]></job_name> 
		<job_desc><![CDATA[day_app_user_total-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_app_user_total 
select app_name,sp_id,sum(cnt_app_use_times) cnt_app_use_times,${yesterday} from (select app_name,sp_id,sum(cnt_app_use_times) cnt_app_use_times from hive.${PLATFORM_ID}.day_app_user_total where day=${today-2} group by app_name,sp_id union all select element_at(event_value,'app_name') app_name,sp_id,count(1) cnt_app_use_times from hive.${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_app' group by element_at(event_value,'app_name'),sp_id) group by app_name,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180516224623608]]></job_id> 
		<parent_job_id><![CDATA[20180516224514540]]></parent_job_id> 
		<job_name><![CDATA[day_content_user_total-presto]]></job_name> 
		<job_desc><![CDATA[day_content_user_total-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_content_user_total 
select user_id,video_type,sp_id,cast(sum(cnt_play_times) as bigint) cnt_play_times,cast(sum(cnt_play_length) as bigint) cnt_play_length,${yesterday} from (select user_id,video_type,sp_id,sum(cnt_play_times) cnt_play_times,sum(cnt_play_length) cnt_play_length from hive.${PLATFORM_ID}.day_content_user_total where day=${today-2} group by user_id,video_type,sp_id union all select user_id,video_type,sp_id,sum(cnt_play_times) cnt_play_times,sum(cnt_play_length) cnt_play_length from hive.${PLATFORM_ID}.day_content_time_user where day=${yesterday} group by user_id,video_type,sp_id) group by user_id,video_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514220046541]]></job_id> 
		<parent_job_id><![CDATA[20180514215910232]]></parent_job_id> 
		<job_name><![CDATA[day_total_summary-presto]]></job_name> 
		<job_desc><![CDATA[day_total_summary-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 6 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_total_summary 
select coalesce(dt1.sp_id,coalesce(dt2.sp_id,coalesce(dt3.sp_id,coalesce(dt4.sp_id,dt5.sp_id)))) sp_id,sum(cnt_user_all_stored) cnt_user_all_stored,sum(cnt_device_all) cnt_device_all,sum(cnt_content_total) cnt_content_total,sum(cnt_live_content) cnt_live_content,sum(cnt_playbill_content) cnt_playbill_content,sum(cnt_collect_all) cnt_collect_all,${yesterday} from (select sp_id,count(distinct nns_id) cnt_user_all_stored from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and format_datetime(from_unixtime(cast(nns_overdue_time/1000 as bigint)),'yyyyMMdd')>='${yesterday}' group by sp_id)dt1 full outer join (select sp_id,count(distinct if(report_source='probe',user_id,null)) cnt_device_all,count(distinct user_id) cnt_collect_all from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} group by sp_id)dt2 on equal(dt1.sp_id,dt2.sp_id) full outer join (select sp_id,sum(cnt_content_total) cnt_content_total from hive.${PLATFORM_ID}.day_vod_content_cnt where day=${yesterday} group by sp_id)dt3 on equal(dt1.sp_id,dt3.sp_id) full outer join (select sp_id,count(distinct nns_id) cnt_live_content from hive.${PLATFORM_ID}.nns_live where day=${yesterday} group by sp_id)dt4 on equal(dt1.sp_id,dt4.sp_id) full outer join (select sp_id,count(distinct nns_id) cnt_playbill_content from hive.${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday} group by sp_id)dt5 on equal(dt1.sp_id,dt5.sp_id) group by coalesce(dt1.sp_id,coalesce(dt2.sp_id,coalesce(dt3.sp_id,coalesce(dt4.sp_id,dt5.sp_id))))
union all 
select 'all' sp_id,cnt_user_all_stored,cnt_device_all,cnt_content_total,cnt_live_content,cnt_playbill_content,cnt_collect_all,${yesterday} from (select count(distinct nns_id) cnt_user_all_stored from hive.${PLATFORM_ID}.nns_user where day=${yesterday} and format_datetime(from_unixtime(cast(nns_overdue_time/1000 as bigint)),'yyyyMMdd')>='${yesterday}')dt1 left join (select count(distinct if(report_source='probe',user_id,null)) cnt_device_all,count(distinct user_id) cnt_collect_all from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday})dt2 on 1=1 left join (select sum(cnt_content_total) cnt_content_total from hive.${PLATFORM_ID}.day_vod_content_cnt where day=${yesterday})dt3 on 1=1 left join (select max(cnt_live_content) cnt_live_content from (select sp_id,count(distinct nns_id) cnt_live_content from hive.${PLATFORM_ID}.nns_live where day=${yesterday} group by sp_id)dt40)dt4 on 1=1 left join 
(select count(1) cnt_playbill_content  from
(select nns_live_id,nns_name from  hive.${PLATFORM_ID}.nns_live_playbill_item where day=${yesterday}  group by nns_live_id,nns_name) dt)dt5 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514205705112]]></job_id> 
		<parent_job_id><![CDATA[20180514205556567]]></parent_job_id> 
		<job_name><![CDATA[day_device_client_apk_addr_system-presto]]></job_name> 
		<job_desc><![CDATA[day_device_client_apk_addr_system-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_device_client_apk_addr_system
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
count(distinct device_id),null,null,report_source,${yesterday} from hive.${PLATFORM_ID}.day_devicecomb where day =${yesterday} and create_time<=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
union all
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
null,count(distinct device_id),null,report_source,${yesterday} from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} and create_time=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514205230429]]></job_id> 
		<parent_job_id><![CDATA[20180514205109913]]></parent_job_id> 
		<job_name><![CDATA[week_device_client_apk_addr_system-presto]]></job_name> 
		<job_desc><![CDATA[week_device_client_apk_addr_system-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 7 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_device_client_apk_addr_system
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
count(distinct device_id),null,null,report_source,${today-7} from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} and create_time<=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
union all
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
null,count(distinct device_id),null,report_source,${today-7} from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} and create_time>=${today-7} and create_time<=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180514204718359]]></job_id> 
		<parent_job_id><![CDATA[20180514204421770]]></parent_job_id> 
		<job_name><![CDATA[month_device_client_apk_addr_system-presto]]></job_name> 
		<job_desc><![CDATA[month_device_client_apk_addr_system-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 7 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_device_client_apk_addr_system
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
count(distinct device_id),null,null,report_source,${last_month} from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} and create_time<=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
union all
select client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,
null,count(distinct device_id),null,report_source,${last_month} from hive.${PLATFORM_ID}.day_devicecomb where day=${yesterday} and create_time>=${last_month} and create_time<=${yesterday} group by client_type,apk_version,sp_id,system_name,system_version,user_addr,user_addr_name,report_source
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180427183320777]]></job_id> 
		<parent_job_id><![CDATA[20180427183152954]]></parent_job_id> 
		<job_name><![CDATA[v2.11.4-hour_content_live_video_playbill_time_interval-presto]]></job_name> 
		<job_desc><![CDATA[v2.11.4-hour_content_live_video_playbill_time_interval-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 5 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.hour_content_live_video_playbill_time_interval
select video_id,video_name,playbill_name,round(sum(end_time-start_time)/(60.0*1000),6),count(distinct user_id),concat(hour,'00'),sp_id,${yesterday} from 
(select user_id,play_sid,video_id,video_name,playbill_name,hour,max(server_time) end_time,min(server_time) start_time,sp_id from (select user_id,play_sid,video_id,video_name,playbill_name,format_datetime(from_unixtime(cast(server_time/1000 as bigint)),'HH') hour,server_time,sp_id from hive.${PLATFORM_ID}.heartbeat_log where day=${yesterday} and video_type='live')dt1 group by user_id,play_sid,video_id,video_name,playbill_name,hour,sp_id)a group by video_id,video_name,playbill_name,hour,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180416231003667]]></job_id> 
		<parent_job_id><![CDATA[20180415100128996]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_user_device_client_apk_sp_start_info-presto]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_user_device_client_apk_sp_start_info-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_user_device_client_apk_sp_start_info
select user_id,device_id,ip,network_type,client_type,apk_version,sp_id,max(server_time) lastlogin,count(1),${yesterday} from hive.${PLATFORM_ID}.startup_log where day=${yesterday} group by user_id,device_id,ip,network_type,client_type,apk_version,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180403161449481]]></job_id> 
		<parent_job_id><![CDATA[20180403161337445]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_view_time_apk_sp_page_block_content-presto]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_view_time_apk_sp_page_block_content-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_view_time_apk_sp_page_block_content
select page_id,block_id,block_content,apk_version,dt1.sp_id,dt2.user_id,count(1) cnt_page_view,
dt3.user_addr,
dt3.user_addr_city,
dt3.user_addr_borough,
dt3.user_addr_town,
${yesterday}
from (select session_id,sp_id,source_page_id_1 page_id,split_part(event_source,'/',3) block_id,element_at(event_value,'bc_name') block_content from hive.${PLATFORM_ID}.user_log where day =${yesterday} and source_page_id_1 is not null and event_name='open_page')dt1 left join (select apk_version,user_id,session_id from (select apk_version,user_id,session_id,row_number() over(partition by session_id order by user_id desc) as depth from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by apk_version,user_id,session_id)tab1 where  depth=1 group by apk_version,user_id,session_id)dt2 on dt1.session_id = dt2.session_id
left join
(select * from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt3 on dt2.user_id=dt3.user_id
where block_id is not null group by page_id,block_id,block_content,apk_version,dt1.sp_id,dt2.user_id,
dt3.user_addr,
dt3.user_addr_city,
dt3.user_addr_borough,
dt3.user_addr_town
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180328204831163]]></job_id> 
		<parent_job_id><![CDATA[20180328204715881]]></parent_job_id> 
		<job_name><![CDATA[v2.9.5-day_view_time_addr_apk_type_page-presto]]></job_name> 
		<job_desc><![CDATA[v2.9.5-day_view_time_addr_apk_type_page-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 3 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_view_time_addr_apk_type_page
select
if(length(user_addr)>6,user_addr,region_code) user_addr,
nns_addr_city,
apk_version,
element_at(event_value,'page_type'),
target_page_id_1 page_id,
sum(1),
sum(cnt_page_stay)/1000.0,
null,
null,
null,
null,
null,
null,
null,
null,
dt1.sp_id,
user_addr_city,
user_addr_borough,
user_addr_town,
client_type,
${yesterday}
from
(select d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,d1.event_value,
max(d1.server_time)-max(d2.server_time) cnt_page_stay,d1.sp_id
from
(select session_id,source_page_id_1,target_page_id_1,server_time,event_value,sp_id from hive.${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') d1
left join
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page') d2
on d1.session_id=d2.session_id and d1.source_page_id_1=d2.target_page_id_1
where d1.server_time>=if(d2.server_time is null,0,d2.server_time)
group by d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,d1.event_value,d1.sp_id) dt1
left join
(select session_id,user_id,apk_version,max(region_code) region_code,max(client_type) client_type from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,apk_version) dt2
on dt1.session_id=dt2.session_id
left join
(select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id
left join
(select * from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
if(length(user_addr)>6,user_addr,region_code),
nns_addr_city,
apk_version,
element_at(event_value,'page_type'),
target_page_id_1,
dt1.sp_id,
user_addr_city,
user_addr_borough,
user_addr_town,
client_type
union all
select
if(length(user_addr)>6,user_addr,region_code) user_addr,
nns_addr_city,
apk_version,
element_at(p_event_value,'page_type'),
source_page_id_1 page_id,
null,
null,
sum(if(p_event_name='ready_page',p_event_duration,0)),
sum(if(p_event_name='ready_page',1,0)),
sum(if(p_event_name='loaded_page',p_event_duration,0)),
sum(if(p_event_name='loaded_page',1,0)),
max(if(p_event_name='ready_page',p_event_duration,0)),
max(if(p_event_name='loaded_page',p_event_duration,0)),
min(if(p_event_name='ready_page',p_event_duration,0)),
min(if(p_event_name='loaded_page',p_event_duration,0)),
dt1.sp_id,
user_addr_city,
user_addr_borough,
user_addr_town,
client_type,
${yesterday}
from
(select * from hive.${PLATFORM_ID}.performance_log where day=${yesterday}) dt1 join (select page_sid from(select page_sid,sum(if(p_event_name='ready_page',1,0)) num1,sum(if(p_event_name='loaded_page',1,0)) num2 from hive.${PLATFORM_ID}.performance_log where day=${yesterday} group by page_sid) tb where num1=num2) dt0 on dt1.page_sid=dt0.page_sid 
left join
(select session_id,user_id,apk_version,max(region_code) region_code,max(client_type) client_type from hive.${PLATFORM_ID}.session_log where day=${yesterday} group by session_id,user_id,apk_version) dt2
on dt1.session_id=dt2.session_id
left join
(select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id
left join
(select * from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
if(length(user_addr)>6,user_addr,region_code),
nns_addr_city,
apk_version,
element_at(p_event_value,'page_type'),
source_page_id_1,
dt1.sp_id,
user_addr_city,
user_addr_borough,
user_addr_town,
client_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323193233211]]></job_id> 
		<parent_job_id><![CDATA[20180323192704506]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-month_home_path_statistics-presto]]></job_name> 
		<job_desc><![CDATA[v2.10.1-month_home_path_statistics-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 4 1 * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.month_home_path_statistics 
select event_source,event_target,sp,sum(page_count),${last_month} from hive.${PLATFORM_ID}.week_home_path_statistics where day>=${last_month} and day<=${yesterday} group by event_source,event_target,sp
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323192111339]]></job_id> 
		<parent_job_id><![CDATA[20180323191610202]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-week_home_path_statistics-presto]]></job_name> 
		<job_desc><![CDATA[v2.10.1-week_home_path_statistics-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 15 2 ? * MON *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.week_home_path_statistics 
select event_source,event_target,sp,sum(page_count),${today-7} from hive.${PLATFORM_ID}.day_home_path_statistics where day>=${today-7} and day<${today} group by event_source,event_target,sp
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180323190416983]]></job_id> 
		<parent_job_id><![CDATA[20180323190338414]]></parent_job_id> 
		<job_name><![CDATA[v2.10.1-day_home_path_statistics-presto]]></job_name> 
		<job_desc><![CDATA[v2.10.1-day_home_path_statistics-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 0 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_home_path_statistics 
select event_source,event_target,sp_id,count(1),${yesterday} from hive.${PLATFORM_ID}.user_log where day=${yesterday} and event_name='open_page' group by event_source,event_target,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206174451937]]></job_id> 
		<parent_job_id><![CDATA[20180206164421202]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-user_time_addr_apk_terminaltype_gender_age_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-user_time_addr_apk_terminaltype_gender_age_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.user_time_addr_apk_terminaltype_gender_age_5minute
select
cast(if(length(nns_addr_code)>6,nns_addr_code,region_code)  as varchar(20)),
cast(nns_addr_city as varchar(50)),
cast(apk_version as varchar(100)),
cast(client_type as varchar(50)),
cast(nns_sex as varchar(10)),
if(1<=nns_age_cal and nns_age_cal<=10,'1',if(11<=nns_age_cal and nns_age_cal<=20,'11',if(21<=nns_age_cal and nns_age_cal<=30,'21',if(31<=nns_age_cal and nns_age_cal<=40,'31',if(41<=nns_age_cal and nns_age_cal<=50,'41',if(51<=nns_age_cal and nns_age_cal<=60,'51',if(61<=nns_age_cal and nns_age_cal<=70,'61',if(71<=nns_age_cal and nns_age_cal<=80,'71',if(81<=nns_age_cal and nns_age_cal<=90,'81','91'))))))))),
count(distinct user_id),
count(user_id),
cast(dt1.sp_id as varchar(50)),
${day_last_3_5m},
${minute_last_3_5m}
from
(select * from hive.${PLATFORM_ID}.startup_log where ${where_last_3_5m}) dt1 left join 
(select * from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt2 on dt1.user_id=dt2.nns_id 
group by
if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,client_type,nns_sex,if(1<=nns_age_cal and nns_age_cal<=10,'1',if(11<=nns_age_cal and nns_age_cal<=20,'11',if(21<=nns_age_cal and nns_age_cal<=30,'21',if(31<=nns_age_cal and nns_age_cal<=40,'31',if(41<=nns_age_cal and nns_age_cal<=50,'41',if(51<=nns_age_cal and nns_age_cal<=60,'51',if(61<=nns_age_cal and nns_age_cal<=70,'61',if(71<=nns_age_cal and nns_age_cal<=80,'71',if(81<=nns_age_cal and nns_age_cal<=90,'81','91'))))))))),dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206165942544]]></job_id> 
		<parent_job_id><![CDATA[20180206180026105]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-user_time_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-user_time_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.user_time_5minute
 select
 count(distinct user_id),
 count(distinct if(video_type!='view',user_id,null)),
 ${day_last_3_5m},
 ${minute_last_3_5m}
 from 
 (select user_id,video_type from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m} group by user_id,video_type union all 
 select user_id,'view_twmz' video_type from (select session_id from hive.${PLATFORM_ID}.user_log where ${where_last_3_5m} and event_name='view_twmz' group by session_id)dt1 left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day>=${today-1} and day<=${today} group by session_id,user_id)dt2 on dt1.session_id=dt2.session_id)a
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206164459279]]></job_id> 
		<parent_job_id><![CDATA[20180206161020823]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-day_device_time_online_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-day_device_time_online_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_device_time_online1
select coalesce(dt.device_id,history.device_id),coalesce(dt.user_id,history.user_id),coalesce(dt.client_type,history.client_type),
coalesce(dt.apk_version,history.apk_version),coalesce(dt.sp_id,history.sp_id),coalesce(dt.mac,history.mac),coalesce(dt.ip,history.ip),
coalesce(dt.system_name,history.system_name),coalesce(dt.system_version,history.system_version),cast(coalesce(dt.server_time,history.server_time) as varchar),coalesce(dt.states,'offline'),
${day_last_3_5m},
${minute_last_3_5m}
from 
(select device_id,user_id,max(client_type) client_type, max(apk_version) apk_version,max(sp_id) sp_id,max(mac) mac,
 max(ip) ip,max(system_name) system_name,max(system_version) system_version,max(server_time) server_time from 
 hive.${PLATFORM_ID}.day_device_time_online1 where ${where_last_48_10m} group by device_id,user_id)history  full outer join  
(select device_id,user_id,max(client_type) client_type,max(apk_version) apk_version,max(sp_id) sp_id,max(mac) mac,max(ip) ip,max(system_name) system_name,max(system_version) system_version,format_datetime(from_unixtime(cast(max(server_time)/1000 as bigint)),'yyyy-MM-dd HH:mm:ss') server_time,'online' states from hive.${PLATFORM_ID}.heartbeat_log where 
${where_last_3_5m} group by user_id,device_id)dt on dt.device_id=history.device_id and dt.user_id = history.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206163636066]]></job_id> 
		<parent_job_id><![CDATA[20180206220128484]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-content_time_video_apk_sp_addr_client_drag_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-content_time_video_apk_sp_addr_client_drag_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.content_time_video_apk_sp_addr_client_drag_5minute
select client_type,video_id,video_name,video_type,apk_version,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code)nns_addr_code,nns_addr_city,count(1) drag_times,round(sum(duration)/1000,2) drag_length,count(distinct play_sid) play_times,${day_last_3_5m},${minute_last_3_5m} from(select user_id,client_type,video_id,video_name,video_type,apk_version,sp_id,duration,play_sid,region_code from hive.${PLATFORM_ID}.play_log where ${where_last_3_5m} and event_type='drag')dt1 left join (select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day = ${yesterday})dt2 on dt1.user_id = dt2.nns_id group by client_type,video_id,video_name,video_type,apk_version,dt1.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206163138843]]></job_id> 
		<parent_job_id><![CDATA[20180206161919763]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-view_time_video_category_asset_cp_sp_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-view_time_video_category_asset_cp_sp_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.view_time_video_category_asset_cp_sp_5minute
select
'vod',
element_at(event_value, 'video_id') video_id,
dt3.nns_name video_name,
element_at(event_value, 'category_id') category_id,
dt2.nns_category_name cn,
element_at(event_value, 'asset_id') asset_id,
dt2.nns_name an,
dt4.nns_id,
nns_cp,
dt1.sp_id,
sum(1),
element_at(event_value, 'page_id'),
apk_version,
${day_last_3_5m},
${minute_last_3_5m}
from
(select session_id,event_value,sp_id,element_at(event_value, 'page_id') from hive.${PLATFORM_ID}.user_log where ${where_last_3_5m} and event_name='open_page') dt1  left join
(select * from hive.${PLATFORM_ID}.session_log where day=${today})session on dt1.session_id = session.session_id
left join
(select * from hive.${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt2
on element_at(event_value, 'category_id')=dt2.nns_category_id and element_at(event_value, 'asset_id')=dt2.nns_id and dt1.sp_id=dt2.sp_id
left join
(select nns_id,nns_name,nns_cp,sp_id from hive.${PLATFORM_ID}.nns_vod where day=${yesterday}) dt3
on element_at(event_value, 'video_id')=dt3.nns_id and dt1.sp_id=dt2.sp_id
left join
(select nns_id,nns_name,sp_id from hive.${PLATFORM_ID}.nns_cp where day=${yesterday}) dt4
on dt3.nns_cp=dt4.nns_name and dt1.sp_id=dt4.sp_id
group by
element_at(event_value, 'video_id'),
dt3.nns_name,
element_at(event_value, 'category_id'),
dt2.nns_category_name,
element_at(event_value, 'asset_id'),
dt2.nns_name,
dt4.nns_id,
nns_cp,
dt1.sp_id,
element_at(event_value, 'page_id'),
apk_version
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206162624100]]></job_id> 
		<parent_job_id><![CDATA[20180206143931669]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb1_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb1_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.usercomb1_5minute
with cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from hive.${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from hive.${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
category_id,
dt3.nns_category_name,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
heartbeat_type,
${day_last_3_5m},
${minute_last_3_5m}
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type,max(region_code) region_code from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m} group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,heartbeat_type) dt1
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from hive.${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id,heartbeat_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206162125941]]></job_id> 
		<parent_job_id><![CDATA[20180206162838324]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-content_time_user_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-content_time_user_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.content_time_user_5minute
select 
dt1.video_type,
dt1.user_id,
null nns_addr_code,
null nns_addr_city,
apk_version,
client_type,
null nns_sex,
null,
dt1.sp_id,
dt1.video_id,
dt1.video_name,
category_id,
null nns_category_name,
asset_id,
null,
null,
null,
playbill_name,
null network_type, 
dt1.play_sid,
round(sum(if(end_time-start_time-if(buffer_time is null,0,buffer_time )-if(paused_time is null,0,paused_time )<=0,0,end_time-start_time-if(buffer_time is null,0,buffer_time )-if(paused_time is null,0,paused_time )))/1000/60,6),playbill_start_time,
null nns_mode,
dt1.episode_id,
${day_last_3_5m},
${minute_last_3_5m}
from
(select user_id,client_type,apk_version,play_sid,episode_id,asset_id,category_id,video_id,video_name,playbill_name,video_type,sp_id,playbill_start_time,max(server_time) end_time,min(server_time) start_time from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m}  group by user_id,client_type,network_type,apk_version,play_sid,episode_id,asset_id,category_id,video_id,video_name,playbill_name,video_type,sp_id,playbill_start_time)dt1 
left join 
(select 
user_id,
video_type,
video_id,
play_sid,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='pause',duration,0)) paused_time
from (select user_id,video_type,video_id,event_type,play_sid,duration from hive.${PLATFORM_ID}.play_log where ${where_last_3_5m} )play 
group by user_id,video_type,video_id,play_sid)dt2 
on dt1.user_id=dt2.user_id and dt1.play_sid=dt2.play_sid and dt1.video_type=dt2.video_type and dt1.video_id=dt2.video_id
group by dt1.video_type,
dt1.user_id,
apk_version,
client_type,
dt1.sp_id,
dt1.video_id,
dt1.video_name,
category_id,
asset_id,
playbill_name,
dt1.play_sid,
playbill_start_time,
dt1.episode_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206161305972]]></job_id> 
		<parent_job_id><![CDATA[20180206185930259]]></parent_job_id> 
		<job_name><![CDATA[quality_play_time_addr_apk_video_type_terminaltype_5minute-presto]]></job_name> 
		<job_desc><![CDATA[quality_play_time_addr_apk_video_type_terminaltype_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.quality_play_time_addr_apk_video_type_terminaltype_5minute
select
client_type,
video_id,
video_name,
video_type,
apk_version,
dt.sp_id,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
sum(case when dt.cnt_play_buffer>0 then dt.cnt_play_buffer end),
count(distinct dt.user_id),
sum(1),
count(distinct(case when dt.cnt_play_buffer>2 then user_id end)),
round(sum(buffer_time)/(60.0*1000),6),
round(sum(if(ready_time<0,0,ready_time))/(60.0*1000),6),
sum(case when dt.cnt_error>0 then dt.cnt_error end),
${day_last_3_5m},
${minute_last_3_5m}
from
(select
client_type,
video_id,
video_name,
video_type,
apk_version,
sp_id,
user_id,
play_sid,
max(region_code) region_code,
count(case when event_type='buffer' then play_sid end)-2 cnt_play_buffer,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='ready',duration,0)) ready_time,
count(case when event_type='error' then play_sid end) cnt_error 
from (select client_type,user_id,video_type,apk_version,region_code,sp_id,video_id,video_name,event_type,server_time,play_sid,duration from hive.${PLATFORM_ID}.play_log where ${where_last_3_5m}) dt1 group by client_type,video_id,video_name,video_type,apk_version,sp_id,user_id,play_sid) dt left join (select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday} ) dt2 on dt.user_id=dt2.nns_id 
group by client_type,video_id,video_name,video_type,apk_version,dt.sp_id,if(length(nns_addr_code)>6,nns_addr_code,region_code),nns_addr_city
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206153228117]]></job_id> 
		<parent_job_id><![CDATA[20180206192640996]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb2_5minute-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb2_5minute-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3/5 * * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.usercomb2_5minute
with cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from hive.${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from hive.${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
category_id,
dt3.nns_category_name,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
${day_last_3_5m},
${minute_last_3_5m}
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,max(region_code) region_code from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m} and video_type in ('vod','live','playback','timeshift') group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id) dt1
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from hive.${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id
union all
select null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
null category_id,
null nns_category_name,
null asset_id,
null nns_name,
null nns_cp_id,
null nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
sp_id,
${day_last_3_5m},
${minute_last_3_5m} from (select session_id,sp_id from hive.${PLATFORM_ID}.user_log where ${where_last_3_5m} and event_name='view_twmz' group by session_id,sp_id)dt1 left join (select session_id,user_id,client_type,apk_version,max(region_code) region_code from hive.${PLATFORM_ID}.session_log where day>=${today-1} and day<=${today} group by session_id,user_id,client_type,apk_version)dt2 on dt1.session_id=dt2.session_id left join (select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday})dt3 on dt2.user_id=dt3.nns_id group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180206101950319]]></job_id> 
		<parent_job_id><![CDATA[20180206101844846]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-usercomb2_hour-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-usercomb2_hour-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.usercomb2_hour
with cp as
(
select dt1.nns_id as nns_vod_id,dt2.nns_id as nns_cp_id,nns_cp,dt1.sp_id from
(select nns_id,nns_cp,sp_id from hive.${PLATFORM_ID}.nns_vod where day=${yesterday}) dt1
left join
(select nns_id,nns_name,sp_id from hive.${PLATFORM_ID}.nns_cp where day=${yesterday}) dt2
on dt1.nns_cp=dt2.nns_name and dt1.sp_id=dt2.sp_id
group by dt1.nns_id,dt2.nns_id,nns_cp,dt1.sp_id
)
select
null,
if(length(nns_addr_code)>6,nns_addr_code,region_code) nns_addr_code,
nns_addr_city,
apk_version,
category_id,
dt3.nns_category_name,
asset_id,
dt3.nns_name,
cp.nns_cp_id,
cp.nns_cp,
client_type,
nns_sex,
if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),
user_id,
dt1.sp_id,
${day_last_3_1h},
${minute_last_3_1h}
from (select video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id,max(region_code) region_code from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_1h} and video_type in ('vod','live','playback','timeshift') group by video_id,user_id,apk_version,category_id,asset_id,client_type,sp_id) dt1
left join
cp on dt1.video_id=cp.nns_vod_id and dt1.sp_id=cp.sp_id
left join
(select * from hive.${PLATFORM_ID}.nns_assists_category where day=${yesterday}) dt3 on dt1.category_id=dt3.nns_category_id and dt1.asset_id=dt3.nns_id and dt1.sp_id=dt3.sp_id
left join
(select nns_id,nns_sex,nns_age_cal,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt7 on dt1.user_id=dt7.nns_id 
group by if(length(nns_addr_code)>6,nns_addr_code,region_code) ,nns_addr_city,apk_version,category_id,dt3.nns_category_name,asset_id,dt3.nns_name,cp.nns_cp_id,cp.nns_cp,client_type,nns_sex,if(nns_age_cal<=7,'0-7',if(8<=nns_age_cal and nns_age_cal<=18,'8-18',if(19<=nns_age_cal and nns_age_cal<=40,'19-40',if(41<=nns_age_cal and nns_age_cal<=65,'41-65',if(nns_age_cal>65 ,'65+',null))))),user_id,dt1.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205204952789]]></job_id> 
		<parent_job_id><![CDATA[20180205204856548]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_view_time_addr_apk_type_page-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_view_time_addr_apk_type_page-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.hour_view_time_addr_apk_type_page
select
cast(user_addr as varchar(100)),
cast(user_addr_city as varchar(100)),
cast(apk_version as varchar(100)),
cast(page_type as varchar(100)),
cast(page_id as varchar(100)),
sum(cnt_page_view),
sum(cnt_page_stay),
sum(cnt_page_ready_duration),
sum(cnt_page_ready),
sum(cnt_page_loaded_duration),
sum(cnt_page_loaded),
sum(max_page_ready_duration_),
sum(max_page_loaded_duration_),
sum(min_page_ready_duration_),
sum(min_page_loaded_duration_),
cast(sp_id as varchar(100)),
${day_last_3_1h},
${minute_last_3_1h}
from(
select
if(length(user_addr)>6,user_addr,region_code) user_addr,
user_addr_city,
apk_version,
element_at(event_value,'page_type') page_type,
target_page_id_1 page_id,
sum(1) cnt_page_view,
sum(cnt_page_stay)/1000.0 cnt_page_stay,
null cnt_page_ready_duration,
null cnt_page_ready,
null cnt_page_loaded_duration,
null cnt_page_loaded,
null max_page_ready_duration_,
null max_page_loaded_duration_,
null min_page_ready_duration_,
null min_page_loaded_duration_,
dt1.sp_id
from
(select d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,d1.event_value,
if((max(d1.server_time)-max(d2.server_time))>=0,max(d1.server_time)-max(d2.server_time),0) cnt_page_stay,d1.sp_id
from
(select session_id,source_page_id_1,target_page_id_1,server_time,event_value,sp_id from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='open_page') d1
left join
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='open_page') d2
on d1.session_id=d2.session_id and d1.source_page_id_1=d2.target_page_id_1
group by d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,d1.event_value,sp_id) dt1
left join
(select session_id,user_id,apk_version,sp_id,max(region_code) region_code from hive.${PLATFORM_ID}.session_log where day=${today} group by session_id,user_id,apk_version,sp_id) dt2
on dt1.session_id=dt2.session_id
left join
(select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id 
left join
(select * from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
if(length(user_addr)>6,user_addr,region_code),
user_addr_city,
apk_version,
element_at(event_value,'page_type'),
target_page_id_1,
dt1.sp_id
union all
select
if(length(user_addr)>6,user_addr,region_code) user_addr,
user_addr_city,
apk_version,
element_at(p_event_value,'page_type') page_type,
target_page_id_1 page_id,
null cnt_page_view,
null cnt_page_stay,
sum(if(p_event_name='ready_page',p_event_duration,0)) cnt_page_ready_duration,
sum(if(p_event_name='ready_page',1,0)) cnt_page_ready,
sum(if(p_event_name='loaded_page',p_event_duration,0)) cnt_page_loaded_duration,
sum(if(p_event_name='loaded_page',1,0)) cnt_page_loaded,
max(if(p_event_name='ready_page',p_event_duration,0)) max_page_ready_duration_,
max(if(p_event_name='loaded_page',p_event_duration,0)) max_page_loaded_duration_,
min(if(p_event_name='ready_page',p_event_duration,0)) min_page_ready_duration_,
min(if(p_event_name='loaded_page',p_event_duration,0)) min_page_loaded_duration_,
dt1.sp_id
from
(select * from hive.${PLATFORM_ID}.performance_log where ${where_last_3_1h}) dt1
left join
(select session_id,user_id,apk_version,sp_id,max(region_code) region_code from hive.${PLATFORM_ID}.session_log where day=${today} group by session_id,user_id,apk_version,sp_id) dt2
on dt1.session_id=dt2.session_id
left join
(select nns_id,nns_addr_code,nns_addr_city from hive.${PLATFORM_ID}.nns_user where day=${yesterday}) dt3
on dt2.user_id=dt3.nns_id 
left join
(select * from hive.${PLATFORM_ID}.user_addr_info where day=${yesterday} ) dt4 on dt2.user_id=dt4.user_id
group by
if(length(user_addr)>6,user_addr,region_code),
user_addr_city,
apk_version,
element_at(p_event_value,'page_type'),
target_page_id_1,
dt1.sp_id 
) d
group by
user_addr,
user_addr_city,
apk_version,
page_type,
page_id,
sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205204350138]]></job_id> 
		<parent_job_id><![CDATA[20180205204247880]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_view_time-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_view_time-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.hour_view_time
select
sum(cnt_page_view),
sum(cnt_user_active),
sum(cnt_page_stay),
sum(cnt_page_ready_duration),
sum(cnt_page_ready),
sum(cnt_page_loaded_duration),
sum(cnt_page_loaded),
sum(max_page_ready_duration_),
sum(max_page_loaded_duration_),
sum(min_page_ready_duration_),
sum(min_page_loaded_duration_),
${day_last_3_5m},
${minute_last_3_5m}
from(
select
sum(1) cnt_page_view,
count(distinct user_id) cnt_user_active,
sum(cnt_page_stay)/1000.0 cnt_page_stay,
null cnt_page_ready_duration,
null cnt_page_ready,
null cnt_page_loaded_duration,
null cnt_page_loaded,
null max_page_ready_duration_,
null max_page_loaded_duration_,
null min_page_ready_duration_,
null min_page_loaded_duration_
from
(select d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time,
max(d1.server_time)-max(d2.server_time) cnt_page_stay
from
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='open_page') d1
left join
(select session_id,source_page_id_1,target_page_id_1,server_time from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='open_page') d2
on d1.session_id=d2.session_id and d1.source_page_id_1=d2.target_page_id_1
where d1.server_time>=coalesce(d2.server_time,0)
group by d1.session_id,d1.source_page_id_1,d1.target_page_id_1,d1.server_time) dt1
left join
(select session_id,user_id from hive.${PLATFORM_ID}.session_log where day=${today} group by session_id,user_id) dt2
on dt1.session_id=dt2.session_id
union all
select
null cnt_page_view,
null cnt_user_active,
null cnt_page_stay,
sum(if(p_event_name='ready_page',p_event_duration,0)) cnt_page_ready_duration,
sum(if(p_event_name='ready_page',1,0)) cnt_page_ready,
sum(if(p_event_name='loaded_page',p_event_duration,0)) cnt_page_loaded_duration,
sum(if(p_event_name='loaded_page',1,0)) cnt_page_loaded,
max(if(p_event_name='ready_page',p_event_duration,0)) max_page_ready_duration_,
max(if(p_event_name='loaded_page',p_event_duration,0)) max_page_loaded_duration_,
min(if(p_event_name='ready_page',p_event_duration,0)) min_page_ready_duration_,
min(if(p_event_name='loaded_page',p_event_duration,0)) min_page_loaded_duration_
from
hive.${PLATFORM_ID}.performance_log where ${where_last_3_1h}
) d
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180205203008943]]></job_id> 
		<parent_job_id><![CDATA[20180205202928792]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-hour_user_time-presto]]></job_name> 
		<job_desc><![CDATA[v2.8.1-hour_user_time-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 3 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into mysql.${PLATFORM_ID}.hour_user_time
 select
 count(distinct user_id),
 count(distinct if(video_type!='view',user_id,null)),
 ${day_last_3_1h},
 ${minute_last_3_1h}
 from 
 (select user_id,video_type from hive.${PLATFORM_ID}.heartbeat_log where ${where_last_3_5m} group by user_id,video_type union all
 select user_id,'view_twmz' video_type from (select session_id from hive.${PLATFORM_ID}.user_log where ${where_last_3_1h} and event_name='view_twmz' group by session_id)dt1 left join (select session_id,user_id from hive.${PLATFORM_ID}.session_log where day>=${today-1} and day<=${today} group by session_id,user_id)dt2 on dt1.session_id=dt2.session_id)a
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180130154554556]]></job_id> 
		<parent_job_id><![CDATA[20171214143306085]]></parent_job_id> 
		<job_name><![CDATA[v2.8.1-playtotal_day]]></job_name> 
		<job_desc><![CDATA[v2.8.1-playtotal_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 20 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.playtotal_day partition (day=${yesterday})
select video_type,video_id,video_name,sum(cnt_play_times),sp_id from (select video_type,video_id,video_name,sum(play_total_by_all) cnt_play_times,sp_id from ${PLATFORM_ID}.playtotal_day where day=${today-2} group by video_type,video_id,video_name,sp_id
union all 
select 'vod' video_type,video_id,video_name,sum(cnt_vod_play_times) cnt_play_times,sp_id from ${PLATFORM_ID}.detail_vod where day=${yesterday} group by video_id,video_name,sp_id
union all 
select 'live' video_type,video_id,video_name,sum(cnt_live_play_times) cnt_play_times,sp_id from ${PLATFORM_ID}.detail_live where day=${yesterday} group by video_id,video_name,sp_id
union all
select 'playback' video_type, channel_id video_id,channel_name video_name,sum(cnt_playback_play_times) cnt_play_times,sp_id from ${PLATFORM_ID}.detail_playback where day=${yesterday} group by channel_id,channel_name,sp_id
)a group by video_type,video_id,video_name,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108171429299]]></job_id> 
		<parent_job_id><![CDATA[20171108170942818]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-today_active]]></job_name> 
		<job_desc><![CDATA[v2.7.1-today_active]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 59 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_active partition(day=${today})
select
uid,client_type,sp_id
from ${PLATFORM_ID}.hour_valid where day=${today} group by uid,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108171306250]]></job_id> 
		<parent_job_id><![CDATA[20171108170942818]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-today_online]]></job_name> 
		<job_desc><![CDATA[v2.7.1-today_online]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 59 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_online partition(day=${today})
select
user_id,
client_type,sp_id 
from ${PLATFORM_ID}.heartbeat_log where day=${today} group by user_id,client_type,sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108171136062]]></job_id> 
		<parent_job_id><![CDATA[20171108170942818]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-today_summary]]></job_name> 
		<job_desc><![CDATA[v2.7.1-today_summary]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 59 0/1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.today_summary partition(day=${today})
select
dt.video_type,
count(distinct user_id),
sum(cnt_play_times),
round(sum(if(dt.end_time-dt.start_time-buffer_time-paused_time>0,dt.end_time-dt.start_time-buffer_time-paused_time,0))/(60.0*1000),6),
null,
null,
null,
null,
null,
null,
null,
null,
null,
null ,
client_type,sp_id
from
(select
video_type,
play_sid,
user_id,
count(distinct play_sid) cnt_play_times,
max(if(event_type='finish',server_time,endtime)) end_time,
min(if(event_type='play',server_time,starttime)) start_time,
sum(if(event_type='buffer',duration,0)) buffer_time,
sum(if(event_type='paused',duration,0)) paused_time,
dt1.client_type,dt1.sp_id
from 
(select * from ${PLATFORM_ID}.play_log where day=${today}) dt1 join (select * from ${PLATFORM_ID}.hour_valid where day=${today}) valid
on dt1.user_id=valid.uid and dt1.play_sid=valid.pid
group by video_type,play_sid,user_id,dt1.client_type,dt1.sp_id) dt
group by dt.video_type,dt.client_type,dt.sp_id
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(show),
sum(if(click is null,0,click)),
null,
null ,
null client_type,null sp_id
from (select count(1) show from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day= ${today})dt1 left join 
(select count(1) click from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day= ${today})dt2 on 1=1
union all
select 
null video_type,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
null,
sum(show),
sum(if(click is null,0,click)),
null client_type,null sp_id
from  (select count(distinct user_id) show from (select session_id from ${PLATFORM_ID}.user_log where event_name = 'show_ad' and day=${today})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${today}) dt2 on dt1.session_id = dt2.session_id)dt left join 
(select count(distinct user_id) click from (select session_id from ${PLATFORM_ID}.user_log where event_name = 'click_ad' and day=${today})dt1 
left join (select user_id,session_id from ${PLATFORM_ID}.session_log where day=${today}) dt2 on dt1.session_id = dt2.session_id)dt0 on 1=1
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20171108110256923]]></job_id> 
		<parent_job_id><![CDATA[20171108110150690]]></parent_job_id> 
		<job_name><![CDATA[v2.7.1-user_time_new_day]]></job_name> 
		<job_desc><![CDATA[v2.7.1-user_time_new_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_time_new_day partition(day=${yesterday})
select null as cnt_daily_active_user,null as cnt_week_active_user,count(distinct user_id) cnt_month_active_user,active_day,apk_version,sp_id,client_type,user_addr from (
select user_id,count(distinct day) as active_day,max(apk_version) apk_version,sp_id,client_type,user_addr from ${PLATFORM_ID}.day_user_time_new_user where  day>=${today-30} and day<${today} group by user_id,sp_id,client_type,user_addr
 )a group by active_day,apk_version,sp_id,client_type,user_addr
union all 
select null as cnt_daily_active_user,count(distinct user_id) cnt_week_active_user,null as cnt_month_active_user,active_day,apk_version,sp_id,client_type,user_addr from (
select user_id,count(distinct day) as active_day,max(apk_version) apk_version,sp_id,client_type,user_addr from ${PLATFORM_ID}.day_user_time_new_user where  day>=${today-7} and day<${today} group by user_id,sp_id,client_type,user_addr
)a group by active_day,apk_version,sp_id,client_type,user_addr
union all
select count(distinct user_id) cnt_daily_active_user,null as cnt_week_active_user,null as cnt_month_active_user,1 active_day,apk_version,sp_id,client_type,user_addr from (
select user_id,max(apk_version) apk_version,sp_id,client_type,user_addr from ${PLATFORM_ID}.day_user_time_new_user where  day=${yesterday}  group by user_id,sp_id,client_type,user_addr
)a group by apk_version,sp_id,client_type,user_addr
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170807142842384]]></job_id> 
		<parent_job_id><![CDATA[20170807135243726]]></parent_job_id> 
		<job_name><![CDATA[v2.3.1-recommend_scene_info_distinct]]></job_name> 
		<job_desc><![CDATA[v2.3.1-recommend_scene_info_distinct]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 0 1 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.recommend_scene_info
select scene_id,max(scene_name) from ${PLATFORM_ID}.recommend_scene_info group by scene_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172458269]]></job_id> 
		<parent_job_id><![CDATA[20170216172013383]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-user_tag_day]]></job_name> 
		<job_desc><![CDATA[v1.7.1-user_tag_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		with 
dt1 as (
select user_id,video_id,cnt_play_length_minute from ${PLATFORM_ID}.user_tag_tmp where day=${yesterday} and cnt_play_length_minute>=1.0
)
insert overwrite table ${PLATFORM_ID}.user_tag_day partition(day=${yesterday})
select
user_id,
'01',
'01001',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_copyright from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010010%') dt3 on dt2.nns_copyright=dt3.tag_name
group by user_id,'01','01001',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01002',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_screenwriter from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010020%') dt3 on dt2.nns_screenwriter=dt3.tag_name
group by user_id,'01','01002',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01003',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_producer from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010030%') dt3 on dt2.nns_producer=dt3.tag_name
group by user_id,'01','01003',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01004',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_director from ${PLATFORM_ID}.nns_vod where day=${yesterday} and nns_director<>'') dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010040%') dt3 on dt2.nns_director=dt3.tag_name
group by user_id,'01','01004',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01005',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_kind from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010050%') dt3 on dt2.nns_kind=dt3.tag_name
group by user_id,'01','01005',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01006',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_kind from ${PLATFORM_ID}.nns_vod where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010060%') dt3 on dt2.nns_kind=dt3.tag_name
group by user_id,'01','01006',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01007',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_actor from ${PLATFORM_ID}.nns_vod where day=${yesterday} and nns_actor<>'') dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010070%') dt3 on dt2.nns_actor=dt3.tag_name
group by user_id,'01','01007',dt3.tag_code,dt3.tag_name
union all
select
user_id,
'01',
'01008',
dt3.tag_code,
dt3.tag_name,
sum(cnt_play_length_minute)
from
dt1
join (select nns_id,nns_name from ${PLATFORM_ID}.nns_live where day=${yesterday}) dt2 on dt1.video_id=dt2.nns_id
join (select tag_code,tag_name from ${PLATFORM_ID}.nns_item_tag where day=${yesterday} and tag_code like '010090%') dt3 on dt2.nns_name=dt3.tag_name
group by user_id,'01','01008',dt3.tag_code,dt3.tag_name
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172102849]]></job_id> 
		<parent_job_id><![CDATA[20170216172013383]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_user_rating]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_user_rating]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_rating partition (day=${yesterday})
select
user_id,
video_id,
content_type,
sum(if(day=${yesterday},rating*0.7,rating*0.3))
from
(select
day,
dt1.user_id,
video_id,
content_type,
dt1.cnt_play_length_minute/dt2.cnt_play_length rating
from
(select day,user_id,video_id,content_type,cnt_play_length_minute from ${PLATFORM_ID}.user_tag_tmp where day=${yesterday} and cnt_play_length_minute>0) dt1
join
(select user_id,sum(cnt_play_length_minute) cnt_play_length from ${PLATFORM_ID}.user_tag_tmp where day=${yesterday} and cnt_play_length_minute>0
group by user_id) dt2
on dt1.user_id=dt2.user_id
union all
select day,user_id,video_id,content_type,rating from ${PLATFORM_ID}.day_user_rating where day=${today-2}) dt
group by
user_id,video_id,content_type
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180708120046541]]></job_id> 
		<parent_job_id><![CDATA[20180708220046541]]></parent_job_id> 
		<job_name><![CDATA[day_special_video_addr_sp-presto]]></job_name> 
		<job_desc><![CDATA[day_special_video_addr_sp-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:11.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:11.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 4 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_special_video_addr_sp
 select special_id,special_name,video_id,video_name,user_addr,addr_city,addr_borough,addr_town,sum(cnt_play_times),progress,sp_id,day from hive.${PLATFORM_ID}.day_special_video_addr_sp_user where day=${yesterday} group by special_id,special_name,video_id,video_name,user_addr,addr_city,addr_borough,addr_town,progress,sp_id,day
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180416231248083]]></job_id> 
		<parent_job_id><![CDATA[20180416231003667]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_user_info-presto]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_user_info-presto]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 10 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_user_info
select dt1.nns_id,dt1.nns_name,null,null,dt1.nns_sex,dt1.nns_country,null,regexp_replace(dt1.nns_addr,',',' '),dt1.nns_telephone,regexp_replace(dt1.nns_occupation,',',' '),null,dt1.nns_create_time,if(dt4.lastlogin is null,dt5.lastlogin,dt4.lastlogin)  ,dt1.sp_id,dt4.device_id,dt4.client_type,dt4.apk_version,${yesterday} from (select nns_id,nns_name,case when upper(nns_sex) ='M' or upper(nns_sex) = 'MALE' or nns_sex='' then 'male' when upper(nns_sex) ='F' or upper(nns_sex) = 'FEMALE' or nns_sex='' then 'female' else '' end nns_sex,nns_country,nns_addr,nns_telephone,nns_occupation,nns_create_time,sp_id  from hive.${PLATFORM_ID}.nns_user where day=${yesterday})dt1 
left join (
select user_id,max(lastlogin) lastlogin,max(device_id) device_id,max(client_type) client_type,max(apk_version) apk_version from hive.${PLATFORM_ID}.day_user_device_client_apk_sp_start_info where day=${yesterday}  group by user_id,sp_id)dt4 on dt1.nns_id = dt4.user_id 
left join (
select user_id,sp_id,max(lastlogin) lastlogin from hive.${PLATFORM_ID}.day_user_info where day=${today-2}  group by user_id,sp_id)dt5 on dt1.nns_id = dt5.user_id and dt1.sp_id=dt5.sp_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20180403165749847]]></job_id> 
		<parent_job_id><![CDATA[20180403161449481]]></parent_job_id> 
		<job_name><![CDATA[v2.11.1-day_view_page_block_user]]></job_name> 
		<job_desc><![CDATA[v2.11.1-day_view_page_block_user]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 5 * * ? *]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert into hive.${PLATFORM_ID}.day_view_page_block_user
select dt.page_id,dt.block_id,dt.block_content,dt.apk_version,dt.sp_id,if(dt2.user_id is null,1,0),1,dt.user_id,${yesterday},
dt3.user_addr,
dt3.user_addr_city,
dt3.user_addr_borough,
dt3.user_addr_town
from (select dt1.* from (select * from hive.${PLATFORM_ID}.day_view_time_apk_sp_page_block_content where day=${yesterday})dt1 left join (select user_id,page_id,block_id,block_content from hive.${PLATFORM_ID}.day_view_page_block_user where day<${yesterday} group by user_id,page_id,block_id,block_content) dt0 on dt1.user_id = dt0.user_id  and dt1.page_id =dt0.page_id and dt1.block_id = dt0.block_id and dt1.block_content = dt0.block_content where dt0.user_id is null)dt left join (select user_id,page_id,block_id from hive.${PLATFORM_ID}.day_view_page_block_user where day<${yesterday} group by user_id,page_id,block_id)dt2 on dt.user_id = dt2.user_id  and dt.page_id =dt2.page_id and dt.block_id = dt2.block_id
left join
(select * from hive.${PLATFORM_ID}.user_addr_info  where day=${yesterday} ) dt3 on dt.user_id=dt3.user_id
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/presto-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[-17]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172544936]]></job_id> 
		<parent_job_id><![CDATA[20170216172458269]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-user_profile_tmp]]></job_name> 
		<job_desc><![CDATA[v1.7.1-user_profile_tmp]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_profile_tmp partition(day=${yesterday})
select
user_id,
tag1_code,
tag2_code,
sum(tag3_cnt)
from ${PLATFORM_ID}.user_tag_day where day=${yesterday}
group by user_id,tag1_code,tag2_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172202782]]></job_id> 
		<parent_job_id><![CDATA[20170216172102849]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_user_index]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_user_index]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_index partition (day=${yesterday})
select
user_id,row_number() over (partition by day order by user_id) from
(select user_id,day from ${PLATFORM_ID}.day_user_rating where day=${yesterday} group by user_id,day) dt
;
insert overwrite table ${PLATFORM_ID}.day_video_index partition (day=${yesterday})
select
video_id,content_type,row_number() over (partition by day order by video_id) from
(select video_id,content_type,day from ${PLATFORM_ID}.day_user_rating where day=${yesterday} group by video_id,content_type,day) dt
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216173009898]]></job_id> 
		<parent_job_id><![CDATA[20170216172544936]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-user_profile_day]]></job_name> 
		<job_desc><![CDATA[v1.7.1-user_profile_day]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.user_profile_day partition(day=${yesterday})
select
dt1.user_id,
dt1.tag1_code,
dt1.tag2_code,
dt1.tag3_code,
dt1.tag3_name,
round(tag3_cnt/tag2_cnt,2)
from (select * from ${PLATFORM_ID}.user_tag_day where day=${yesterday}) dt1 
join (select * from ${PLATFORM_ID}.user_profile_tmp where day=${yesterday}) dt2 
on dt1.user_id=dt2.user_id and dt1.tag1_code=dt2.tag1_code and dt1.tag2_code=dt2.tag2_code
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
	<job_def>
		<job_id><![CDATA[20170216172240894]]></job_id> 
		<parent_job_id><![CDATA[20170216172202782]]></parent_job_id> 
		<job_name><![CDATA[v1.7.1-day_user_rating_index]]></job_name> 
		<job_desc><![CDATA[v1.7.1-day_user_rating_index]]></job_desc> 
		<job_type><![CDATA[2]]></job_type> 
		<job_create_time><![CDATA[2018-11-05 10:05:14.0]]></job_create_time> 
		<status_change_time><![CDATA[2018-11-05 10:05:14.0]]></status_change_time> 
		<run_time_cron><![CDATA[0 30 2 * * ?]]></run_time_cron> 
		<table_name><![CDATA[]]></table_name> 
		<sql_statement><![CDATA[
		insert overwrite table ${PLATFORM_ID}.day_user_rating_index partition(day=${yesterday})
select
user_index,
video_index,
dt1.content_type,
rating
from
(select * from ${PLATFORM_ID}.day_user_rating where day=${yesterday}) dt1
join
(select * from ${PLATFORM_ID}.day_user_index where day=${yesterday}) dt2
on dt1.user_id=dt2.user_id
join
(select * from ${PLATFORM_ID}.day_video_index where day=${yesterday}) dt3
on dt1.video_id=dt3.video_id and nvl(dt1.content_type,'')=nvl(dt3.content_type,'')
		]]></sql_statement> 
		<shell_script><![CDATA[sh /opt/cloudera/parcels/bluewhale/lib/bdp-job-engine/hive-sql-job.sh ${run_id} ${run_time}]]></shell_script> 
		<result_file_path><![CDATA[]]></result_file_path> 
		<result_file_format><![CDATA[csv]]></result_file_format> 
		<status><![CDATA[2]]></status> 
		<statis_tg_minutes><![CDATA[0]]></statis_tg_minutes> 
		<runAgain><![CDATA[0]]></runAgain> 
		<isGetLog><![CDATA[1]]></isGetLog> 
		<pre_statistics_type><![CDATA[0]]></pre_statistics_type> 
		<plugin_impl_id><![CDATA[]]></plugin_impl_id> 
    </job_def>
</jobs>